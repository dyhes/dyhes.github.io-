<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>踏雪泥 on 飞鸿踏雪泥</title><link>https://dyhes.github.io/categories/snow/</link><description>Recent content in 踏雪泥 on 飞鸿踏雪泥</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Mon, 13 Jan 2025 00:00:00 +0000</lastBuildDate><atom:link href="https://dyhes.github.io/categories/snow/index.xml" rel="self" type="application/rss+xml"/><item><title>【Code】期末评教</title><link>https://dyhes.github.io/p/code%E6%9C%9F%E6%9C%AB%E8%AF%84%E6%95%99/</link><pubDate>Mon, 13 Jan 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/code%E6%9C%9F%E6%9C%AB%E8%AF%84%E6%95%99/</guid><description>&lt;h1 id="期末评教">期末评教
&lt;/h1>&lt;p>失败版&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kd">var&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="k">of&lt;/span> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">querySelectorAll&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;.ant-form-item-control&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">group&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">querySelector&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;.ant-radio-group&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">group&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">i&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">className&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;ant-form-item-control has-success&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">label&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">group&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">querySelectorAll&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;.ant-radio-wrapper&amp;#39;&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">label&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">label&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">className&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;ant-radio-wrapper ant-radio-wrapper-checked&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">radio&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">label&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">querySelector&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;input&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">radio&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">radio&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">checked&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 触发 change 事件
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">var&lt;/span> &lt;span class="nx">event&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Event&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;change&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;bubbles&amp;#39;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">radio&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">dispatchEvent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">event&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>千问的帮助下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kd">var&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="k">of&lt;/span> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">querySelectorAll&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;.ant-radio-group&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">radio&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">childNodes&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="nx">querySelector&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;input&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">radio&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">click&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">event&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Event&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;change&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;bubbles&amp;#39;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">radio&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">dispatchEvent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">event&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>【Summary】2024</title><link>https://dyhes.github.io/p/summary2024/</link><pubDate>Mon, 13 Jan 2025 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/summary2024/</guid><description>&lt;h2 id="past">past
&lt;/h2>&lt;ol>
&lt;li>完成毕设&lt;/li>
&lt;li>实习&lt;/li>
&lt;li>完成课程&lt;/li>
&lt;li>完成论文&lt;/li>
&lt;/ol>
&lt;h2 id="now">now
&lt;/h2>&lt;ol>
&lt;li>Postopia&lt;/li>
&lt;li>博客&lt;/li>
&lt;li>看书&lt;/li>
&lt;li>reddit, twitter, BBC News, Tech Church, youtube&lt;/li>
&lt;/ol>
&lt;h2 id="future">future
&lt;/h2>&lt;ol>
&lt;li>英语口语&lt;/li>
&lt;li>完成全部课程&lt;/li>
&lt;li>准备实习&lt;/li>
&lt;li>学习 CUDA&lt;/li>
&lt;li>力扣&lt;/li>
&lt;/ol></description></item><item><title>【Postopia Dev Log】Week 6</title><link>https://dyhes.github.io/p/postopia-dev-logweek-6/</link><pubDate>Fri, 11 Oct 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logweek-6/</guid><description>&lt;p>使用的对象存储使用的是 &lt;a class="link" href="https://cloudinary.com/" target="_blank" rel="noopener"
>Cloudinary&lt;/a> 上传图片时文档不完善,通过将图像转为data url解决&lt;/p>
&lt;p>感觉突然像是卡住了一样，进入了倦怠期，也许是因为某个问题遇到了两三次还是没记住，让我有些灰心了（10.21）&lt;/p>
&lt;p>进度：&lt;/p>
&lt;p>update avatar&lt;/p>
&lt;p>get user info&lt;/p>
&lt;p>show email&lt;/p>
&lt;p>get user&amp;rsquo;s posts and comments&lt;/p>
&lt;h2 id="dependency-injection">Dependency Injection
&lt;/h2>&lt;p>The recommended way of dependency injection in Spring Boot is constructor injection. Here&amp;rsquo;s why it&amp;rsquo;s preferred and how to implement it:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Constructor Injection:
This is the most recommended approach. Here&amp;rsquo;s how it works:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">UserService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">UserRepository&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">userRepository&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">EmailService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emailService&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Autowired&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// Optional in newer Spring versions&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">UserService&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">UserRepository&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">userRepository&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">EmailService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emailService&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">userRepository&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">userRepository&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">emailService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">emailService&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Service methods...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Advantages:&lt;/p>
&lt;ul>
&lt;li>Promotes immutability (dependencies can be final)&lt;/li>
&lt;li>Makes dependencies explicit&lt;/li>
&lt;li>Ensures the bean is fully initialized after construction&lt;/li>
&lt;li>Easier to test (you can easily provide mock dependencies)&lt;/li>
&lt;li>Prevents circular dependencies at compile-time&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Setter Injection:
While not as favored as constructor injection, setter injection can be useful in certain scenarios, particularly when dealing with optional dependencies:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">UserService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">UserRepository&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">userRepository&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Autowired&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">setUserRepository&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">UserRepository&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">userRepository&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">userRepository&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">userRepository&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Service methods...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Setter injection is less common but can be useful for optional dependencies or when you need to change dependencies at runtime.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Field Injection (Not Recommended):
As discussed earlier, this method is generally discouraged:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">UserService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Autowired&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">UserRepository&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">userRepository&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Service methods...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;p>Best Practices:&lt;/p>
&lt;ol>
&lt;li>Use constructor injection for required dependencies.&lt;/li>
&lt;li>Consider setter injection for optional dependencies.&lt;/li>
&lt;li>Avoid field injection in most cases.&lt;/li>
&lt;li>Use the &lt;code>@Autowired&lt;/code> annotation on constructors (optional in newer Spring versions).&lt;/li>
&lt;li>Keep your classes focused and try to limit the number of dependencies.&lt;/li>
&lt;/ol>
&lt;p>Would you like me to elaborate on any specific aspect of dependency injection or provide a more complex example?&lt;/p>
&lt;h3 id="field-injection-not-recommended">Field Injection (not recommended)
&lt;/h3>&lt;p>Field injection in Spring Boot is generally not recommended for several reasons:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Immutability: Field injection makes it difficult to create immutable objects, as the fields need to be non-final to allow injection.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Testability: Classes using field injection are harder to unit test, as you can&amp;rsquo;t easily inject mock dependencies without using a Spring container or reflection.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Dependency hiding: Field injection can hide dependencies, making it less obvious what a class requires to function properly.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Circular dependencies: Field injection can more easily lead to circular dependency issues, which are harder to detect and resolve.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Inversion of Control (IoC) principle: Field injection violates the IoC principle to some extent, as the class is directly asking for its dependencies rather than having them provided.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Reflection use: Spring uses reflection to inject dependencies into private fields, which can have a minor performance impact and bypasses encapsulation.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>Instead of field injection, constructor injection is typically recommended as it addresses these issues. It allows for immutable objects, makes dependencies explicit, and facilitates easier testing and better design.&lt;/p>
&lt;p>Would you like me to elaborate on any of these points or provide an example of constructor injection?&lt;/p>
&lt;h2 id="user-id-exposure">User Id Exposure
&lt;/h2>&lt;p>Exposing a backend user ID in frontend code or APIs is generally &lt;strong>not a good practice&lt;/strong> for several reasons, especially in public-facing applications. Here&amp;rsquo;s why:&lt;/p>
&lt;h3 id="security-risks">&lt;strong>Security Risks&lt;/strong>
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>Enumeration Attacks&lt;/strong>: If user IDs are predictable (like auto-incrementing integers), attackers can guess and try to access other users&amp;rsquo; data, leading to potential data breaches.&lt;/li>
&lt;li>&lt;strong>User Impersonation&lt;/strong>: Exposing a backend ID might allow an attacker to impersonate another user if your application doesn&amp;rsquo;t properly authenticate requests.&lt;/li>
&lt;/ul>
&lt;h3 id="privacy-concerns">&lt;strong>Privacy Concerns&lt;/strong>
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>Sensitive Information&lt;/strong>: In some cases, a user ID may be linked to personal data. Exposing these identifiers could lead to privacy violations, depending on the nature of the application.&lt;/li>
&lt;/ul>
&lt;h3 id="business-logic-exposure">&lt;strong>Business Logic Exposure&lt;/strong>
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>Insights into Structure&lt;/strong>: If your backend user IDs reveal too much about your data structure, an attacker could gain insights into how your system is designed, which may make it easier to exploit vulnerabilities.&lt;/li>
&lt;/ul>
&lt;h3 id="alternatives-and-best-practices">Alternatives and Best Practices
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>Use UUIDs or Random Identifiers&lt;/strong>: Instead of exposing sequential user IDs, consider using universally unique identifiers (UUIDs) or other random tokens that are harder to predict and manipulate.&lt;/li>
&lt;li>&lt;strong>Tokenization&lt;/strong>: Use session tokens or API tokens that map to a user ID on the backend but don&amp;rsquo;t directly expose the ID itself.&lt;/li>
&lt;li>&lt;strong>Limit Information&lt;/strong>: Only expose what is absolutely necessary for the frontend or API consumer. If there&amp;rsquo;s no need to show the user ID, don&amp;rsquo;t include it.&lt;/li>
&lt;li>&lt;strong>Access Control&lt;/strong>: Ensure proper access control and authentication mechanisms so that even if a user ID is exposed, unauthorized users cannot exploit it.&lt;/li>
&lt;/ul>
&lt;p>In summary, it’s a best practice to avoid exposing backend user IDs unless necessary and only if adequate security measures are in place to mitigate risks.&lt;/p></description></item><item><title>【Postopia Dev Log】Week 5</title><link>https://dyhes.github.io/p/postopia-dev-logweek-5/</link><pubDate>Mon, 30 Sep 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logweek-5/</guid><description>&lt;p>如何处理以前没有遇到过的新需求（如给用户发送邮件），需要积累解决问题的能力（实习的时候可以边问边查，做自己的项目只能自己去查，那么如何高效检索并善用AI）,并形成方法论，以便提高能力&lt;/p>
&lt;p>发现 Claude 之前教的在Service Layer 中使用 @AuthenticatedPrincipal 的方法不正确，当时没有及时测试导致现在有若干地方需要修改！！！使用但不要盲目相信&lt;/p>
&lt;p>idea无法热加载， 根据&lt;/p>
&lt;p>Perperlexity&lt;/p>
&lt;blockquote>
&lt;p>In IntelliJ IDEA, ensure that the project is set to build automatically. Go to &lt;code>File&lt;/code> -&amp;gt; &lt;code>Settings&lt;/code> -&amp;gt; &lt;code>Build, Execution, Deployment&lt;/code> -&amp;gt; &lt;code>Compiler&lt;/code>, and check the option &lt;strong>Build project automatically&lt;/strong>. This setting allows the IDE to compile changes without needing to manually trigger a build each time&lt;/p>
&lt;/blockquote>
&lt;p>以及&lt;/p>
&lt;p>&lt;a class="link" href="https://intellij-support.jetbrains.com/hc/en-us/community/posts/4404522882450-Spring-Boot-DevTools-Live-Reload-Not-Working" target="_blank" rel="noopener"
>Spring Boot DevTools Live Reload Not Working&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://intellij-support.jetbrains.com/hc/user_images/6k1gpJeEDLK9V5JSVaUOFQ.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>两者结合解决&lt;/p>
&lt;p>进度：&lt;/p>
&lt;p>change user nickname&lt;/p>
&lt;p>bind email&lt;/p>
&lt;p>本周写论文(实验室横向)，无其他进展&lt;/p>
&lt;p>to do:&lt;/p>
&lt;p>query comment (recursive query, complex)&lt;/p>
&lt;h2 id="space-in-applicationproperties-value">Space in application.properties value
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>Leading and trailing spaces: By default, leading and trailing spaces in property values are trimmed. If you need to preserve them, you can use quotation marks.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Spaces within the value: Spaces within the value are preserved normally.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Escaping: If you want to be explicit about including spaces, you can escape them with a backslash.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>Here are some examples:&lt;/p>
&lt;pre tabindex="0">&lt;code># Space in the middle (works fine)
app.name=My Application
# Preserving leading/trailing spaces with quotes
app.description=&amp;#34; This is a description with spaces &amp;#34;
# Escaping spaces (not necessary, but valid)
app.path=C:\Program\ Files\My\ App
# Multiline values
app.multiline=This is a long \
property value that \
spans multiple lines
&lt;/code>&lt;/pre>&lt;p>If you&amp;rsquo;re having issues with spaces in your application.properties file, you might want to double-check how you&amp;rsquo;re reading the properties in your application. Some methods of reading properties may handle spaces differently.&lt;/p>
&lt;h2 id="store-credentials-in-spring-boot">Store Credentials in spring boot
&lt;/h2>&lt;ol>
&lt;li>Basic approach (not recommended for production):&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-properties" data-lang="properties">&lt;span class="line">&lt;span class="cl">&lt;span class="na">database.username&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">myuser&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">database.password&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">mypassword&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>Using environment variables:
Instead of hardcoding credentials, you can reference environment variables:&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-properties" data-lang="properties">&lt;span class="line">&lt;span class="cl">&lt;span class="na">database.username&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">${DB_USERNAME}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">database.password&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">${DB_PASSWORD}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Then set these environment variables on your system or in your deployment environment.&lt;/p>
&lt;ol start="3">
&lt;li>
&lt;p>Using Spring Boot&amp;rsquo;s config server:
For more secure credential management, especially in production, consider using Spring Cloud Config Server.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Encryption:
Spring Boot supports property encryption. You can use tools like Jasypt to encrypt sensitive properties:&lt;/p>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-properties" data-lang="properties">&lt;span class="line">&lt;span class="cl">&lt;span class="na">database.username&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">ENC(encrypted_username)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">database.password&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">ENC(encrypted_password)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="5">
&lt;li>Externalized configuration:
Store sensitive data in external files and reference them:&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-properties" data-lang="properties">&lt;span class="line">&lt;span class="cl">&lt;span class="na">spring.config.import&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">file:/path/to/secure/credentials.properties&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>For production environments, I recommend using a secrets management system like HashiCorp Vault, AWS Secrets Manager, or Azure Key Vault. These provide more secure ways to manage and access sensitive information.&lt;/p>
&lt;p>Would you like me to elaborate on any of these approaches or provide a more detailed example of implementing one of them in a Spring Boot application?&lt;/p>
&lt;h2 id="env-in-spring-boot">.env in spring boot
&lt;/h2>&lt;p>Using environment variables in a Spring Boot application is a good practice for managing sensitive information like credentials. There are a few ways to work with environment variables, and creating a .env file is one approach, though it requires some additional setup. Let&amp;rsquo;s go through the process:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Using system environment variables:&lt;/p>
&lt;p>This is the most straightforward method. You set the variables in your operating system or deployment environment, and Spring Boot can access them directly.&lt;/p>
&lt;p>For example, you might set variables like this:&lt;/p>
&lt;pre tabindex="0">&lt;code>export DB_USERNAME=myuser
export DB_PASSWORD=mypassword
&lt;/code>&lt;/pre>&lt;p>Then in your application.properties:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-properties" data-lang="properties">&lt;span class="line">&lt;span class="cl">&lt;span class="na">spring.datasource.username&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">${DB_USERNAME}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">spring.datasource.password&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">${DB_PASSWORD}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>Using a .env file:&lt;/p>
&lt;p>While Spring Boot doesn&amp;rsquo;t natively support .env files, you can use a library like &lt;code>dotenv-java&lt;/code> to load variables from a .env file. Here&amp;rsquo;s how:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Add this dependency to your pom.xml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">dependency&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">groupId&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">github&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">cdimascio&lt;/span>&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="n">groupId&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">artifactId&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">dotenv&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">java&lt;/span>&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="n">artifactId&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">version&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">3&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">1&lt;/span>&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="n">version&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="n">dependency&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// In your main application class&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">io.github.cdimascio.dotenv.Dotenv&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nd">@SpringBootApplication&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">MyApplication&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">main&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Dotenv&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dotenv&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Dotenv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">load&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setProperty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;DB_USERNAME&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dotenv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;DB_USERNAME&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setProperty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;DB_PASSWORD&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dotenv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;DB_PASSWORD&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">SpringApplication&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">run&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">MyApplication&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// Create a .env file in your project root&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">DB_USERNAME&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">myuser&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">DB_PASSWORD&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">mypassword&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// In your application.properties&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">spring&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">datasource&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">username&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">DB_USERNAME&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">spring&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">datasource&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">password&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">DB_PASSWORD&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;p>​ Remember to add .env to your .gitignore file to prevent committing sensitive information to version control.&lt;/p>
&lt;ol start="3">
&lt;li>Command-line arguments:&lt;/li>
&lt;/ol>
&lt;p>You can also pass environment variables as command-line arguments when running your application:&lt;/p>
&lt;pre tabindex="0">&lt;code>java -jar myapp.jar --spring.datasource.username=myuser --spring.datasource.password=mypassword
&lt;/code>&lt;/pre>&lt;p>Remember, while using a .env file can be convenient for development, it&amp;rsquo;s &lt;strong>generally not recommended for production environments&lt;/strong>. In production, it&amp;rsquo;s better to use system environment variables, secret management systems, or cloud provider-specific solutions.&lt;/p>
&lt;h2 id="one-time-password">One Time Password
&lt;/h2>&lt;h2 id="pathvariable">@PathVariable
&lt;/h2>&lt;p>To use path parameters with a POST mapping in Spring Boot, you can use the &lt;code>@PathVariable&lt;/code> annotation along with &lt;code>@PostMapping&lt;/code>. Here&amp;rsquo;s a brief example:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@RestController&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nd">@RequestMapping&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/api&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">MyController&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@PostMapping&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/users/{id}&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ResponseEntity&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">createUser&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nd">@PathVariable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Long&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nd">@RequestBody&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">User&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">user&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Process the user creation with the given id&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ResponseEntity&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ok&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;User created with ID: &amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>In this example:&lt;/p>
&lt;ol>
&lt;li>The &lt;code>@PostMapping&lt;/code> annotation defines the endpoint for POST requests.&lt;/li>
&lt;li>The &lt;code>{id}&lt;/code> in the path is a path variable.&lt;/li>
&lt;li>The &lt;code>@PathVariable Long id&lt;/code> parameter in the method signature captures the value of the &lt;code>{id}&lt;/code> path variable.&lt;/li>
&lt;li>You can also include a request body using &lt;code>@RequestBody&lt;/code> if needed.&lt;/li>
&lt;/ol>
&lt;p>To call this endpoint, you would send a POST request to a URL like &lt;code>/api/users/123&lt;/code>, where &lt;code>123&lt;/code> is the ID.&lt;/p>
&lt;p>Would you like me to explain any part of this in more detail or show you how to handle multiple path variables?&lt;/p>
&lt;h2 id="references">References
&lt;/h2>&lt;p>&lt;a class="link" href="https://www.baeldung.com/spring-email" target="_blank" rel="noopener"
>Guide to Spring Email&lt;/a>&lt;/p></description></item><item><title>【IDEA】live reload</title><link>https://dyhes.github.io/p/idealive-reload/</link><pubDate>Mon, 23 Sep 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/idealive-reload/</guid><description>&lt;p>Perperlexity&lt;/p>
&lt;blockquote>
&lt;p>In IntelliJ IDEA, ensure that the project is set to build automatically. Go to &lt;code>File&lt;/code> -&amp;gt; &lt;code>Settings&lt;/code> -&amp;gt; &lt;code>Build, Execution, Deployment&lt;/code> -&amp;gt; &lt;code>Compiler&lt;/code>, and check the option &lt;strong>Build project automatically&lt;/strong>. This setting allows the IDE to compile changes without needing to manually trigger a build each time&lt;/p>
&lt;/blockquote>
&lt;p>以及&lt;/p>
&lt;p>&lt;img src="https://intellij-support.jetbrains.com/hc/user_images/6k1gpJeEDLK9V5JSVaUOFQ.png"
loading="lazy"
alt="img"
>&lt;/p></description></item><item><title>【OPT】Solutions</title><link>https://dyhes.github.io/p/optsolutions/</link><pubDate>Mon, 23 Sep 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/optsolutions/</guid><description>&lt;p>If you&amp;rsquo;re specifically looking for number sequence-based authentication codes (like OTPs, often consisting of 6 digits), the following options are most suitable:&lt;/p>
&lt;h2 id="1-totp-time-based-one-time-password-using-twilio-otp-or-java-totp">1. &lt;strong>TOTP (Time-based One-Time Password) using &lt;code>twilio-otp&lt;/code> or &lt;code>java-totp&lt;/code>&lt;/strong>
&lt;/h2>&lt;p>&lt;strong>TOTP&lt;/strong> (Time-based One-Time Password) generates numeric sequences that change periodically (e.g., every 30 seconds). It is a commonly used mechanism for two-factor authentication (2FA), and it generates a sequence of numbers, typically 6 digits.&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>Maven dependency&lt;/strong>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>com.warrenstrange&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>googleauth&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;version&amp;gt;&lt;/span>1.4.0&lt;span class="nt">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;strong>Example usage (with &lt;code>java-totp&lt;/code>)&lt;/strong>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">com.warrenstrange.googleauth.GoogleAuthenticator&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">GoogleAuthenticator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gAuth&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">GoogleAuthenticator&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">otp&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gAuth&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getTotpPassword&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;your-secret-key&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>This will generate a 6-digit numeric OTP based on a time-window.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="2-hotp-hmac-based-one-time-password-using-commons-codec">2. &lt;strong>HOTP (HMAC-based One-Time Password) using &lt;code>commons-codec&lt;/code>&lt;/strong>
&lt;/h2>&lt;p>&lt;strong>HOTP&lt;/strong> generates numeric sequences based on a counter (not time-based like TOTP). It is also a number-based sequence and typically results in a 6-digit or longer OTP.&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>Maven dependency&lt;/strong>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>commons-codec&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>commons-codec&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;version&amp;gt;&lt;/span>1.15&lt;span class="nt">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;strong>Example usage&lt;/strong>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">org.apache.commons.codec.digest.HmacUtils&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">org.apache.commons.codec.binary.Base32&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Base32&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">decode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;your-secret-key&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kt">long&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">counter&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">12345L&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// A counter you maintain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">otp&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HmacUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">hmacSha1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">counter&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>This approach generates a numeric sequence based on a secret key and counter value.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="3-custom-number-generation-using-securerandom">3. &lt;strong>Custom Number Generation using &lt;code>SecureRandom&lt;/code>&lt;/strong>
&lt;/h2>&lt;p>If you just need a random sequence of numbers (e.g., for simple email verification codes), you can use &lt;code>SecureRandom&lt;/code> to generate a numeric sequence.&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Example usage&lt;/strong>:
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">java.security.SecureRandom&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">SecureRandom&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SecureRandom&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">otp&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">100000&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">nextInt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">900000&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// Generates a 6-digit number&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>This will generate a 6-digit numeric OTP, which is simple and effective for most email verification needs.&lt;/li>
&lt;/ul>
&lt;h2 id="summary">Summary:
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>TOTP&lt;/strong> and &lt;strong>HOTP&lt;/strong> are ideal if you need more secure, standardized OTPs with time-based or counter-based mechanisms (usually for 2FA).&lt;/li>
&lt;li>&lt;strong>Custom random number generation&lt;/strong> using &lt;code>SecureRandom&lt;/code> is the simplest method for generating a numeric sequence, typically for less security-critical scenarios like email verification.&lt;/li>
&lt;/ul>
&lt;p>If you need a secure numeric OTP, &lt;strong>TOTP&lt;/strong> or &lt;strong>HOTP&lt;/strong> is the better choice, especially for systems requiring re-verification over time or multiple verification attempts.&lt;/p></description></item><item><title>【Redis】In Spring Boot</title><link>https://dyhes.github.io/p/redisin-spring-boot/</link><pubDate>Mon, 23 Sep 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/redisin-spring-boot/</guid><description>&lt;h2 id="dependency">dependency
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">dependency&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">groupId&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">org&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">springframework&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">boot&lt;/span>&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="n">groupId&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">artifactId&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">spring&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">boot&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">starter&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">redis&lt;/span>&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="n">artifactId&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="n">dependency&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="applicationproperties">application.properties
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">spring&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">redis&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">host&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">localhost&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">spring&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">redis&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">port&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">6379&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="composeyaml">compose.yaml
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-dockerfile" data-lang="dockerfile">&lt;span class="line">&lt;span class="cl">redis:&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span> &lt;span class="c1"># 与 ’redis:latest&amp;#39; subtle differences&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span> image: redis:latest&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span> container_name: postopia-redis&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span> ports:&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span> - &lt;span class="s2">&amp;#34;6379:6379&amp;#34;&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="config">Config
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Configuration&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">RedisConfig&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Bean&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">RedisConnectionFactory&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">redisConnectionFactory&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LettuceConnectionFactory&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Bean&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">RedisTemplate&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">redisTemplate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">RedisConnectionFactory&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">connectionFactory&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">RedisTemplate&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">template&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">RedisTemplate&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">template&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setConnectionFactory&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">connectionFactory&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Use String serializers for keys&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">template&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setKeySerializer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">StringRedisSerializer&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">template&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setValueSerializer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">StringRedisSerializer&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">template&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="service">Service
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">RedisService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Autowired&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">RedisTemplate&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">redisTemplate&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">setByMinute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">minute&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">redisTemplate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">opsForValue&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">minute&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TimeUnit&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">MINUTES&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">redisTemplate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">opsForValue&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">delete&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">redisTemplate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">delete&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>【Postopia Dev Log】Week 4</title><link>https://dyhes.github.io/p/postopia-dev-logweek-4/</link><pubDate>Fri, 20 Sep 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logweek-4/</guid><description>&lt;p>之前都是在mac上进行开发，现在换到Windows上，跑不起来&lt;/p>
&lt;p>原来是因为自定义query方法里的字段设置不对（应与entity中字段而非表字段保持一致 ）&lt;/p>
&lt;p>之前在mac上用code跑项目，运行时并没有查出这个错误，现在在win上用idea跑检查出来了&lt;/p>
&lt;p>经过接近一个月（生活琐事与开学前的休息）再重新打开项目，忘了该从哪里继续项目，以后要注意记录开发进度&lt;/p>
&lt;p>进度：&lt;/p>
&lt;p>like, dislike post, comment&lt;/p>
&lt;p>query like status in post&lt;/p>
&lt;p>update user nickname&lt;/p>
&lt;p>to do:&lt;/p>
&lt;p>query comment (recursive query, complex)&lt;/p>
&lt;h2 id="spring-boot-application-configure-port">spring boot application configure port
&lt;/h2>&lt;p>resource/application.properties&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">server&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">port&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">8081&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="authorizedprincipal-related">@AuthorizedPrincipal related
&lt;/h2>&lt;blockquote>
&lt;p>i defined &amp;ldquo;void likePost(Long id, @AuthenticationPrincipal User user);&amp;rdquo; in an interface, should its implementation method signature be &amp;ldquo;void likePost(Long id, @AuthenticationPrincipal User user)&amp;rdquo; or &amp;ldquo;void likePost(Long id, User user);&amp;rdquo; is enough?&lt;/p>
&lt;/blockquote>
&lt;p>The implementation method signature should match the interface declaration exactly, &lt;strong>including any annotations&lt;/strong>.&lt;/p>
&lt;p>The &lt;code>@AuthenticationPrincipal&lt;/code> annotation is significant and should be retained in the implementation for the following reasons:&lt;/p>
&lt;ol>
&lt;li>Consistency: The implementation should match the interface definition to maintain consistency and avoid confusion.&lt;/li>
&lt;li>Functionality: The &lt;code>@AuthenticationPrincipal&lt;/code> annotation is typically used in Spring Security to automatically resolve the currently authenticated user. Removing it might affect how the user object is populated or handled by the framework.&lt;/li>
&lt;li>Clarity: Keeping the annotation in the implementation makes it clear to other developers that this method expects the authenticated user to be injected.&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>idea auto implemenation doesn&amp;rsquo;t retain the @AuthenticationPrincipal annotation&lt;/p>
&lt;/blockquote>
&lt;p>You&amp;rsquo;re right to notice that discrepancy. IDEs like IntelliJ IDEA sometimes don&amp;rsquo;t automatically retain certain annotations when generating method implementations. This is a known limitation in some IDE auto-implementation features.&lt;/p>
&lt;p>Understand the issue: The IDE&amp;rsquo;s auto-implementation feature is dropping the &lt;code>@AuthenticationPrincipal&lt;/code> annotation, which is not the desired behavior.&lt;/p>
&lt;p>Correct approach: You should manually add the annotation back to the implementation method.&lt;/p>
&lt;h2 id="case-in-sql">CASE in sql
&lt;/h2>&lt;p>Case statements in SQL allow you to &lt;strong>add conditional logic&lt;/strong> to your queries. They&amp;rsquo;re useful for categorizing data or performing different calculations based on specific conditions.&lt;/p>
&lt;p>The general syntax is:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">CASE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">WHEN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">condition1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">THEN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">result1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">WHEN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">condition2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">THEN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">result2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">ELSE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">default_result&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">END&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Key points:&lt;/p>
&lt;ol>
&lt;li>You can have multiple WHEN-THEN pairs.&lt;/li>
&lt;li>The ELSE clause is optional. If omitted and no conditions are met, it returns NULL.&lt;/li>
&lt;li>CASE statements can be used in SELECT, WHERE, and ORDER BY clauses.&lt;/li>
&lt;/ol>
&lt;p>Here&amp;rsquo;s a simple example:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">SELECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">product_name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">price&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">CASE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">WHEN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">price&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">THEN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;Low&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">WHEN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">price&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">price&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">50&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">THEN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;Medium&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">ELSE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;High&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">END&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">price_category&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">products&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>This query categorizes products based on their price.&lt;/p>
&lt;h2 id="join-and-left-join">JOIN and LEFT JOIN
&lt;/h2>&lt;p>JOIN and LEFT JOIN are not the same. They are different types of SQL join operations that produce different results. Let me explain the key differences:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>JOIN (or INNER JOIN):&lt;/p>
&lt;ul>
&lt;li>Returns only the rows that have matching values in both tables.&lt;/li>
&lt;li>If a row doesn&amp;rsquo;t have a match in the other table, it&amp;rsquo;s &lt;strong>excluded&lt;/strong> from the result set.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>LEFT JOIN (or LEFT OUTER JOIN):&lt;/p>
&lt;ul>
&lt;li>Returns all rows from the left table, and the matched rows from the right table.&lt;/li>
&lt;li>If there&amp;rsquo;s no match in the right table, the result still contains the row from the left table, with &lt;strong>NULL values&lt;/strong> for the right table&amp;rsquo;s columns.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>Here&amp;rsquo;s an example to illustrate:&lt;/p>
&lt;p>Suppose we have two tables:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Employees&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Projects&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">ID&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ID&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ProjectName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">EmployeeID&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- ---- -- ----------- ----------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Alice&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Alpha&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Bob&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Beta&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Charlie&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Gamma&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Delta&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Using INNER JOIN:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ProjectName&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Employees&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">JOIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Projects&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ID&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">EmployeeID&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Result:&lt;/p>
&lt;pre tabindex="0">&lt;code>Name ProjectName
---- -----------
Alice Alpha
Alice Beta
Bob Gamma
&lt;/code>&lt;/pre>&lt;p>Using LEFT JOIN:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ProjectName&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Employees&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">LEFT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">JOIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Projects&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ID&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">EmployeeID&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Result:&lt;/p>
&lt;pre tabindex="0">&lt;code>Name ProjectName
---- -----------
Alice Alpha
Alice Beta
Bob Gamma
Charlie NULL
&lt;/code>&lt;/pre>&lt;p>Key differences in the results:&lt;/p>
&lt;ol>
&lt;li>INNER JOIN doesn&amp;rsquo;t include Charlie because he has no matching project.&lt;/li>
&lt;li>LEFT JOIN includes Charlie with a NULL project.&lt;/li>
&lt;li>Neither join includes the Delta project because it has no matching employee.&lt;/li>
&lt;/ol>
&lt;p>In summary, use JOIN when you only want results with matches in both tables, and use LEFT JOIN when you want all rows from the left table, regardless of whether there&amp;rsquo;s a match in the right table.&lt;/p>
&lt;p>Would you like me to elaborate on any part of this explanation or provide more examples?&lt;/p>
&lt;h2 id="extra-query-for-user-opinions">extra query for user opinions
&lt;/h2>&lt;blockquote>
&lt;p>will using an extra query to get user opinion information rather than querying it by above method be more efficient?&lt;/p>
&lt;/blockquote>
&lt;p>That&amp;rsquo;s an excellent question. The efficiency of using a single query versus multiple queries depends on several factors. Let&amp;rsquo;s analyze both approaches:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Single Query Approach (current method):&lt;/p>
&lt;ul>
&lt;li>Pros:
&lt;ul>
&lt;li>Reduces the number of database round trips&lt;/li>
&lt;li>Can be more efficient for &lt;strong>smaller result sets&lt;/strong>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Cons:
&lt;ul>
&lt;li>More complex query&lt;/li>
&lt;li>Potential for larger result set due to the LEFT JOIN&lt;/li>
&lt;li>May be slower for large datasets &lt;strong>due to the join operation&lt;/strong>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Separate Queries Approach:&lt;/p>
&lt;ul>
&lt;li>Pros:
&lt;ul>
&lt;li>Simpler, more focused queries&lt;/li>
&lt;li>Can be more efficient for large datasets&lt;/li>
&lt;li>Allows for more granular caching strategies&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Cons:
&lt;ul>
&lt;li>Multiple database round trips&lt;/li>
&lt;li>Potential for N+1 query problem if not implemented carefully&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>To determine which approach is more efficient, consider the following factors:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>Dataset size:&lt;/strong> For smaller datasets, the single query approach might be faster. For larger datasets, separate queries could perform better.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Query complexity:&lt;/strong> If the join operation significantly complicates the query or slows down execution, separate queries might be preferable.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Caching strategies:&lt;/strong> Separate queries allow for more granular caching of post information and user opinions.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Network latency:&lt;/strong> If network latency between your application and database is high, fewer round trips (single query) might be beneficial.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Database indexes:&lt;/strong> Proper indexing can significantly impact the performance of both approaches.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>Given these considerations, here&amp;rsquo;s a potential implementation using separate queries:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">PostService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">PostRepository&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">postRepository&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">OpinionRepository&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">opinionRepository&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Constructor injection...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Page&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">PostInfo&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getPostsInSpace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Long&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">spaceId&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Long&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">userId&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">page&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Pageable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pageable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">PageRequest&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">of&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">page&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Page&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">PostInfo&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">posts&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">postRepository&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">findPostsInSpace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">spaceId&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pageable&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Long&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">postIds&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">posts&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getContent&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">stream&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">map&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">PostInfo&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">getId&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">collect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Collectors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">toList&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Long&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">UserOpinion&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">opinions&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">opinionRepository&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">findUserOpinionsByPostIds&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">userId&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">postIds&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">posts&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getContent&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">forEach&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">post&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">post&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setUserOpinion&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">opinions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getOrDefault&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">post&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getId&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">UserOpinion&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">NO_OPINION&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">posts&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nd">@Repository&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">interface&lt;/span> &lt;span class="nc">PostRepository&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">extends&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JpaRepository&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Post&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Long&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Query&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;SELECT NEW com.heslin.postopia.dto.post.PostInfo(p.id, p.subject, p.content, p.positiveCount, p.negativeCount, p.commentCount, u.username, u.nickname, u.avatar) FROM Post p JOIN p.user u JOIN p.space s WHERE s.id = :spaceId ORDER BY p.createdAt DESC&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Page&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">PostInfo&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">findPostsInSpace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nd">@Param&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;spaceId&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Long&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">spaceId&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Pageable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pageable&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nd">@Repository&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">interface&lt;/span> &lt;span class="nc">OpinionRepository&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">extends&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JpaRepository&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Opinion&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Long&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Query&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;SELECT o.post.id as postId, CASE WHEN o.isPositive = true THEN &amp;#39;LIKE&amp;#39; WHEN o.isPositive = false THEN &amp;#39;DISLIKE&amp;#39; ELSE &amp;#39;NO_OPINION&amp;#39; END as opinion FROM Opinion o WHERE o.user.id = :userId AND o.post.id IN :postIds&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">[]&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">findUserOpinionsByPostIds&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nd">@Param&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;userId&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Long&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">userId&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nd">@Param&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;postIds&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Long&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">postIds&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Long&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">UserOpinion&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">findUserOpinionsByPostIds&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Long&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">userId&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Long&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">postIds&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">findUserOpinionsByPostIds&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">userId&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">postIds&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="na">stream&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">collect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Collectors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">toMap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">arr&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Long&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">arr&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">arr&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">UserOpinion&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">valueOf&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">arr&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>This approach allows you to:&lt;/p>
&lt;ol>
&lt;li>Fetch posts without the complexity of joining with the opinions table.&lt;/li>
&lt;li>Retrieve user opinions for only the fetched posts in a separate query.&lt;/li>
&lt;li>Combine the results in memory.&lt;/li>
&lt;/ol>
&lt;p>To determine which method is more efficient for your specific use case, I recommend:&lt;/p>
&lt;ol>
&lt;li>Implement both approaches.&lt;/li>
&lt;li>Create performance tests with various dataset sizes and query patterns.&lt;/li>
&lt;li>Profile the application to measure actual performance differences.&lt;/li>
&lt;li>Consider the maintainability and readability of each approach in your codebase.&lt;/li>
&lt;/ol>
&lt;p>Remember, premature optimization can lead to unnecessary complexity. Start with the approach that&amp;rsquo;s most straightforward for your team to implement and maintain, then optimize if and when performance becomes an issue based on real-world usage patterns.&lt;/p>
&lt;h2 id="common-table-expressions">Common Table Expressions
&lt;/h2>&lt;p>Common Table Expressions (CTEs) in SQL are temporary named result sets that you can reference within a SELECT, INSERT, UPDATE, DELETE, or MERGE statement. They are defined using a WITH clause at the beginning of a query. Here&amp;rsquo;s a brief explanation of CTEs:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Syntax:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">WITH&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cte_name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">...&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cte_name&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>Key features:&lt;/p>
&lt;ul>
&lt;li>Improve readability by breaking complex queries into simpler, named parts&lt;/li>
&lt;li>Can be referenced multiple times within the main query&lt;/li>
&lt;li>Useful for recursive queries&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Example:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">WITH&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sales_summary&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">product_id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">SUM&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">quantity&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">total_quantity&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">SUM&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">price&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">quantity&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">total_revenue&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sales&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">GROUP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">product_id&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">product_name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">total_quantity&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">total_revenue&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">products&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">JOIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sales_summary&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">product_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">product_id&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;p>CTEs are particularly useful for complex queries, hierarchical data, and when you need to reference the same subquery multiple times.&lt;/p>
&lt;p>Would you like me to elaborate on any specific aspect of Common Table Expressions?&lt;/p></description></item><item><title>【Hugo】Cache</title><link>https://dyhes.github.io/p/hugocache/</link><pubDate>Tue, 10 Sep 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/hugocache/</guid><description>&lt;p>hugo新帖子的Tags添加失败，老帖子的Tags修改可以产生变化
通过
hugo &amp;ndash;gc &amp;ndash;minify
清除缓存解决问题&lt;/p></description></item><item><title>【Postopia Dev Log】Week 3</title><link>https://dyhes.github.io/p/postopia-dev-logweek-3/</link><pubDate>Fri, 16 Aug 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logweek-3/</guid><description>&lt;h1 id="week3">Week3
&lt;/h1>&lt;p>写评论查询的时候遇到了递归查询和递归结构构建的问题，这样的问题是表层学习而不真正深入使用知识、框架时难以遇到并学习如何解决的。&lt;/p>
&lt;h2 id="enum-in-query">enum in @Query
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Query&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;select new com.heslin.postopia.dto.post.PostSummary(p.subject, p.positive_count, p.negative_count, p.comment_count, u.username, u.nickname, u.avatar) from Post p JOIN p.user u where p.space_id = :id and p.status != com.heslin.postopia.enums.PostStatus.DRAFT&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="record">record
&lt;/h2>&lt;h3 id="generics">Generics
&lt;/h3>&lt;p>Records in Java can be combined with generics. Records, introduced in Java 14 as a preview feature and made stable in Java 16, provide a concise way to model immutable data. Generics allow types (classes and interfaces) to be parameters when defining classes, interfaces, and methods. Combining these two can lead to more flexible and reusable code.&lt;/p>
&lt;p>Here is an example of how you can define and use a generic record in Java:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Define a generic record&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">record&lt;/span> &lt;span class="nc">Pair&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">V&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// Usage example&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">Main&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">main&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Pair&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pair&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Pair&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;age&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">30&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Key: &amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pair&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">key&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Value: &amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pair&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">value&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>In this example:&lt;/p>
&lt;ol>
&lt;li>&lt;code>Pair&amp;lt;K, V&amp;gt;&lt;/code> is a generic record with two type parameters, &lt;code>K&lt;/code> and &lt;code>V&lt;/code>.&lt;/li>
&lt;li>The &lt;code>Pair&lt;/code> record has two components, &lt;code>key&lt;/code> and &lt;code>value&lt;/code>, of types &lt;code>K&lt;/code> and &lt;code>V&lt;/code> respectively.&lt;/li>
&lt;li>When creating an instance of &lt;code>Pair&lt;/code>, you specify the actual types to use, such as &lt;code>String&lt;/code> and &lt;code>Integer&lt;/code> in this case.&lt;/li>
&lt;li>You can then use the &lt;code>key()&lt;/code> and &lt;code>value()&lt;/code> methods to access the components of the record.&lt;/li>
&lt;/ol>
&lt;p>This example illustrates how generics can be seamlessly integrated with records to create versatile and type-safe data structures.&lt;/p>
&lt;h3 id="extension">Extension
&lt;/h3>&lt;p>No, records in Java cannot be extended. Records are implicitly &lt;code>final&lt;/code>, meaning they cannot be subclassed. This design choice aligns with the primary purpose of records, which is to provide a simple and concise way to create immutable data carriers. Allowing inheritance would complicate this model and could undermine the immutability guarantees that records provide.&lt;/p>
&lt;p>Here&amp;rsquo;s a brief overview of some key characteristics of records:&lt;/p>
&lt;ol>
&lt;li>&lt;strong>Immutability&lt;/strong>: Records are designed to be immutable. All fields in a record are implicitly &lt;code>private&lt;/code> and &lt;code>final&lt;/code>.&lt;/li>
&lt;li>&lt;strong>Compact Syntax&lt;/strong>: Records provide a compact syntax for declaring classes that are primarily used to hold data.&lt;/li>
&lt;li>&lt;strong>Final and Non-Extendable&lt;/strong>: Records are implicitly &lt;code>final&lt;/code>, meaning you cannot extend a record class.&lt;/li>
&lt;/ol>
&lt;p>If you need to share common functionality or data among multiple types, consider using composition or interfaces instead of inheritance. Here is an example using composition:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Common functionality encapsulated in a class&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">CommonData&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">commonField&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">CommonData&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">commonField&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">commonField&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">commonField&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getCommonField&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">commonField&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// Record using composition&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">record&lt;/span> &lt;span class="nc">SpecializedRecord&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">specificField&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">CommonData&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">commonData&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">Main&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">main&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">CommonData&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">commonData&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">CommonData&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Shared Data&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">SpecializedRecord&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">record&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SpecializedRecord&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Specific Data&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">commonData&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Specific Field: &amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">record&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">specificField&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Common Field: &amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">record&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">commonData&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">getCommonField&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>In this example, the &lt;code>CommonData&lt;/code> class encapsulates the shared functionality, and the &lt;code>SpecializedRecord&lt;/code> record uses composition to include this common data. This approach maintains the benefits of immutability and concise syntax while avoiding the pitfalls of inheritance.&lt;/p>
&lt;h2 id="break-circular-dependencies">Break circular dependencies
&lt;/h2>&lt;p>In Spring Boot, it&amp;rsquo;s generally not advisable to have two services autowire each other as fields because it can create a circular dependency. Circular dependencies can make your application context fail to start and are generally considered a bad design practice.&lt;/p>
&lt;p>However, if you still need to achieve this, there are some workaround strategies. Here are a few approaches:&lt;/p>
&lt;h3 id="1-setter-injection">1. &lt;strong>Setter Injection&lt;/strong>
&lt;/h3>&lt;p>This method uses setter methods instead of field injection to avoid circular dependencies.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">ServiceA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ServiceB&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">serviceB&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Autowired&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">setServiceB&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ServiceB&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">serviceB&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">serviceB&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">serviceB&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">methodA&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">serviceB&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">methodB&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nd">@Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">ServiceB&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ServiceA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">serviceA&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Autowired&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">setServiceA&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ServiceA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">serviceA&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">serviceA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">serviceA&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">methodB&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">serviceA&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">methodA&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="2-lazy-annotation">2. &lt;strong>&lt;code>@Lazy&lt;/code> Annotation&lt;/strong>
&lt;/h3>&lt;p>You can use the &lt;code>@Lazy&lt;/code> annotation to delay the initialization of one of the services, breaking the circular dependency.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">ServiceA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ServiceB&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">serviceB&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Autowired&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">ServiceA&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nd">@Lazy&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ServiceB&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">serviceB&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">serviceB&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">serviceB&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">methodA&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">serviceB&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">methodB&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nd">@Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">ServiceB&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ServiceA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">serviceA&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Autowired&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">ServiceB&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nd">@Lazy&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ServiceA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">serviceA&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">serviceA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">serviceA&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">methodB&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">serviceA&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">methodA&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="3-redesign-your-services">3. &lt;strong>Redesign Your Services&lt;/strong>
&lt;/h3>&lt;p>Often, circular dependencies are a sign that your service design needs to be refactored. Consider whether you can split responsibilities differently to avoid the circular dependency. For example, you could introduce a third service or a common interface.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">ServiceA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">CommonService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">commonService&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Autowired&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">ServiceA&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">CommonService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">commonService&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">commonService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">commonService&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">methodA&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">commonService&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">commonMethod&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nd">@Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">ServiceB&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">CommonService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">commonService&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Autowired&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">ServiceB&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">CommonService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">commonService&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">commonService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">commonService&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">methodB&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">commonService&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">commonMethod&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nd">@Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">CommonService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">commonMethod&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Common logic here&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="4-application-context">4. &lt;strong>Application Context&lt;/strong>
&lt;/h3>&lt;p>You can also manually fetch the beans from the application context, but this is generally not recommended and should be used as a last resort.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">ServiceA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">implements&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ApplicationContextAware&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ServiceB&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">serviceB&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ApplicationContext&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">applicationContext&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">setApplicationContext&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ApplicationContext&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">applicationContext&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeansException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">applicationContext&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">applicationContext&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@PostConstruct&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">init&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">serviceB&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">applicationContext&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getBean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ServiceB&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">methodA&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">serviceB&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">methodB&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nd">@Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">ServiceB&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ServiceA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">serviceA&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Autowired&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">ServiceB&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ServiceA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">serviceA&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">serviceA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">serviceA&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">methodB&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">serviceA&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">methodA&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="conclusion">Conclusion
&lt;/h3>&lt;p>While you can technically create circular dependencies using these methods, it&amp;rsquo;s usually better to refactor your code to avoid such designs. Circular dependencies can make your code harder to understand, test, and maintain. Consider whether there are better ways to structure your services to keep them decoupled.&lt;/p>
&lt;h2 id="recursive-model-query">Recursive Model Query
&lt;/h2>&lt;p>Check post with the same name for details&lt;/p></description></item><item><title>【Postopia Dev Log】Week 2</title><link>https://dyhes.github.io/p/postopia-dev-logweek-2/</link><pubDate>Fri, 19 Jul 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logweek-2/</guid><description>&lt;p>按部就班进行开发，发现自己可能会在一些自己认知范围内的性能优化点特别在意，又会觉得优化需要对语言底层有深刻的认知，接近于一个无穷无尽的过程，然后对自己的语言功底感到焦虑。&lt;/p>
&lt;h2 id="delete-method">Delete method
&lt;/h2>&lt;p>Yes, derived delete methods in Spring Data JPA repositories can return a boolean value. When you define a derived delete method to return a boolean, it will indicate whether any records were actually deleted.&lt;/p>
&lt;h2 id="entitylistenersauditingentitylistenerclass">@EntityListeners(AuditingEntityListener.class)
&lt;/h2>&lt;p>除&lt;/p>
&lt;ul>
&lt;li>@EnableJpaAuditting&lt;/li>
&lt;li>@CreateDate
还需要加上：&lt;/li>
&lt;li>&lt;strong>@EntityListeners(AuditingEntityListener.class)&lt;/strong>&lt;/li>
&lt;/ul>
&lt;h2 id="data-transfer-objects">Data Transfer Objects 
&lt;/h2>&lt;p>query only the needed fields in Spring Data JPA for several reasons:&lt;/p>
&lt;h3 id="performance-optimization">Performance optimization:
&lt;/h3>&lt;ul>
&lt;li>By querying only the required fields, you reduce the amount of data transferred between the database and your application, which can improve performance, especially for large datasets.&lt;/li>
&lt;/ul>
&lt;h3 id="reduced-network-traffic">Reduced network traffic:
&lt;/h3>&lt;ul>
&lt;li>Transferring only the necessary data minimizes network usage, which is particularly beneficial in distributed systems or when dealing with remote clients.&lt;/li>
&lt;/ul>
&lt;h3 id="separation-of-concerns">Separation of concerns:
&lt;/h3>&lt;ul>
&lt;li>DTOs help separate the data representation used in your application’s business logic from the underlying database entities, providing a clear boundary between layers.&lt;/li>
&lt;/ul>
&lt;h3 id="flexibility-and-maintainability">Flexibility and maintainability:
&lt;/h3>&lt;ul>
&lt;li>DTOs allow you to shape the data according to specific use cases, making it easier to evolve your API without affecting the underlying data model.&lt;/li>
&lt;/ul>
&lt;h3 id="security">Security:
&lt;/h3>&lt;ul>
&lt;li>By using DTOs, you can control which data is exposed to the client, reducing the risk of accidentally exposing sensitive information.&lt;/li>
&lt;/ul>
&lt;h3 id="avoid-lazy-loading-issues">Avoid lazy loading issues:
&lt;/h3>&lt;ul>
&lt;li>When working with JPA entities, lazy-loaded associations can cause performance problems or errors if accessed outside of a transaction. DTOs help avoid these issues by containing only the required data.&lt;/li>
&lt;/ul>
&lt;h2 id="var-keyword">&lt;code>Var&lt;/code> keyword
&lt;/h2>&lt;p>In Java, the var keyword was introduced in &lt;strong>Java 10&lt;/strong> as part of the &lt;strong>Local Variable Type Inference feature&lt;/strong>. It allows you to declare local variables without explicitly specifying their type. The compiler infers the type &lt;strong>based on the initialization expression&lt;/strong>.
Here are some key points about var in Java:&lt;/p>
&lt;ul>
&lt;li>usage&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">variableName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">initialValue&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>Scope: 
var can only be used for &lt;strong>local variables&lt;/strong> inside methods or loops. It cannot be used for fields, method parameters, or return types.&lt;/li>
&lt;li>Initialization:
Variables declared with var must be &lt;strong>initialized in the same statement&lt;/strong>.&lt;/li>
&lt;li>Type Inference:
The compiler infers the type based on the right-hand side of the assignment.&lt;/li>
&lt;li>Limitations:
&lt;ul>
&lt;li>Cannot be used with null literals&lt;/li>
&lt;li>Cannot be used with array initializers&lt;/li>
&lt;li>Cannot be used in a compound declaration (declaring multiple variables in one statement)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Examples&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Basic usage&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">var&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;John&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// inferred as String&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">var&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">30&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// inferred as int&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">var&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">list&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ArrayList&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// inferred as ArrayList&amp;lt;String&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// In a for loop&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">var&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">10&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// With lambda expressions&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">var&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">comparator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">compareTo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s2&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// With try-with-resources&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">var&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">reader&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BufferedReader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">FileReader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;file.txt&amp;#34;&lt;/span>&lt;span class="p">)))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Use reader&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>Benefits of using var:
&lt;ul>
&lt;li>Reduces boilerplate code, especially with long type names.&lt;/li>
&lt;li>Improves &lt;strong>readability&lt;/strong> in some cases, particularly with generic types.&lt;/li>
&lt;li>Allows the type to change without changing the variable declaration.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Considerations:
&lt;ul>
&lt;li>Use var judiciously. Sometimes explicit type declarations can improve code clarity.&lt;/li>
&lt;li>var doesn’t make Java a dynamically-typed language. The type is still &lt;strong>determined at compile-time&lt;/strong>.&lt;/li>
&lt;li>IDEs can usually show you the inferred type, which helps with code understanding.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="other-local-variable-type-inference-feature">Other Local Variable Type Inference feature
&lt;/h2>&lt;ul>
&lt;li>Diamond Operator (&amp;lt;&amp;gt;):
Introduced in Java 7, it allows type inference for generic class instantiation.
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">list&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ArrayList&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// Instead of new ArrayList&amp;lt;String&amp;gt;() &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>Method References:
Introduced in Java 8, method references work with type inference.
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">names&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Arrays&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">asList&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Alice&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Bob&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Charlie&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">names&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">forEach&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">println&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>Try-with-resources
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">var&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">input&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">FileInputStream&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;file.txt&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Use input&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h2 id="repository-layer-referencing">Repository Layer Referencing
&lt;/h2>&lt;h3 id="one-repository-and-multiple-services">One @Repository and Multiple @Services
&lt;/h3>&lt;h4 id="pros">Pros
&lt;/h4>&lt;ul>
&lt;li>Promotes &lt;strong>separation of concerns&lt;/strong>&lt;/li>
&lt;li>Follows the &lt;strong>Single Responsibility Principle&lt;/strong>&lt;/li>
&lt;li>Can lead to better code organization and maintainability&lt;/li>
&lt;li>Easier to manage &lt;strong>transactions&lt;/strong> across multiple services&lt;/li>
&lt;/ul>
&lt;h4 id="cons">Cons
&lt;/h4>&lt;ul>
&lt;li>May require more classes and interfaces&lt;/li>
&lt;li>Can potentially lead to more complex dependency injection&lt;/li>
&lt;/ul>
&lt;h3 id="multiple-repositories">Multiple @Repositories
&lt;/h3>&lt;h4 id="pros-1">Pros
&lt;/h4>&lt;ul>
&lt;li>Can &lt;strong>simplify&lt;/strong> the service layer if operations frequently require data from multiple repositories&lt;/li>
&lt;li>Reduces the number of classes and interfaces&lt;/li>
&lt;li>May be more straightforward for simpler applications&lt;/li>
&lt;/ul>
&lt;h4 id="cons-1">⠀Cons
&lt;/h4>&lt;ul>
&lt;li>Can lead to a “fat” service class with too many responsibilities&lt;/li>
&lt;li>May make it &lt;strong>harder to maintain&lt;/strong> and test the service class&lt;/li>
&lt;li>Could potentially &lt;strong>violate&lt;/strong> the Single Responsibility Principle&lt;/li>
&lt;/ul>
&lt;h3 id="considerations">Considerations
&lt;/h3>&lt;p>Generally speaking, it’s often considered a good practice to follow &lt;strong>the first approach&lt;/strong> (one @Repository and multiple @Services) for the following reasons:&lt;/p>
&lt;ul>
&lt;li>Better separation of concerns: Each service class can focus on a specific domain or set of related operations.&lt;/li>
&lt;li>Improved maintainability: Smaller, more focused classes are usually easier to understand and maintain.&lt;/li>
&lt;li>Easier testing: With more granular services, it’s easier to write unit tests and mock dependencies.&lt;/li>
&lt;li>Flexibility: It’s easier to reuse and combine services in different ways.&lt;/li>
&lt;li>Scalability: As your application grows, it’s easier to add new features or modify existing ones without affecting other parts of the system.&lt;/li>
&lt;/ul>
&lt;p>However, the best approach &lt;strong>depends on your specific use case&lt;/strong>. If your application is small and simple, or if a particular service genuinely needs to work with multiple repositories directly, then referencing multiple repositories in a service class might be appropriate.&lt;/p>
&lt;p>In conclusion, while referencing one @Repository and multiple @Services in a @Service class is often a good practice, the most important thing is to choose an approach that makes sense for your application’s architecture and maintainability goals.&lt;/p>
&lt;h2 id="long-or-long"> Long or long
&lt;/h2>&lt;p>In Java, it’s &lt;strong>generally recommended&lt;/strong> to use the primitive type long instead of the wrapper class Long in method signatures, unless you have a &lt;strong>specific reason&lt;/strong> to use the object wrapper. Here’s why:&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Performance&lt;/strong>: Primitive types are more efficient in terms of memory usage and performance. They don’t require object creation or autoboxing/unboxing.&lt;/li>
&lt;li>&lt;strong>Simplicity&lt;/strong>: Using primitives makes the code simpler and more straightforward.&lt;/li>
&lt;li>&lt;strong>Null safety&lt;/strong>: Primitive types can’t be null, which can prevent null pointer exceptions.&lt;/li>
&lt;/ul>
&lt;p>However, there are cases where using Long might be preferable:&lt;/p>
&lt;ul>
&lt;li>When &lt;strong>null values are meaningful&lt;/strong>: If you need to represent the absence of a value, Long can be null while long cannot.&lt;/li>
&lt;li>In &lt;strong>collections&lt;/strong>: Java collections (like ArrayList or HashMap) require object types, so you’d use Long in these cases.&lt;/li>
&lt;li>When working with &lt;strong>generics&lt;/strong>: Generics in Java don’t work with primitive types, so you’d need to use Long in these situations.&lt;/li>
&lt;li>In certain APIs or frameworks: Some APIs or frameworks might require the use of wrapper classes.&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Preferred for most cases&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">methodWithLong&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">long&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// ...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// Use when null is a meaningful value&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">methodWithLongObject&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Long&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Handle null case&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Handle non-null case&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>In summary, use long by default for better performance and simplicity, but don’t hesitate to use Long when the situation calls for it, such as when dealing with nullable values or working with Java collections and generics.&lt;/p>
&lt;h2 id="check-or-not">Check Or Not
&lt;/h2>&lt;h3 id="checking-existence-before-update">Checking existence before update
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">repository&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">existsById&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">repository&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">save&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">entity&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">throw&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">EntityNotFoundException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Entity not found&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="pros-2">Pros
&lt;/h4>&lt;ul>
&lt;li>Provides &lt;strong>more control&lt;/strong> over the flow of your application.&lt;/li>
&lt;li>Allows you to give &lt;strong>more specific feedback&lt;/strong> to the user (e.g., “User not found” instead of a generic error).&lt;/li>
&lt;li>Can be more efficient if you have &lt;strong>additional logic&lt;/strong> that depends on the entity’s existence.&lt;/li>
&lt;/ul>
&lt;h4 id="cons-2">⠀Cons
&lt;/h4>&lt;ul>
&lt;li>Requires an additional database query, which can &lt;strong>impact performance&lt;/strong>, especially in high-traffic scenarios.&lt;/li>
&lt;li>There’s a small chance of a &lt;strong>race condition&lt;/strong> between the check and the update (though this is rare in most applications).&lt;/li>
&lt;/ul>
&lt;h3 id="handling-the-update-exception-directly">Handling the update exception directly
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">repository&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">save&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">entity&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EntityNotFoundException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Handle the case where the entity doesn&amp;#39;t exist&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="pros-3">Pros
&lt;/h4>&lt;ul>
&lt;li>More &lt;strong>straightforward&lt;/strong> code, following the “it’s easier to ask forgiveness than permission” principle.&lt;/li>
&lt;li>Potentially more &lt;strong>efficient&lt;/strong> as it avoids an extra database query.&lt;/li>
&lt;li>&lt;strong>Eliminates&lt;/strong> the possibility of race conditions between checking and updating.&lt;/li>
&lt;/ul>
&lt;h4 id="cons-3">⠀Cons
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>Less control&lt;/strong> over the specific error message or handling.&lt;/li>
&lt;li>May &lt;strong>catch other unexpected exceptions&lt;/strong> that you didn’t intend to handle in the same way.&lt;/li>
&lt;/ul>
&lt;h3 id="recommendation">Recommendation
&lt;/h3>&lt;ul>
&lt;li>For most simple CRUD operations, handling the exception directly is often sufficient and more efficient.&lt;/li>
&lt;li>Consider checking existence first if:
&lt;ul>
&lt;li>You need to provide very specific feedback to the user.&lt;/li>
&lt;li>You have complex logic that depends on whether the entity exists or not.&lt;/li>
&lt;li>You’re in a scenario where the extra database query doesn’t significantly impact performance.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>In &lt;strong>high-performance&lt;/strong> systems with many updates, handling the exception might be preferable to avoid the extra query.&lt;/li>
&lt;li>If you’re using optimistic locking (e.g., with @Version), you might want to handle OptimisticLockingFailureException separately, as this indicates a concurrent modification rather than a non-existent entity.&lt;/li>
&lt;li>Consider your specific use case: if updates to non-existent entities are rare, handling the exception might be cleaner. If they’re common, checking first could provide a better user experience.&lt;/li>
&lt;/ul>
&lt;h2 id="transactional-on-repository-layer">Transactional on Repository Layer
&lt;/h2>&lt;p>By default, Spring Data JPA repository methods are transactional, but &lt;strong>only for read-only operations&lt;/strong>. For modifying operations (like updates), you need to explicitly mark the method or the surrounding service method with @Transactional.&lt;/p>
&lt;h2 id="derived-query-method">Derived Query Method
&lt;/h2>&lt;p>In Spring Data JPA, derived query methods &lt;strong>are primarily used for retrieving data&lt;/strong> rather than updating it. While derived query methods are very convenient for simple read operations, they do not support update operations directly.&lt;/p>
&lt;h2 id="malicious-use">Malicious Use
&lt;/h2>&lt;p>When developing and deploying a REST API, it’s essential to consider both valid scenarios and potential malicious use cases. &lt;/p>
&lt;ul>
&lt;li>&lt;strong>Security&lt;/strong>: Ignoring potential malicious use can leave your API vulnerable to attacks such as SQL injection, Cross-Site Scripting (XSS), Distributed Denial of Service (DDoS), and others.&lt;/li>
&lt;li>&lt;strong>Stability&lt;/strong>: Malicious uses can lead to unexpected behavior, crashes, or resource exhaustion, affecting the availability and reliability of your service.&lt;/li>
&lt;li>&lt;strong>Compliance&lt;/strong>: Many industries have regulations requiring secure handling of data, which includes protecting against malicious use.&lt;/li>
&lt;li>&lt;strong>User Trust&lt;/strong>: Users expect their data to be secure. Failing to protect against malicious use can damage your reputation and erode user trust.&lt;/li>
&lt;/ul>
&lt;h2 id="authenticatedprincipal-usage">@AuthenticatedPrincipal Usage
&lt;/h2>&lt;h3 id="passing-the-principal-from-the-controller">Passing the principal from the controller
&lt;/h3>&lt;h4 id="pros-4">Pros
&lt;/h4>&lt;ul>
&lt;li>Makes the flow of data more explicit.&lt;/li>
&lt;li>Easier to &lt;strong>unit test&lt;/strong> the service layer, as you can pass any principal object directly.&lt;/li>
&lt;li>Keeps the service layer completely &lt;strong>decoupled&lt;/strong> from Spring Security.&lt;/li>
&lt;/ul>
&lt;h4 id="cons-4">Cons
&lt;/h4>&lt;ul>
&lt;li>Requires passing the principal through &lt;strong>potentially many layers&lt;/strong> if you have a deep call hierarchy.&lt;/li>
&lt;li>May lead to repetitive code in controllers if many endpoints need to pass the principal.&lt;/li>
&lt;/ul>
&lt;h3 id="usingauthenticatedprincipalin-the-service-layer">Using@AuthenticatedPrincipal in the service layer
&lt;/h3>&lt;h4 id="pros-5">Pros
&lt;/h4>&lt;ul>
&lt;li>Keeps the service method signature clean and focused on business logic parameters.&lt;/li>
&lt;li>&lt;strong>Reduces coupling&lt;/strong> between the controller and service layer.&lt;/li>
&lt;li>Allows the service to be used in different contexts (e.g., scheduled tasks, message listeners) where a controller might not be involved.&lt;/li>
&lt;/ul>
&lt;h4 id="cons-5">Cons
&lt;/h4>&lt;ul>
&lt;li>May make unit testing the service layer slightly &lt;strong>more complex&lt;/strong>, as you need to mock the security context.&lt;/li>
&lt;li>Could be seen as &lt;strong>mixing concerns&lt;/strong> if you consider authentication a cross-cutting concern.&lt;/li>
&lt;/ul>
&lt;h3 id="recommendation-1">Recommendation
&lt;/h3>&lt;p>In general, using @AuthenticatedPrincipal in the service layer is often preferred because:&lt;/p>
&lt;ul>
&lt;li>It adheres to the Don’t Repeat Yourself (DRY) principle, avoiding the need to pass the principal in every controller method.&lt;/li>
&lt;li>It makes the service methods self-contained and more reusable in different contexts.&lt;/li>
&lt;li>It leverages Spring Security’s built-in capabilities, which are well-tested and maintained.&lt;/li>
&lt;/ul></description></item><item><title>【Postopia Dev Log】Day 5</title><link>https://dyhes.github.io/p/postopia-dev-logday-5/</link><pubDate>Fri, 12 Jul 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logday-5/</guid><description>&lt;p>深入了解了@ManyToMany, @ManyToOne, @OneToMany, @OneToOne 这几个注解以及java中的日期时间及其在数据库里的使用&lt;/p>
&lt;p>定义了Comment, Space 等 model&lt;/p>
&lt;h2 id="id">@Id
&lt;/h2>&lt;p>The @Id annotation in JPA (Java Persistence API) is used to mark a field as the primary key of an entity.&lt;/p>
&lt;p>By default:&lt;/p>
&lt;ul>
&lt;li>Nullable:
&lt;ul>
&lt;li>@Id fields are generally not nullable. Primary keys are used to uniquely identify each record in a database table, so they must have a value.&lt;/li>
&lt;li>However, the exact behavior can depend on the underlying database and the specific JPA implementation.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Updatable:
&lt;ul>
&lt;li>@Id fields are typically not updatable after they are set.&lt;/li>
&lt;li>Once an entity is persisted with a primary key value, that value should not change for the lifetime of the entity.&lt;/li>
&lt;li>Changing the ID of an existing entity can lead to data integrity issues and is generally discouraged.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>It’s important to note:&lt;/p>
&lt;ul>
&lt;li>While the @Id itself doesn’t have properties for nullable or updatable, you can use additional annotations or configurations to modify the behavior:
&lt;ul>
&lt;li>You can use @Column(nullable = false) to explicitly specify that the field cannot be null (though this is usually the default for ID fields).&lt;/li>
&lt;li>You can use @Column(updatable = false) to explicitly specify that the field cannot be updated after initial persistence.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>The exact behavior can also depend on how the ID is generated. For example, if you’re using @GeneratedValue for automatic ID generation, the field will initially be null until the entity is persisted, at which point the database or JPA provider will generate and set the ID value.&lt;/li>
&lt;li>Some JPA implementations might allow updates to ID fields in certain circumstances, but this is not standard behavior and should be avoided in most cases.&lt;/li>
&lt;/ul>
&lt;h2 id="set-or-list">Set or List
&lt;/h2>&lt;p>When deciding whether to use a Set or a List for @ManyToMany and @OneToMany relationships in JPA, there are several factors to consider, including the uniqueness requirement, ordering, and performance. Here is a breakdown of when to use each:&lt;/p>
&lt;h3 id="when-to-use-set">When to Use Set
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>Uniqueness&lt;/strong>
Set does not allow duplicate elements. If you want to ensure that the collection of related entities is unique, a Set is appropriate.&lt;/li>
&lt;li>&lt;strong>No Ordering&lt;/strong>
Set does not maintain the order of elements. If the order of the related entities does not matter, you can use a Set.&lt;/li>
&lt;li>&lt;strong>Performance&lt;/strong>
In general, Set operations like add, remove, and contains are faster than List operations because Set uses hashing or other mechanisms to enforce uniqueness.&lt;/li>
&lt;/ul>
&lt;h3 id="when-to-uselist">&lt;strong>When to Use&lt;/strong> &lt;strong>List&lt;/strong>
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>Ordering&lt;/strong>
List maintains the order of elements. If the order of the related entities matters, or you need to preserve the order in which elements are inserted, you should use a List.&lt;/li>
&lt;li>&lt;strong>Duplicates&lt;/strong>
List allows duplicate elements. If there is a scenario where duplicates are meaningful or required, then List is the appropriate choice.&lt;/li>
&lt;li>&lt;strong>Indexed Access&lt;/strong>
List allows indexed access to elements. If you need to frequently access elements by their index, a List would be more suitable.&lt;/li>
&lt;/ul>
&lt;h2 id="join-table-entity">Join Table Entity
&lt;/h2>&lt;p>Check the corresponding Independent post&lt;/p>
&lt;h2 id="dates-in-java">Dates in Java
&lt;/h2>&lt;p>Check the corresponding Independent post&lt;/p>
&lt;h2 id="confusion-about-fetchtypelazy">Confusion about FetchType.LAZY
&lt;/h2>&lt;p>Is the primary key of the referenced entity can be easily accessed even when the fetch is LAZY in @ManyToOne and @OneToOne of spring data jpa?&lt;/p>
&lt;blockquote>
&lt;p>Yes, the primary key of the referenced entity can still be easily accessed even when the fetch type is set to FetchType.LAZY in @ManyToOne and @OneToOne relationships in Spring Data JPA.&lt;/p>
&lt;p>When you configure a relationship with FetchType.LAZY, it means that the related entity is not immediately loaded from the database when the parent entity is fetched. Instead, it is loaded on demand when you actually try to access the relationship.&lt;/p>
&lt;p>However, accessing the primary key of the referenced entity does not require fetching the entire entity. The primary key value is typically stored as a foreign key in the parent entity, and &lt;strong>you can access this foreign key directly without triggering a lazy load of the related entity&lt;/strong>.&lt;/p>
&lt;/blockquote>
&lt;p>Is it the same for @ManyToMany and @OneToMany?&lt;/p>
&lt;blockquote>
&lt;p>GPT-4o:&lt;/p>
&lt;p>No.&lt;/p>
&lt;p>In a @ManyToMany relationship, a &lt;strong>join table&lt;/strong> is typically used to maintain the associations between the entities. When the fetch type is LAZY, the list of related entities is not loaded until you explicitly access it.&lt;/p>
&lt;p>In a @ManyToMany relationship, The foreign key parent_id is stored in the Child entity and &lt;strong>not directly accessible from the Parent entity without loading the children&lt;/strong>.&lt;/p>
&lt;p>In both cases, there isn’t a straightforward way to access the primary keys of the related entities without triggering a lazy load.&lt;/p>
&lt;/blockquote>
&lt;h2 id="entity-objectextension">Entity Object Extension
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">javax.persistence.MappedSuperclass&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">javax.persistence.Id&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">javax.persistence.GeneratedValue&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">javax.persistence.GenerationType&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">javax.persistence.Column&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nd">@MappedSuperclass&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">abstract&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">BaseEntity&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Id&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@GeneratedValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">strategy&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">GenerationType&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">IDENTITY&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Long&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Column&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;created_at&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LocalDateTime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">createdAt&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Column&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;updated_at&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LocalDateTime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">updatedAt&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Getters and Setters&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="confusions-about-database">Confusions about database
&lt;/h2>&lt;ul>
&lt;li>In most cases, a simple COUNT() will be more efficient than retrieving detailed columns.&lt;/li>
&lt;li>the columns queried can have a significant impact on query time.
&lt;ul>
&lt;li>SELECT * is often slower than selecting specific columns, especially in large tables.&lt;/li>
&lt;li>Smaller data types (e.g., INT) are typically faster to retrieve than larger ones (e.g., TEXT or BLOB).&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul></description></item><item><title>【Postopia Dev Log】Day 6</title><link>https://dyhes.github.io/p/postopia-dev-logday-6/</link><pubDate>Fri, 12 Jul 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logday-6/</guid><description>&lt;p>实现了创建空间和加入空间&lt;/p>
&lt;p>调试接口的时候报：&lt;/p>
&lt;p>failed to lazily initialize a collection of role: com.heslin.postopia.model.User.spaces: could not initialize proxy - no Session&lt;/p>
&lt;p>检查之后发现 UsernamePasswordAuthenticationToken 在处理过程中会调用principal 的 toString方法，导致了这个错误，自己重载User.toString 之后恢复正常。&lt;/p>
&lt;h2 id="polymorphic-query">Polymorphic Query
&lt;/h2>&lt;p>Check the corresponding post&lt;/p>
&lt;h2 id="java-enum">Java Enum
&lt;/h2>&lt;p>Check the corresponding post&lt;/p>
&lt;h2 id="pageable-and-sort">Pageable and Sort
&lt;/h2>&lt;p>Check the corresponding post&lt;/p>
&lt;h2 id="query-and-jpql">@Query and JPQL
&lt;/h2>&lt;p>Check the corresponding post&lt;/p></description></item><item><title>【Postopia Dev Log】Day 4</title><link>https://dyhes.github.io/p/postopia-dev-logday-4/</link><pubDate>Wed, 10 Jul 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logday-4/</guid><description>&lt;img src="https://dyhes.github.io/covers/cover6.png" alt="Featured image of post 【Postopia Dev Log】Day 4" />&lt;p>忙于构建个人博客，没有什么进展&lt;/p>
&lt;h2 id="knowledge">Knowledge
&lt;/h2>&lt;h3 id="java-record">Java Record
&lt;/h3>&lt;p>Java records were &lt;strong>introduced in Java 14&lt;/strong> as a preview feature and became a s&lt;strong>tandard feature in Java 16&lt;/strong>. They provide a compact syntax for declaring classes that are used primarily to store data. Records are designed to reduce boilerplate code and make it easier to create &lt;strong>simple, immutable&lt;/strong> data carriers.
Syntax:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">record&lt;/span> &lt;span class="nc">Person&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Automatic generation:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>A constructor with parameters for all components&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Accessor methods for each component (e.g., name() and age())&lt;/p>
&lt;/li>
&lt;li>
&lt;p>equals() and hashCode() methods&lt;/p>
&lt;/li>
&lt;li>
&lt;p>toString() method
Immutability:&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Records are implicitly final and cannot be extended.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>The fields (components) of a record are final by default.
Constructors:&lt;/p>
&lt;/li>
&lt;li>
&lt;p>You can define custom constructors, including compact constructors.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>A compact constructor doesn’t need to explicitly list all fields:&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">record&lt;/span> &lt;span class="nc">Person&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Person&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">throw&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">IllegalArgumentException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Age cannot be negative&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Additional methods:You can add other methods to a record, just like in a regular class.
Limitations:&lt;/p>
&lt;ul>
&lt;li>Records cannot extend other classes (they implicitly extend java.lang.Record).&lt;/li>
&lt;li>They cannot declare instance fields other than the private final fields for the components of the state description.&lt;/li>
&lt;li>They cannot be abstract.&lt;/li>
&lt;/ul>
&lt;h3 id="internationalization">Internationalization
&lt;/h3>&lt;p>Internationalization (i18n) is typically handled on both the front end and the back end, but the approach and responsibilities can vary depending on the specific requirements of your application.&lt;/p>
&lt;p>In many modern web applications, the front end handles a significant portion of i18n, especially for single-page applications (SPAs) and client-heavy architectures. This approach allows for more responsive user experiences and reduces server load.&lt;/p>
&lt;p>However, some aspects of i18n are better suited for the back end, particularly when dealing with sensitive data, complex business logic, or when you need to generate localized content server-side.&lt;/p>
&lt;p>&lt;strong>Best practices&lt;/strong>&lt;/p>
&lt;p>Best practices often involve a combination of both:&lt;/p>
&lt;p>Use front-end i18n libraries for UI elements and client-side formatting.
Implement back-end i18n for database content, emails, and API responses.
Use content delivery networks (CDNs) or static file hosting for language resource files.
Consider using a translation management system (TMS) to streamline the translation process.&lt;/p></description></item><item><title>【Postopia Dev Log】Day 3</title><link>https://dyhes.github.io/p/postopia-dev-logday-3/</link><pubDate>Tue, 09 Jul 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logday-3/</guid><description>&lt;img src="https://dyhes.github.io/covers/cover14.png" alt="Featured image of post 【Postopia Dev Log】Day 3" />&lt;p>遇到一个好像很有用的网站 &lt;a class="link" href="https://dzone.com/" target="_blank" rel="noopener"
>Programming &amp;amp; DevOps news, tutorials &amp;amp; tools&lt;/a>&lt;/p>
&lt;p>实现了一个BadRequestExceptionHandler&lt;/p>
&lt;p>Spring Security 有点复杂，没找到好的参考资料&lt;/p>
&lt;p>在claude 3.5的帮助下初步实现了基于简单jwt的Authentication&lt;/p>
&lt;p>测试filter的时候不小心调用了两次chain.doFilter导致返回的json数据是重复的两份
&lt;a class="link" href="https://stackoverflow.com/questions/73892445/duplicate-json-in-spring-boot-response" target="_blank" rel="noopener"
>Duplicate Json in Spring Boot Response&lt;/a>&lt;/p>
&lt;h2 id="knowledge">Knowledge
&lt;/h2>&lt;h3 id="keycloak">Keycloak
&lt;/h3>&lt;p>Keycloak is an open-source Identity and Access Management (IAM) solution developed by Red Hat. It provides a comprehensive set of features for managing authentication and authorization in modern applications.&lt;/p>
&lt;h4 id="key-features">Key Features
&lt;/h4>&lt;p>&lt;strong>1&lt;/strong> &lt;strong>Single Sign-On (SSO)&lt;/strong>: Keycloak allows users to authenticate once and access multiple applications without re-entering credentials.&lt;/p>
&lt;p>&lt;strong>2&lt;/strong> &lt;strong>Identity Brokering&lt;/strong>: It can integrate with external identity providers like Google, Facebook, or other SAML 2.0 or OpenID Connect providers.&lt;/p>
&lt;p>&lt;strong>3&lt;/strong> &lt;strong>User Federation&lt;/strong>: Keycloak can sync with existing LDAP or Active Directory servers.&lt;/p>
&lt;p>&lt;strong>4&lt;/strong> &lt;strong>Customizable Authentication&lt;/strong>: Supports various authentication mechanisms including password, OTP, and custom authenticators.&lt;/p>
&lt;p>&lt;strong>5&lt;/strong> &lt;strong>Fine-grained Authorization&lt;/strong>: Provides role-based access control (RBAC) and attribute-based access control (ABAC).&lt;/p>
&lt;p>&lt;strong>6&lt;/strong> &lt;strong>Admin Console&lt;/strong>: Offers a user-friendly interface for managing users, roles, clients, and realm settings.&lt;/p>
&lt;p>&lt;strong>7&lt;/strong> &lt;strong>Standard Protocols&lt;/strong>: Supports OAuth 2.0, OpenID Connect, and SAML 2.0.&lt;/p>
&lt;p>&lt;strong>8&lt;/strong> &lt;strong>Client Adapters&lt;/strong>: Provides adapters for easy integration with various application stacks.&lt;/p>
&lt;p>&lt;strong>9&lt;/strong> &lt;strong>Themes and Internationalization&lt;/strong>: Allows customization of login pages and supports multiple languages.&lt;/p>
&lt;p>&lt;strong>10&lt;/strong> &lt;strong>Social Login&lt;/strong>: Enables users to log in using their social media accounts.&lt;/p>
&lt;h3 id="oauth2">Oauth2
&lt;/h3>&lt;h4 id="involved-actors">Involved Actors
&lt;/h4>&lt;p>&lt;strong>i) Resource Server&lt;/strong>: The server hosting user-owned resources that are protected by OAuth2. The resource server validates the access-token and serves the protected resources.&lt;/p>
&lt;p>&lt;strong>ii) Resource Owner&lt;/strong>: Typically, the user of the application is the resource owner. The resource owner has the ability to grant or deny access to their own data hosted on the resource server.&lt;/p>
&lt;p>&lt;strong>iii) Authorization Server&lt;/strong>: The authorization server gets consent from the resource owner and issues access tokens to clients for accessing protected resources hosted by a resource server.&lt;/p>
&lt;p>&lt;strong>iv) Client&lt;/strong>: An application making API requests to perform actions on protected resources on behalf of the resource owner. Before it may do so, it must be authorized by the resource owner, and the authorization must be validated by resource server/authorization server. OAuth2 defines two client types, based on their ability to authenticate securely with the authorization server (i.e., ability to &lt;strong>maintain the confidentiality&lt;/strong> of their client credentials):&lt;/p>
&lt;p>&lt;strong>a)Confidential&lt;/strong>: Clients capable of maintaining the confidentiality of their credentials. Confidential clients are implemented on a secure server with restricted access to the client credentials (e.g., a web application running on a &lt;strong>web server&lt;/strong>).&lt;/p>
&lt;p>&lt;strong>b) Public&lt;/strong>: Clients incapable of maintaining the confidentiality of their credentials (e.g. an installed native application or a &lt;strong>web browser-based application&lt;/strong>), and incapable of secure client authentication via any other means.&lt;/p>
&lt;h4 id="authorization-grant-types">&lt;strong>Authorization Grant Types&lt;/strong>
&lt;/h4>&lt;p>To get the access token, the client obtains authorization from the resource owner. The authorization is expressed in the form of an &lt;strong>authorization grant, which the client uses to request the access token.&lt;/strong> OAuth2 defines four standard grant types: authorization code, implicit, resource owner password credentials, and client credentials. It also provides an extension mechanism for defining additional grant types.&lt;/p>
&lt;p>&lt;strong>i) Authorization Code Grant&lt;/strong>: this grant type is optimized for confidential clients (web application server). The authorization code flow &lt;strong>does not expose the access token to the resource owner’s browser&lt;/strong>. Instead, authorization is accomplished using an intermediary “authorization code” that is passed through the browser. This code must be exchanged for an access token before calls can be made to protected APIs.&lt;/p>
&lt;p>&lt;strong>ii) Implicit Grant&lt;/strong>: this grant type is suitable &lt;strong>for public clients&lt;/strong>. The implicit grant flow &lt;strong>does not accommodate refresh tokens&lt;/strong>. If the authorization server expires access tokens regularly, your application will need to run through the authorization flow whenever it needs access. In this flow, an access token is immediately returned to the client after a user grants the requested authorization. An &lt;strong>intermediate authorization code is not required&lt;/strong> as it is in the authorization code grant.&lt;/p>
&lt;p>&lt;strong>iii) Resource Owner Password Credentials&lt;/strong>: the resource owner password credentials grant type is suitable in cases where &lt;strong>the resource owner has a trust relationship with the client&lt;/strong>, and the resource owner agrees to share hise/her credentials (username, password) with the client. Then the client can use resources from the owner&amp;rsquo;s credentials to get the access token from the authorization server.&lt;/p>
&lt;p>&lt;strong>iv) Client Credentials&lt;/strong>: this grant type is suitable when &lt;strong>the client itself owns the data and does not need delegated access from a resource owner&lt;/strong>, or delegated access has already been granted to the application outside of a typical OAuth flow. In this flow, user consent is not involved. The client exchanges his client credentials to get an access token.&lt;/p>
&lt;h3 id="transactions">Transactions
&lt;/h3>&lt;p>A database transaction is a sequence of one or more database operations that are treated as a single unit of work. Transactions adhere to the ACID properties:&lt;/p>
&lt;p>&lt;strong>1&lt;/strong> &lt;strong>Atomicity&lt;/strong>: All operations in a transaction either complete successfully or fail altogether. There&amp;rsquo;s no partial completion.&lt;/p>
&lt;p>&lt;strong>2&lt;/strong> &lt;strong>Consistency&lt;/strong>: A transaction brings the database from one valid state to another. All rules and constraints must be satisfied.&lt;/p>
&lt;p>&lt;strong>3&lt;/strong> &lt;strong>Isolation&lt;/strong>: Concurrent execution of transactions results in a state that would be obtained if transactions were executed sequentially.&lt;/p>
&lt;p>&lt;strong>4&lt;/strong> &lt;strong>Durability&lt;/strong>: Once a transaction has been committed, it will remain so, even in the event of power loss, crashes, or errors.&lt;/p>
&lt;h4 id="isolation-level">Isolation level
&lt;/h4>&lt;p>Isolation levels define how transaction integrity is visible to other users and systems. They provide a trade-off between consistency and performance.&lt;/p>
&lt;h4 id="1-read-uncommitted">1. READ UNCOMMITTED
&lt;/h4>&lt;ul>
&lt;li>Lowest isolation level&lt;/li>
&lt;li>One transaction may read not-yet-committed changes made by other transactions (&amp;ldquo;dirty reads&amp;rdquo;)&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">Transaction&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">UPDATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Account&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SET&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">balance&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">balance&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">account_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;A&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">Transaction&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">balance&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Account&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">account_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;A&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">-- May read the updated (uncommitted) balance
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">Transaction&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ROLLBACK&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="2-read-committed">2. READ COMMITTED
&lt;/h4>&lt;ul>
&lt;li>A transaction only sees data committed before the transaction began&lt;/li>
&lt;li>Prevents dirty reads, but &amp;ldquo;non-repeatable reads&amp;rdquo; can occur&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">Transaction&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">balance&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Account&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">account_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;A&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">-- Reads original balance
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">Transaction&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">UPDATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Account&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SET&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">balance&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">balance&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">account_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;A&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">Transaction&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">COMMIT&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">Transaction&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">balance&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Account&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">account_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;A&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">-- Reads new balance
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="3-repeatable-read">3. REPEATABLE READ
&lt;/h4>&lt;ul>
&lt;li>Ensures that if a transaction reads a row, it will consistently see the same data for that row until the transaction completes&lt;/li>
&lt;li>Prevents non-repeatable reads, but &amp;ldquo;phantom reads&amp;rdquo; can occur&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">Transaction&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Account&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">balance&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">Transaction&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INTO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Account&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">account_id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">balance&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">VALUES&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;C&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1500&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">Transaction&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">COMMIT&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">Transaction&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Account&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">balance&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">-- May see the new account (phantom read)
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="4-serializable">4. SERIALIZABLE
&lt;/h4>&lt;ul>
&lt;li>Highest isolation level&lt;/li>
&lt;li>Transactions are completely isolated from one another&lt;/li>
&lt;li>Prevents dirty reads, non-repeatable reads, and phantom reads&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">Transaction&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Account&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">balance&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">Transaction&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INTO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Account&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">account_id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">balance&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">VALUES&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;C&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1500&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">-- This will be blocked until Transaction 1 completes
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">Transaction&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Account&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">balance&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">-- Will not see any changes made by other transactions
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="concurrency-issues">Concurrency Issues
&lt;/h5>&lt;p>&lt;strong>1&lt;/strong> &lt;strong>Dirty Read&lt;/strong>: Reading uncommitted data from another transaction.&lt;/p>
&lt;p>&lt;strong>2&lt;/strong> &lt;strong>Non-Repeatable Read&lt;/strong>: Getting different results when reading the same row twice in the same transaction.&lt;/p>
&lt;p>&lt;strong>3&lt;/strong> &lt;strong>Phantom Read&lt;/strong>: Getting different results when querying for a range of rows twice in the same transaction.&lt;/p>
&lt;p>⠀Isolation Level Comparison&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: center">Isolation Level&lt;/th>
&lt;th style="text-align: center">Dirty Read&lt;/th>
&lt;th style="text-align: center">Non-Repeatable Read&lt;/th>
&lt;th style="text-align: center">Phantom Read&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: center">READ UNCOMMITTED&lt;/td>
&lt;td style="text-align: center">Possible&lt;/td>
&lt;td style="text-align: center">Possible&lt;/td>
&lt;td style="text-align: center">Possible&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">READ COMMITTED&lt;/td>
&lt;td style="text-align: center">Prevented&lt;/td>
&lt;td style="text-align: center">Possible&lt;/td>
&lt;td style="text-align: center">Possible&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">REPEATABLE READ&lt;/td>
&lt;td style="text-align: center">Prevented&lt;/td>
&lt;td style="text-align: center">Prevented&lt;/td>
&lt;td style="text-align: center">Possible&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">SERIALIZABLE&lt;/td>
&lt;td style="text-align: center">Prevented&lt;/td>
&lt;td style="text-align: center">Prevented&lt;/td>
&lt;td style="text-align: center">Prevented&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>Higher isolation levels provide more consistency but may reduce concurrency and impact performance.&lt;/p>
&lt;p>Many applications use READ COMMITTED as a default, as it provides a good balance between consistency and performance.&lt;/p>
&lt;h3 id="transactional">@Transactional
&lt;/h3>&lt;p>When you annotate a method with @Transactional, Spring will start a transaction before the method executes and commit it after the method completes. If &lt;strong>an exception is thrown&lt;/strong>, the transaction will be rolled back.&lt;/p>
&lt;p>You can place @Transactional on a method or a class. If placed on a class, &lt;strong>all public methods&lt;/strong> of the class become transactional.(@Transactional only works on &lt;strong>public&lt;/strong> methods)
By default, transactions roll back on &lt;strong>runtime exceptions&lt;/strong>.&lt;/p>
&lt;p>You can customize&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Transactional&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">rollbackFor&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">CustomException&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>In Spring Boot applications, transaction management is automatically enabled. In other Spring applications, you need to explicitly enable it with @EnableTransactionManagement.
scenarios:&lt;/p>
&lt;ul>
&lt;li>Multiple Database Operations&lt;/li>
&lt;li>Read Operations Requiring Consistency&lt;/li>
&lt;li>…
&lt;strong>Service Layer Methods&lt;/strong> It&amp;rsquo;s often a good practice to put @Transactional on service-layer methods rather than repository methods or controllers.
Don&amp;rsquo;t use @Transactional for &lt;strong>single, simple database operations&lt;/strong> - the underlying repository methods are often already transactional.&lt;/li>
&lt;/ul>
&lt;h2 id="articles">Articles
&lt;/h2>&lt;p>&lt;a class="link" href="https://www.baeldung.com/rest-api-spring-oauth2-angular" target="_blank" rel="noopener"
>Spring REST API + OAuth2 + Angular&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.baeldung.com/keycloak-embedded-in-spring-boot-app" target="_blank" rel="noopener"
>Keycloak Embedded in a Spring Boot Application&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://dzone.com/articles/secure-spring-rest-with-spring-security-and-oauth2" target="_blank" rel="noopener"
>Secure Spring REST With Spring Security and OAuth2&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://dzone.com/articles/oauth-20-beginners-guide" target="_blank" rel="noopener"
>OAuth 2.0 Beginner&amp;rsquo;s Guide&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://dzone.com/refcardz/oauth-patterns-and-anti-patterns" target="_blank" rel="noopener"
>OAuth Patterns and Anti-Patterns&lt;/a>&lt;/p></description></item><item><title>【Postopia Dev Log】Day 2</title><link>https://dyhes.github.io/p/postopia-dev-logday-2/</link><pubDate>Sun, 07 Jul 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logday-2/</guid><description>&lt;img src="https://dyhes.github.io/covers/cover11.png" alt="Featured image of post 【Postopia Dev Log】Day 2" />&lt;p>考虑到不确定能把系统做到什么程度，暂时不考虑分布式相关事宜&lt;/p>
&lt;p>运行./gradlew bootRun 热加载不知道为什么没有生效，找来找去没找到原因&lt;/p>
&lt;p>想直接用dokcer实现，不熟悉docker和docker compose困难重重&lt;/p>
&lt;p>根据 &lt;a class="link" href="https://digitalsanctuary.com/java/springboot-devtools-auto-restart-and-live-reload.html" target="_blank" rel="noopener"
>SpringBoot DevTools Auto Restart and Live Reload&lt;/a> 一顿操作之后控制台有反应了，但是没有效果&lt;/p>
&lt;p>根据 &lt;a class="link" href="https://github.com/spring-projects/spring-boot/issues/38538" target="_blank" rel="noopener"
>LiveReload does not detect changes&lt;/a>&lt;/p>
&lt;p>”For a change to be noticeable &lt;strong>it has to be compiled&lt;/strong>. You can learn more about this &lt;a class="link" href="https://docs.spring.io/spring-boot/docs/3.2.x/reference/html/using.html#using.devtools.restart" target="_blank" rel="noopener"
>in the reference documentation&lt;/a>. We generally recommend using an IDE to both to run the application and to make changes. It will then compile the changes so that they can be noticed by DevTools.“&lt;/p>
&lt;p>成功解决问题&lt;/p>
&lt;p>进度：
完成注册，热加载&lt;/p>
&lt;h2 id="knowledge">knowledge
&lt;/h2>&lt;h3 id="uuid-long-id-comparison">UUID, Long ID comparison
&lt;/h3>&lt;p>UUID:&lt;/p>
&lt;ul>
&lt;li>Globally unique&lt;/li>
&lt;li>128-bit value&lt;/li>
&lt;li>String representation&lt;/li>
&lt;li>No sequential ordering&lt;/li>
&lt;li>Suitable for distributed systems&lt;/li>
&lt;li>Can be generated without DB interaction&lt;/li>
&lt;li>Larger storage size (typically 36 characters)
⠀Long ID:&lt;/li>
&lt;li>Locally unique (per table)&lt;/li>
&lt;li>64-bit integer&lt;/li>
&lt;li>Numeric representation&lt;/li>
&lt;li>Sequential (if auto-incremented)&lt;/li>
&lt;li>Simpler and more human-readable&lt;/li>
&lt;li>Smaller storage size (8 bytes)&lt;/li>
&lt;li>Typically faster for indexing and joining&lt;/li>
&lt;/ul>
&lt;h3 id="generatedvalue">@GeneratedValue
&lt;/h3>&lt;p>The @GeneratedValue annotation in Spring Boot is used to specify &lt;strong>how the primary key should be generated for an entity&lt;/strong>. Here&amp;rsquo;s a breakdown of its key aspects:
Common strategies:&lt;/p>
&lt;ul>
&lt;li>GenerationType.AUTO (default)&lt;/li>
&lt;li>GenerationType.IDENTITY
&lt;ul>
&lt;li>Pros: Simple, efficient for single-node systems&lt;/li>
&lt;li>Cons: Can cause issues in distributed systems or data migrations&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>GenerationType.SEQUENCE
&lt;ul>
&lt;li>Pros: Efficient, works well in high-concurrency environments&lt;/li>
&lt;li>Cons: Not supported by all databases (e.g., MySQL before 8.0)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>GenerationType.TABLE
&lt;ul>
&lt;li>Pros: Database-independent, works everywhere&lt;/li>
&lt;li>Cons: Potentially slower, requires extra table management&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="lombok-constructor-related-annotation">Lombok Constructor related annotation
&lt;/h3>&lt;ul>
&lt;li>@NoArgsConstructor&lt;/li>
&lt;li>@AllArgsConstructor&lt;/li>
&lt;li>@RequiredArgsConstructor
all final and @NonNull fields&lt;/li>
&lt;li>@Builder
used to generate a builder pattern for your class&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">MyClass&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">myClass&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">MyClass&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">builder&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">name&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;John Doe&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">age&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">30&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">address&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;123 Main St&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">build&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="gradlew">./gradlew
&lt;/h3>&lt;p>This part of the command is invoking the &lt;strong>Gradle Wrapper&lt;/strong> (gradlew or gradlew.bat), which is a script that comes bundled with the Gradle build tool. The Gradle Wrapper ensures that the correct version of Gradle is used for the project, regardless of whether or not the user has Gradle installed on their system.&lt;/p>
&lt;h3 id="dockerfile">Dockerfile
&lt;/h3>&lt;p>A Dockerfile is a script that contains a series of instructions on how to build a Docker image. Each &lt;strong>instruction&lt;/strong> in a Dockerfile creates a &lt;strong>layer&lt;/strong> in the image, and when you build the image, Docker executes these instructions step by step to produce the final image.
&lt;strong>FROM&lt;/strong>
Specifies the &lt;strong>base image&lt;/strong> to use for the Docker image you’re building. Every Dockerfile &lt;strong>must start with&lt;/strong> a FROM instruction.
&lt;strong>FROM&lt;/strong> ubuntu:20.04&lt;/p>
&lt;p>&lt;strong>LABEL&lt;/strong>
Adds &lt;strong>metadata&lt;/strong> to the image, such as a maintainer name or a version.
&lt;strong>LABEL&lt;/strong> maintainer=&amp;ldquo;&lt;a class="link" href="mailto:example@example.com" >example@example.com&lt;/a>&amp;rdquo;&lt;/p>
&lt;p>&lt;strong>RUN&lt;/strong>
&lt;strong>Executes a command&lt;/strong> in the shell. It’s often used for installing software packages.
&lt;strong>RUN&lt;/strong> apt-get update &amp;amp;&amp;amp; apt-get install -y nginx&lt;/p>
&lt;p>&lt;strong>COPY&lt;/strong>
Copies files or directories from your local filesystem into the Docker image.
&lt;strong>COPY&lt;/strong> ./localfile /containerfile&lt;/p>
&lt;p>&lt;strong>ADD&lt;/strong>
Similar to COPY, but also &lt;strong>supports URL sources and automatic unpacking&lt;/strong> of compressed files.
&lt;strong>ADD&lt;/strong> &lt;a class="link" href="https://example.com/file.tar.gz" target="_blank" rel="noopener"
>https://example.com/file.tar.gz&lt;/a> /tmp/&lt;/p>
&lt;p>&lt;strong>WORKDIR&lt;/strong>
Sets the &lt;strong>working directory&lt;/strong> for any subsequent RUN, CMD, ENTRYPOINT, COPY, and ADD instructions.
&lt;strong>WORKDIR&lt;/strong> /app&lt;/p>
&lt;p>&lt;strong>CMD&lt;/strong>
Provides a command that will be executed &lt;strong>when a container is started from the image&lt;/strong>. Only one CMD instruction is allowed per Dockerfile; if multiple CMD instructions are specified, &lt;strong>only the last one takes effect&lt;/strong>.
&lt;strong>CMD&lt;/strong> [&amp;ldquo;nginx&amp;rdquo;, &amp;ldquo;-g&amp;rdquo;, &amp;ldquo;daemon off;&amp;rdquo;]&lt;/p>
&lt;p>&lt;strong>ENTRYPOINT&lt;/strong>
Sets the default application to be used every time a container is created from the image. Unlike CMD, ENTRYPOINT &lt;strong>won’t be overridden by command-line arguments&lt;/strong>.
&lt;strong>ENTRYPOINT&lt;/strong> [&amp;ldquo;nginx&amp;rdquo;, &amp;ldquo;-g&amp;rdquo;, &amp;ldquo;daemon off;&amp;rdquo;]&lt;/p>
&lt;p>&lt;strong>ENV&lt;/strong>
Sets environment variables.
&lt;strong>ENV&lt;/strong> MY_ENV_VAR=my_value&lt;/p>
&lt;p>&lt;strong>EXPOSE&lt;/strong>
Informs Docker that the container listens on the specified network ports at runtime. This doesn’t actually publish the port; it’s a form of &lt;strong>documentation&lt;/strong>.
&lt;strong>EXPOSE&lt;/strong> 80&lt;/p>
&lt;p>&lt;strong>VOLUME&lt;/strong>
Creates a mount point with the specified path and marks it as holding externally mounted volumes from the native host or other containers.
&lt;strong>VOLUME&lt;/strong> [&amp;quot;/data&amp;quot;]&lt;/p>
&lt;p>&lt;strong>USER&lt;/strong>
Sets the user name or UID to use when running the image and for any RUN, CMD, and ENTRYPOINT instructions that follow it.
&lt;strong>USER&lt;/strong> nginx&lt;/p>
&lt;p>a project can have multiple Dockerfiles.
e.g.
├── Dockerfile ## Default Dockerfile for production
├── Dockerfile.dev ## Dockerfile for development
├── Dockerfile.test ## Dockerfile for testing&lt;/p>
&lt;h2 id="articles">Articles
&lt;/h2>&lt;p>&lt;a class="link" href="https://medium.com/@saygiligozde/using-docker-compose-with-spring-boot-and-postgresql-235031106f9f" target="_blank" rel="noopener"
>Using Docker Compose with Spring Boot and PostgreSQL&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://digitalsanctuary.com/java/springboot-devtools-auto-restart-and-live-reload.html" target="_blank" rel="noopener"
>SpringBoot DevTools Auto Restart and Live Reload&lt;/a>&lt;/p></description></item><item><title>【Postopia Dev Log】Day 1</title><link>https://dyhes.github.io/p/postopia-dev-logday-1/</link><pubDate>Fri, 05 Jul 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logday-1/</guid><description>&lt;img src="https://dyhes.github.io/covers/cover8.png" alt="Featured image of post 【Postopia Dev Log】Day 1" />&lt;p>为了提高自己的全栈开发能力，根据Reddit上某帖子(找不到原贴了)里关于提高代码能力的建议：&lt;strong>Reinvent The Wheel&lt;/strong>, 决定自己开发一个类似Reddit的论坛系统，在 Claude3.5的建议下取名 Postopia。&lt;/p>
&lt;p>考虑用umi max还是umi，感觉umi max虽然功能齐全，但是有点臃肿。最后考虑到配置各种依赖的复杂程度，还是选择umi max。&lt;/p>
&lt;p>用claude 3.5生成了一些代码，但感觉质量不是很高，同时只能提供最基础的html,css,js三件套，利用不了更高层的框架能力，还是仅供参考&lt;/p>
&lt;h2 id="postopia">Postopia
&lt;/h2>&lt;p>Claude 3.5:&lt;/p>
&lt;p>Here are some name suggestions for a Reddit alternative:&lt;/p>
&lt;ul>
&lt;li>Readit&lt;/li>
&lt;li>Threaddit&lt;/li>
&lt;li>Postopia&lt;/li>
&lt;li>Forumly&lt;/li>
&lt;li>Discussr&lt;/li>
&lt;/ul>
&lt;p>Postopia is indeed an interesting name choice. Let me break it down for you:&lt;/p>
&lt;p>Etymology:&lt;/p>
&lt;p>&amp;ldquo;Post&amp;rdquo; refers to the act of submitting content or messages, which is a core feature of Reddit-like platforms.
&amp;ldquo;topia&amp;rdquo; comes from the Greek word &amp;ldquo;topos&amp;rdquo; meaning place, and is often used to describe an ideal or imaginary place.&lt;/p>
&lt;p>Meaning:&lt;/p>
&lt;p>Together, Postopia suggests a &amp;ldquo;world of posts&amp;rdquo; or an &amp;ldquo;ideal place for posting.&amp;rdquo;&lt;/p>
&lt;p>Connotations:&lt;/p>
&lt;p>It evokes a sense of a utopian community built around sharing and discussing content.
The name implies a space where posting and engaging with posts is the primary focus.&lt;/p>
&lt;p>Relevance to Reddit alternative:&lt;/p>
&lt;p>Like Reddit, it emphasizes the user-generated content aspect.
It suggests a potentially improved or idealized version of a posting platform.&lt;/p>
&lt;p>Memorability:&lt;/p>
&lt;p>The combination of familiar elements (&amp;ldquo;post&amp;rdquo; and &amp;ldquo;topia&amp;rdquo;) creates a unique and catchy name.
It&amp;rsquo;s relatively easy to spell and pronounce.&lt;/p>
&lt;p>Domain availability:&lt;/p>
&lt;p>As of my last update, postopia.com was likely taken, but variations like getpostopia.com or postopia.io might be available.&lt;/p>
&lt;p>Branding potential:&lt;/p>
&lt;p>The name lends itself well to visual branding, perhaps incorporating elements that suggest an ideal digital community.&lt;/p>
&lt;h2 id="技术栈">技术栈
&lt;/h2>&lt;h3 id="前端">前端
&lt;/h3>&lt;p>Umi max，node 18.20.3&lt;/p>
&lt;h3 id="后端">后端
&lt;/h3>&lt;p>Spring Boot 3.3，Java 17&lt;/p></description></item><item><title>【Postopia Dev Log】Summary</title><link>https://dyhes.github.io/p/postopia-dev-logsummary/</link><pubDate>Fri, 05 Jul 2024 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/postopia-dev-logsummary/</guid><description>&lt;img src="https://dyhes.github.io/covers/cover18.png" alt="Featured image of post 【Postopia Dev Log】Summary" />&lt;p>考虑隔离级别&lt;/p>
&lt;h2 id="hard-core">Hard Core
&lt;/h2>&lt;h3 id="spring-security">Spring Security
&lt;/h3>&lt;p>没有经验时的登录实现，文档杂乱，不知道如何寻找正确的实现方法&lt;/p>
&lt;h2 id="inspiration">Inspiration
&lt;/h2>&lt;h3 id="w5">w5
&lt;/h3>&lt;p>如何处理以前没有遇到过的新需求（如给用户发送邮件），需要积累解决问题的能力（实习的时候可以边问边查，做自己的项目只能自己去查，那么如何高效检索并善用AI）,并形成方法论，以便提高能力&lt;/p>
&lt;h2 id="best-practices">Best Practices
&lt;/h2>&lt;p>很多问题只有亲身经历才能体会，并寻求 best practices 比如:&lt;/p>
&lt;ul>
&lt;li>直接更新好，处理可能的异常好还是先查询存在再更新好&lt;/li>
&lt;li>是否在Service Layer 使用@AuthenticatedPrincipal&lt;/li>
&lt;li>service引用多个repository或引用对应repository和其他service&lt;/li>
&lt;/ul>
&lt;h2 id="performance-considerations">Performance Considerations
&lt;/h2>&lt;ul>
&lt;li>用户对于帖子或评论的态度（赞同，反对）是否用额外的query查询更好（w4）&lt;/li>
&lt;/ul></description></item><item><title>【ANTLR】Basics</title><link>https://dyhes.github.io/p/antlrbasics/</link><pubDate>Thu, 13 Apr 2023 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/antlrbasics/</guid><description>&lt;h2 id="left-recursive-grammar">&lt;strong>left recursive grammar&lt;/strong>
&lt;/h2>&lt;p>The biggest thing is the new adaptive parsing strategy, which lets us accept any grammar we care to write. That gives us a huge productivity boost because we can now write much more natural expression rules (which occur in almost every grammar).&lt;/p>
&lt;p>ANTLR v4 will also take &lt;strong>left recursive grammar&lt;/strong> now, translating it secretly to a non-left recursive version.&lt;/p>
&lt;h2 id="grammar-lexicon">Grammar Lexicon
&lt;/h2>&lt;h3 id="identifier">&lt;strong>identifier&lt;/strong>
&lt;/h3>&lt;p>Token names always start with a capital letter and so do lexer rules.&lt;/p>
&lt;p>Parser rule names always start with a lowercase letter (those that fail &lt;code>Character.isUpperCase&lt;/code>). The initial character can be followed by uppercase and lowercase letters, digits, and underscores.&lt;/p>
&lt;p>Here are some sample names:&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-g4" data-lang="g4">ID, LPAREN, RIGHT_CURLY // token names/lexer rules
expr, simpleDeclarator, d2, header_file // parser rule names
&lt;/code>&lt;/pre>&lt;h3 id="literal">&lt;strong>literal&lt;/strong>
&lt;/h3>&lt;p>ANTLR &lt;strong>does not distinguish&lt;/strong> between character and string literals as most languages do. All literal strings one or more characters in length are enclosed &lt;strong>in single quotes&lt;/strong> such as &lt;code>';'&lt;/code>, &lt;code>'if'&lt;/code>, &lt;code>'&amp;gt;='&lt;/code>, and &lt;code>'\''&lt;/code> (refers to the one-character string containing the single quote character).&lt;/p>
&lt;p>Literals &lt;strong>never&lt;/strong> contain regular expressions.&lt;/p>
&lt;p>Literals can contain Unicode escape sequences of the form &lt;code>'\uXXXX'&lt;/code> (for Unicode code points up to &lt;code>'U+FFFF'&lt;/code>) or &lt;code>'\u{XXXXXX}'&lt;/code> (for all Unicode code points), where &lt;code>'XXXX'&lt;/code> is the hexadecimal Unicode code point value.&lt;/p>
&lt;p>ANTLR also understands the usual special escape sequences: &lt;code>'\n'&lt;/code> (newline), &lt;code>'\r'&lt;/code> (carriage return), &lt;code>'\t'&lt;/code> (tab), &lt;code>'\b'&lt;/code> (backspace), and &lt;code>'\f'&lt;/code> (form feed). You can use Unicode code points directly within literals or use the Unicode escape sequences.&lt;/p>
&lt;h3 id="actions">Actions
&lt;/h3>&lt;p>Actions are &lt;strong>code blocks written in the target language&lt;/strong>.&lt;/p>
&lt;p>You can use actions in a number of places within a grammar, but the syntax is always the same:&lt;/p>
&lt;p>arbitrary text surrounded by curly braces.&lt;/p>
&lt;p>You don’t need to escape a closing curly character if it’s in a string or comment&lt;/p>
&lt;p>If the curlies are balanced, you also don’t need to escape }.&lt;/p>
&lt;p>Otherwise, escape extra curlies with a backslash: &lt;code>\{&lt;/code> or &lt;code>\}&lt;/code>.&lt;/p>
&lt;p>Embedded code can appear in: &lt;code>@header&lt;/code> and &lt;code>@members&lt;/code> named actions, parser and lexer rules, exception catching specifications, attribute sections for parser rules (return values, arguments, and locals), and some rule element options (currently predicates).&lt;/p>
&lt;p>The &lt;strong>only interpretation&lt;/strong> ANTLR does inside actions relates to grammar attributes; see &lt;a class="link" href="http://pragprog.com/book/tpantlr2/the-definitive-antlr-4-reference" target="_blank" rel="noopener"
>Token Attributes&lt;/a> and Chapter 10, &lt;a class="link" href="http://pragprog.com/book/tpantlr2/the-definitive-antlr-4-reference" target="_blank" rel="noopener"
>Attributes and Actions&lt;/a>.&lt;/p>
&lt;p>Actions embedded within lexer rules are emitted without any interpretation or translation into generated lexers.&lt;/p>
&lt;h3 id="keywords">&lt;strong>Keywords&lt;/strong>
&lt;/h3>&lt;p>Here’s a list of the reserved words in ANTLR grammars:&lt;/p>
&lt;pre tabindex="0">&lt;code>import, fragment, lexer, parser, grammar, returns,
locals, throws, catch, finally, mode, options, tokens
&lt;/code>&lt;/pre>&lt;p>Also, although it is not a keyword, do not use the word &lt;code>rule&lt;/code> as a rule name. Further, do not use any keyword of the target language as a token, label, or rule name. For example, rule &lt;code>if&lt;/code> would result in a generated function called &lt;code>if&lt;/code>. That would not compile obviously.&lt;/p>
&lt;h2 id="grammar-structure">Grammar Structure
&lt;/h2>&lt;p>A grammar is essentially a grammar declaration followed by a list of rules, but has the general form:&lt;/p>
&lt;pre tabindex="0">&lt;code>/** Optional javadoc style comment */
grammar Name;
options {...}
import ... ;
tokens {...}
channels {...} // lexer only
@actionName {...}
rule1 // parser and lexer rules, possibly intermingled
...
ruleN
&lt;/code>&lt;/pre>&lt;p>You can specify options, imports, token specifications, and actions in any order.&lt;/p>
&lt;p>All of those elements are optional except for the header grammar Name and at least one rule. Rules take the basic form:&lt;/p>
&lt;pre tabindex="0">&lt;code>ruleName : alternative1 | ... | alternativeN ;
&lt;/code>&lt;/pre>&lt;p>Grammars defined without a prefix on the &lt;code>grammar&lt;/code> header are combined grammars that can contain both lexical and parser rules.&lt;/p>
&lt;p>Only lexer grammars can contain &lt;code>mode&lt;/code> specifications.&lt;/p>
&lt;p>Only lexer grammars can contain custom channels specifications&lt;/p>
&lt;pre tabindex="0">&lt;code>channels {
WHITESPACE_CHANNEL,
COMMENTS_CHANNEL
}
&lt;/code>&lt;/pre>&lt;p>Those channels can then be used like enums within lexer rules&lt;/p>
&lt;h3 id="grammar-import">Grammar import
&lt;/h3>&lt;p>Grammar &lt;code>imports&lt;/code> let you break up a grammar into logical and reusable chunks. ANTLR treats imported grammars very much like object-oriented programming languages treat super-classes. A grammar inherits all of the rules, tokens specifications, and named actions from the imported grammar. Rules in the “main grammar” &lt;strong>override rules&lt;/strong> from imported grammars to implement inheritance.&lt;/p>
&lt;h3 id="tokens-section">Tokens Section
&lt;/h3>&lt;p>The purpose of the &lt;code>tokens&lt;/code> section is to define token types needed by a grammar for which there is no associated lexical rule. The basic syntax is:&lt;/p>
&lt;pre tabindex="0">&lt;code>tokens { Token1, ..., TokenN }
&lt;/code>&lt;/pre>&lt;p>Most of the time, the tokens section is used to define token types &lt;strong>needed by actions in the grammar&lt;/strong>.&lt;/p>
&lt;pre tabindex="0">&lt;code>// explicitly define keyword token types to avoid implicit definition warnings
tokens { BEGIN, END, IF, THEN, WHILE }
@lexer::members { // keywords map used in lexer to assign token types
Map&amp;lt;String,Integer&amp;gt; keywords = new HashMap&amp;lt;String,Integer&amp;gt;() {{
put(&amp;#34;begin&amp;#34;, KeywordsParser.BEGIN);
put(&amp;#34;end&amp;#34;, KeywordsParser.END);
...
}};
}
&lt;/code>&lt;/pre>&lt;h3 id="action-at-the-grammar-level">Action at the grammar level
&lt;/h3>&lt;p>Currently there are &lt;strong>only two&lt;/strong> defined named actions (for the Java target) used outside of grammar rules: &lt;code>header&lt;/code> and &lt;code>members&lt;/code>. The former injects code into the generated recognizer class file, before the recognizer class definition,&lt;/p>
&lt;p>and the latter injects code into the recognizer class definition, as fields and methods.&lt;/p>
&lt;p>For combined grammars, ANTLR injects the actions into both the parser and the lexer. To restrict an action to the generated parser or lexer, use &lt;code>@parser::name&lt;/code> or &lt;code>@lexer::name&lt;/code>.&lt;/p>
&lt;pre tabindex="0">&lt;code>grammar Count;
@header {
package foo;
}
@members {
int count = 0;
}
&lt;/code>&lt;/pre>&lt;h2 id="parser-rules">Parser Rules
&lt;/h2>&lt;p>Parsers consist of a set of parser rules either in a parser or a combined grammar. A Java application launches a parser by invoking the rule function, generated by ANTLR, associated with the desired start rule.&lt;/p>
&lt;p>Rules can also have alternatives separated by the |&lt;/p>
&lt;pre tabindex="0">&lt;code>operator:
stat: retstat
| &amp;#39;break&amp;#39; &amp;#39;;&amp;#39;
| &amp;#39;continue&amp;#39; &amp;#39;;&amp;#39;
;
&lt;/code>&lt;/pre>&lt;p>Alternatives are either &lt;strong>a list of rule elements or empty&lt;/strong>. For example, here’s a rule with an empty alternative that makes the entire rule optional:&lt;/p>
&lt;pre tabindex="0">&lt;code>superClass
: &amp;#39;extends&amp;#39; ID
| // empty
;
&lt;/code>&lt;/pre>&lt;h3 id="alternative-labels">Alternative labels
&lt;/h3>&lt;p>Labeling Rule Alternatives for Precise Event Methods, we can get &lt;strong>more precise parse-tree listener&lt;/strong> events by labeling the outermost alternatives of a rule using the ## operator. &lt;strong>All&lt;/strong> alternatives within a rule must be labeled, &lt;strong>or none&lt;/strong> of them.&lt;/p>
&lt;p>Here are two rules with labeled alternatives.&lt;/p>
&lt;pre tabindex="0">&lt;code>grammar T;
stat: &amp;#39;return&amp;#39; e &amp;#39;;&amp;#39; ## Return
| &amp;#39;break&amp;#39; &amp;#39;;&amp;#39; ## Break
;
e : e &amp;#39;*&amp;#39; e ## Mult
| e &amp;#39;+&amp;#39; e ## Add
| INT ## Int
;
&lt;/code>&lt;/pre>&lt;p>Alternative labels do not have to be at the end of the line and there does not have to be a space after the ## symbol.&lt;/p>
&lt;p>ANTLR generates a &lt;strong>rule context class definition&lt;/strong> for each label. For example, here is the listener that ANTLR generates:&lt;/p>
&lt;pre tabindex="0">&lt;code>public interface AListener extends ParseTreeListener {
void enterReturn(AParser.ReturnContext ctx);
void exitReturn(AParser.ReturnContext ctx);
void enterBreak(AParser.BreakContext ctx);
void exitBreak(AParser.BreakContext ctx);
void enterMult(AParser.MultContext ctx);
void exitMult(AParser.MultContext ctx);
void enterAdd(AParser.AddContext ctx);
void exitAdd(AParser.AddContext ctx);
void enterInt(AParser.IntContext ctx);
void exitInt(AParser.IntContext ctx);
}
&lt;/code>&lt;/pre>&lt;p>There are &lt;strong>enter and exit methods&lt;/strong> associated with each labeled alternative. The parameters to those methods are &lt;strong>specific&lt;/strong> to alternatives.&lt;/p>
&lt;p>You can reuse the same label on multiple alternatives to indicate that the parse tree walker should trigger &lt;strong>the same event&lt;/strong> for those alternatives.&lt;/p>
&lt;pre tabindex="0">&lt;code>e : e &amp;#39;*&amp;#39; e ## BinaryOp
| e &amp;#39;+&amp;#39; e ## BinaryOp
| INT ## Int
;
&lt;/code>&lt;/pre>&lt;h3 id="rule-context-objects">Rule Context Objects
&lt;/h3>&lt;p>ANTLR generates methods to access the &lt;strong>rule context objects (parse tree nodes)&lt;/strong> associated with each rule reference. For rules with a single rule reference, ANTLR generates a method with no arguments. Consider the following rule.&lt;/p>
&lt;pre tabindex="0">&lt;code> inc : e &amp;#39;++&amp;#39; ;
&lt;/code>&lt;/pre>&lt;p>ANTLR generates this context class:&lt;/p>
&lt;pre tabindex="0">&lt;code>public static class IncContext extends ParserRuleContext {
public EContext e() { ... } // return context object associated with e
...
}
&lt;/code>&lt;/pre>&lt;p>ANTLR also provide support to access context objects when there is more than a single reference to a rule:&lt;/p>
&lt;pre tabindex="0">&lt;code>field : e &amp;#39;.&amp;#39; e ;
&lt;/code>&lt;/pre>&lt;p>ANTLR generates a method with an index to access the ith element as well as a method to get context for all references to that rule:&lt;/p>
&lt;pre tabindex="0">&lt;code>public static class FieldContext extends ParserRuleContext {
public EContext e(int i) { ... } // get ith e context
public List&amp;lt;EContext&amp;gt; e() { ... } // return ALL e contexts
...
}
&lt;/code>&lt;/pre>&lt;p>If we had another rule, s, that references field, an embedded action &lt;strong>could access the list of e rule matches performed by field&lt;/strong>:&lt;/p>
&lt;pre tabindex="0">&lt;code>s : field
{
List&amp;lt;EContext&amp;gt; x = $field.ctx.e();
...
}
;
&lt;/code>&lt;/pre>&lt;h3 id="rule-element-labels">Rule Element Labels
&lt;/h3>&lt;h4 id="-operator">= operator
&lt;/h4>&lt;p>You can label rule elements using the &lt;strong>= operator&lt;/strong> to add fields to the rule context objects:&lt;/p>
&lt;pre tabindex="0">&lt;code>stat: &amp;#39;return&amp;#39; value=e &amp;#39;;&amp;#39; ## Return
| &amp;#39;break&amp;#39; &amp;#39;;&amp;#39; ## Break
;
&lt;/code>&lt;/pre>&lt;p>Here value is the label for the return value of rule e, which is defined elsewhere. Labels become fields in the appropriate parse tree node class.&lt;/p>
&lt;p>In this case, label value becomes a field in ReturnContext because of the Return alternative label:&lt;/p>
&lt;pre tabindex="0">&lt;code>public static class ReturnContext extends StatContext {
public EContext value;
...
}
&lt;/code>&lt;/pre>&lt;h4 id="-operator-1">+= operator
&lt;/h4>&lt;p>It’s often handy to &lt;strong>track a number of tokens&lt;/strong>, which you can do with the &lt;strong>+= “list label” operator&lt;/strong>. For example, the following rule creates a list of the Token objects matched for a simple array construct:&lt;/p>
&lt;pre tabindex="0">&lt;code> array : &amp;#39;{&amp;#39; el+=INT (&amp;#39;,&amp;#39; el+=INT)* &amp;#39;}&amp;#39; ;
&lt;/code>&lt;/pre>&lt;p>ANTLR generates a List field in the appropriate rule context class:&lt;/p>
&lt;pre tabindex="0">&lt;code> public static class ArrayContext extends ParserRuleContext {
public List&amp;lt;Token&amp;gt; el = new ArrayList&amp;lt;Token&amp;gt;();
...
}
&lt;/code>&lt;/pre>&lt;p>These list labels also work for rule references:&lt;/p>
&lt;pre tabindex="0">&lt;code> elist : exprs+=e (&amp;#39;,&amp;#39; exprs+=e)* ;
&lt;/code>&lt;/pre>&lt;p>ANTLR generates a field holding the list of context objects:&lt;/p>
&lt;pre tabindex="0">&lt;code> public static class ElistContext extends ParserRuleContext {
public List&amp;lt;EContext&amp;gt; exprs = new ArrayList&amp;lt;EContext&amp;gt;();
...
}
&lt;/code>&lt;/pre>&lt;h3 id="rule-elements">Rule Elements
&lt;/h3>&lt;p>Rule elements specify what the parser should do at a given moment just like statements in a programming language. The elements can be rule, token, string literal like expression, ID, and &amp;lsquo;return&amp;rsquo;. Here’s a complete list of the rule elements (we’ll look at actions and predicates in more detail later):&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Syntax&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>T&lt;/td>
&lt;td>Match token T at the current input position. Tokens always begin with a capital letter.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;rsquo;literal&amp;rsquo;&lt;/td>
&lt;td>Match the string literal at the current input position. A string literal is simply &lt;strong>a token with a fixed string&lt;/strong>.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>r&lt;/td>
&lt;td>Match rule r at current input position, which amounts to invoking the rule just like a function call. Parser rule names always begin with a lowercase letter.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>r [«args»]&lt;/td>
&lt;td>Match rule r at current input position, &lt;strong>passing in a list of arguments just like a function call&lt;/strong>. The arguments inside the square brackets are in the syntax of the target language and are usually a comma-separated list of expressions.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>{«action»}&lt;/td>
&lt;td>Execute an action immediately after the preceding alternative element and immediately before the following alternative element. The action conforms to the syntax of the target language. ANTLR copies the action code to the generated class verbatim, except for substituting attribute and token references such as $x and $x.y.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>{«p»}?&lt;/td>
&lt;td>Evaluate &lt;strong>semantic predicate&lt;/strong> «p». Do not continue parsing past a predicate if «p» &lt;strong>evaluates to false&lt;/strong> at runtime. Predicates encountered during prediction, when ANTLR distinguishes between alternatives, enable or disable the alternative(s) surrounding the predicate(s).&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>.&lt;/td>
&lt;td>Match any single token except for the end of file token. The “dot” operator is called the &lt;strong>wildcard&lt;/strong>.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>When you want to match everything but a particular token or set of tokens, use the &lt;code>~&lt;/code> “not” operator. This operator is rarely used in the parser but is available.&lt;/p>
&lt;h3 id="subrules">Subrules
&lt;/h3>&lt;p>A rule can contain alternative blocks called subrules (as allowed in Extended BNF Notation: EBNF). &lt;strong>A subrule is like a rule that lacks a name and is enclosed in parentheses&lt;/strong>. Subrules can have one or more alternatives inside the parentheses. Subrules cannot define attributes with locals and returns like rules can. There are four kinds of subrules (x, y, and z represent grammar fragments):&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Syntax&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;a class="link" href="https://github.com/antlr/antlr4/blob/master/doc/images/xyz.png" target="_blank" rel="noopener"
>&lt;img src="https://github.com/antlr/antlr4/raw/master/doc/images/xyz.png"
loading="lazy"
alt="img"
>&lt;/a>&lt;/td>
&lt;td>(x|y|z). Match any alternative within the subrule exactly once. Example: ` returnType : (type&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a class="link" href="https://github.com/antlr/antlr4/blob/master/doc/images/xyz_opt.png" target="_blank" rel="noopener"
>&lt;img src="https://github.com/antlr/antlr4/raw/master/doc/images/xyz_opt.png"
loading="lazy"
alt="img"
>&lt;/a>&lt;/td>
&lt;td>(x|y|z)? Match nothing or any alternative within subrule. Example: &lt;code> classDeclaration : 'class' ID (typeParameters)? ('extends' type)? ('implements' typeList)? classBody ; &lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a class="link" href="https://github.com/antlr/antlr4/blob/master/doc/images/xyz_star.png" target="_blank" rel="noopener"
>&lt;img src="https://github.com/antlr/antlr4/raw/master/doc/images/xyz_star.png"
loading="lazy"
alt="img"
>&lt;/a>&lt;/td>
&lt;td>(x|y|z)* Match an alternative within subrule zero or more times. Example: &lt;code>annotationName : ID ('.' ID)* ;&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a class="link" href="https://github.com/antlr/antlr4/blob/master/doc/images/xyz_plus.png" target="_blank" rel="noopener"
>&lt;img src="https://github.com/antlr/antlr4/raw/master/doc/images/xyz_plus.png"
loading="lazy"
alt="img"
>&lt;/a>&lt;/td>
&lt;td>(x|y|z)+ Match an alternative within subrule one or more times. Example: &lt;code>annotations : (annotation)+ ;&lt;/code>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>You can suffix the &lt;code>?&lt;/code>, &lt;code>*&lt;/code>, and &lt;code>+&lt;/code> subrule operators with the &lt;strong>nongreedy operator&lt;/strong>, which is also a question mark: &lt;code>??&lt;/code>, &lt;code>*?&lt;/code>, and &lt;code>+?&lt;/code>.&lt;/p>
&lt;p>As a &lt;strong>shorthand&lt;/strong>, you can omit the parentheses for subrules composed of a single alternative with a single rule element reference. For example, &lt;code>annotation+&lt;/code> is the same as &lt;code>(annotation)+&lt;/code> and &lt;code>ID+&lt;/code> is the same as &lt;code>(ID)+&lt;/code>. Labels also work with the shorthand. &lt;code>ids+=INT+&lt;/code> make a list of &lt;code>INT&lt;/code> token objects.&lt;/p>
&lt;h3 id="catching-exceptions">Catching Exceptions
&lt;/h3>&lt;p>When a syntax error occurs within a rule, ANTLR catches the exception, reports the error, attempts to recover (possibly by consuming more tokens), and then returns from the rule. Every rule is wrapped in a &lt;code>try/catch/finally&lt;/code> statement:&lt;/p>
&lt;pre tabindex="0">&lt;code>void r() throws RecognitionException {
try {
rule-body
}
catch (RecognitionException re) {
_errHandler.reportError(this, re);
_errHandler.recover(this, re);
}
finally {
exitRule();
}
}
&lt;/code>&lt;/pre>&lt;p>We can use a strategy object to alter ANTLR’s error handling. Replacing the strategy changes the strategy &lt;strong>for all rules&lt;/strong>, however. To alter the exception handling for a single rule, specify an exception after the rule definition:&lt;/p>
&lt;pre tabindex="0">&lt;code>r : ...
;
catch[RecognitionException e] { throw e; }
&lt;/code>&lt;/pre>&lt;p>That example shows how to avoid default error reporting and recovery. r rethrows the exception, which is useful when it makes more sense for a higher-level rule to report the error. Specifying any exception clause, prevents ANTLR from generating a clause to handle &lt;code>RecognitionException&lt;/code>.&lt;/p>
&lt;p>You can specify other exceptions as well:&lt;/p>
&lt;pre tabindex="0">&lt;code>r : ...
;
catch[FailedPredicateException fpe] { ... }
catch[RecognitionException e] { ... }
&lt;/code>&lt;/pre>&lt;p>The code snippets inside curly braces and the exception “argument” actions must be written in the target language; Java, in this case. When you need to execute an action even if an exception occurs, put it into the &lt;code>finally&lt;/code> clause:&lt;/p>
&lt;pre tabindex="0">&lt;code>r : ...
;
// catch blocks go first
finally { System.out.println(&amp;#34;exit rule r&amp;#34;); }
&lt;/code>&lt;/pre>&lt;p>The finally clause executes right before the rule triggers &lt;code>exitRule&lt;/code> before returning. If you want to execute an action after the rule finishes matching the alternatives but before it does its cleanup work, use an &lt;code>after&lt;/code> action.&lt;/p>
&lt;p>Here’s a complete list of exceptions:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Exception name&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>RecognitionException&lt;/td>
&lt;td>The superclass of all exceptions thrown by an ANTLR-generated recognizer. It’s a subclass of RuntimeException to avoid the hassles of checked exceptions. This exception records where the recognizer (lexer or parser) was in the input, where it was in the ATN (internal graph data structure representing the grammar), the rule invocation stack, and what kind of problem occurred.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>NoViableAltException&lt;/td>
&lt;td>Indicates that the parser could not decide which of two or more paths to take by looking at the remaining input. This exception tracks the starting token of the offending input and also knows where the parser was in the various paths when the error occurred.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>LexerNoViableAltException&lt;/td>
&lt;td>The equivalent of NoViableAltException but for lexers only.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>InputMismatchException&lt;/td>
&lt;td>The current input Token does not match what the parser expected.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FailedPredicateException&lt;/td>
&lt;td>A semantic predicate that evaluates to false during prediction renders the surrounding alternative nonviable. Prediction occurs when a rule is predicting which alternative to take. If all viable paths disappear, parser will throw NoViableAltException. This predicate gets thrown by the parser when a semantic predicate evaluates to false outside of prediction, during the normal parsing process of matching tokens and calling rules.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="rule-attribute-definitions">Rule Attribute Definitions
&lt;/h3>&lt;p>There are a number of action-related syntax elements associated with rules to be aware of. Rules can have &lt;strong>arguments, return values, and local variables&lt;/strong> just like functions in a programming language. ANTLR &lt;strong>collects all of the variables you define and stores them in the rule context object&lt;/strong>. These variables are usually called &lt;strong>attributes&lt;/strong>.&lt;/p>
&lt;p>Here’s the general syntax showing all possible attribute definition locations:&lt;/p>
&lt;pre tabindex="0">&lt;code>rulename[args] returns [retvals] locals [localvars] : ... ;
&lt;/code>&lt;/pre>&lt;p>The attributes defined within those [&amp;hellip;] can be used like any other variable. Here is a sample rule that copies parameters to return values:&lt;/p>
&lt;pre tabindex="0">&lt;code>// Return the argument plus the integer value of the INT token
add[int x] returns [int result] : &amp;#39;+=&amp;#39; INT {$result = $x + $INT.int;} ;
&lt;/code>&lt;/pre>&lt;p>The args, locals, and return &lt;code>[...]&lt;/code> are generally in the target language but &lt;strong>with some constraints&lt;/strong>. The &lt;code>[...]&lt;/code> string is a comma-separated list of declarations either with prefix or postfix type notation or no-type notation. The elements can have initializer such as &lt;code>[int x = 32, float y]&lt;/code> but don&amp;rsquo;t go too crazy as we are parsing this generic text manually in &lt;a class="link" href="https://github.com/antlr/antlr4/blob/master/tool/src/org/antlr/v4/parse/ScopeParser.java" target="_blank" rel="noopener"
>ScopeParser&lt;/a>.&lt;/p>
&lt;h4 id="rule-level-named-actions">rule-level named actions
&lt;/h4>&lt;p>As with the grammar level, you can specify rule-level named actions. For rules, the valid names are &lt;strong>&lt;code>init&lt;/code> and &lt;code>after&lt;/code>.&lt;/strong> As the names imply, parsers execute init actions immediately before trying to match the associated rule and execute after actions immediately after matching the rule.&lt;/p>
&lt;p>ANTLR after actions do not execute as part of the finally code block of the generated rule function. Use the ANTLR finally action to place code in the generated rule function finally code block.&lt;/p>
&lt;p>The actions come after any argument, return value, or local attribute definition actions. The &lt;code>row&lt;/code> rule preamble from Section 10.2, Accessing Token and Rule Attributes illustrates the syntax nicely: actions/CSV.g4&lt;/p>
&lt;pre tabindex="0">&lt;code>/** Derived from rule &amp;#34;row : field (&amp;#39;,&amp;#39; field)* &amp;#39;\r&amp;#39;? &amp;#39;\n&amp;#39; ;&amp;#34; */
row[String[] columns]
returns [Map&amp;lt;String,String&amp;gt; values]
locals [int col=0]
@init {
$values = new HashMap&amp;lt;String,String&amp;gt;();
}
@after {
if ($values!=null &amp;amp;&amp;amp; $values.size()&amp;gt;0) {
System.out.println(&amp;#34;values = &amp;#34;+$values);
}
}
: ...
;
&lt;/code>&lt;/pre>&lt;p>Rule row takes argument columns, returns values, and defines local variable col. The “actions” in square brackets are copied directly into the generated code. The generated rule functions also specify the rule arguments as function arguments, but they are quickly copied into the local RowContext object:&lt;/p>
&lt;pre tabindex="0">&lt;code>public class CSVParser extends Parser {
...
public static class RowContext extends ParserRuleContext {
public String [] columns;
public Map&amp;lt;String,String&amp;gt; values;
public int col=0;
...
public final RowContext row(String [] columns) throws RecognitionException {
RowContext _localctx = new RowContext(_ctx, 4, columns);
enterRule(_localctx, RULE_row);
...
}
}
...
}
&lt;/code>&lt;/pre>&lt;p>ANTLR tracks nested &lt;code>[...]&lt;/code> within the action so that &lt;code>String[]&lt;/code> columns is parsed properly. It also tracks angle brackets so that commas within generic type parameters do not signify the start of another attribute. &lt;code>Map&amp;lt;String,String&amp;gt;&lt;/code> values is one attribute definition.&lt;/p>
&lt;p>There can be multiple attributes in each action, even for return values. Use a comma to separate attributes within the same action:&lt;/p>
&lt;pre tabindex="0">&lt;code>a[Map&amp;lt;String,String&amp;gt; x, int y] : ... ;
&lt;/code>&lt;/pre>&lt;p>ANTLR interprets that action to define two arguments, x and y:&lt;/p>
&lt;pre tabindex="0">&lt;code>public final AContext a(Map&amp;lt;String,String&amp;gt; x, int y)
throws RecognitionException
{
AContext _localctx = new AContext(_ctx, 0, x, y);
enterRule(_localctx, RULE_a);
...
}
&lt;/code>&lt;/pre>&lt;h3 id="start-rules-and-eof">Start Rules and EOF
&lt;/h3>&lt;p>A start rule is the rule engaged first by the parser; it’s the rule function called by the language application. &lt;strong>Any&lt;/strong> rule in the grammar can act as a start rule.&lt;/p>
&lt;p>Start rules don’t necessarily consume all of the input. They consume &lt;strong>only as much input as needed&lt;/strong> to match an alternative of the rule. For example, consider the following rule that matches one, two, or three tokens, depending on the input.&lt;/p>
&lt;pre tabindex="0">&lt;code>s : ID
| ID &amp;#39;+&amp;#39;
| ID &amp;#39;+&amp;#39; INT
;
&lt;/code>&lt;/pre>&lt;p>Upon &lt;code>a+3&lt;/code>, rule &lt;code>s&lt;/code> matches the third alternative. Upon &lt;code>a+b&lt;/code>, it matches the second alternative and ignores the final &lt;code>b&lt;/code> token. Upon &lt;code>a b&lt;/code>, it matches the first alternative, ignoring the &lt;code>b&lt;/code> token. The parser does not consume the complete input in the latter two cases because rule &lt;code>s&lt;/code> doesn’t explicitly say that end of file must occur after matching an alternative of the rule.&lt;/p>
&lt;p>On the other hand, &lt;strong>rules that describe entire input files should reference special predefined-token &lt;code>EOF&lt;/code>.&lt;/strong> If they don’t, you might scratch your head for a while wondering why the start rule doesn’t report errors for any input no matter what you give it. Here’s a rule that’s part of a grammar for reading configuration files:&lt;/p>
&lt;pre tabindex="0">&lt;code>config : element*; // can &amp;#34;match&amp;#34; even with invalid input.
&lt;/code>&lt;/pre>&lt;p>Invalid input would cause &lt;code>config&lt;/code> to return immediately without matching any input and without reporting an error. Here’s the proper specification:&lt;/p>
&lt;pre tabindex="0">&lt;code>file : element* EOF; // don&amp;#39;t stop early. must match all input
&lt;/code>&lt;/pre>&lt;h2 id="left-recursive-rules">Left-recursive rules
&lt;/h2>&lt;p>The most natural expression of some common language constructs is left recursive. Unfortunately, left recursive specifications of arithmetic expressions are typically &lt;strong>ambiguous&lt;/strong> but much easier to write out than the multiple levels required in a typical top-down grammar. Here is a sample ANTLR 4 grammar with a left recursive expression rule:&lt;/p>
&lt;pre tabindex="0">&lt;code>stat: expr &amp;#39;=&amp;#39; expr &amp;#39;;&amp;#39; // e.g., x=y; or x=f(x);
| expr &amp;#39;;&amp;#39; // e.g., f(x); or f(g(x));
;
expr: expr &amp;#39;*&amp;#39; expr
| expr &amp;#39;+&amp;#39; expr
| expr &amp;#39;(&amp;#39; expr &amp;#39;)&amp;#39; // f(x)
| id
;
&lt;/code>&lt;/pre>&lt;p>In straight context free grammars, such a rule is ambiguous because 1+2*3 it can interpret either operator as occurring first, but ANTLR rewrites that to be non-left recursive and unambiguous using &lt;strong>semantic predicates&lt;/strong>:&lt;/p>
&lt;pre tabindex="0">&lt;code>expr[int pr] : id
( {4 &amp;gt;= $pr}? &amp;#39;*&amp;#39; expr[5]
| {3 &amp;gt;= $pr}? &amp;#39;+&amp;#39; expr[4]
| {2 &amp;gt;= $pr}? &amp;#39;(&amp;#39; expr[0] &amp;#39;)&amp;#39;
)*
;
&lt;/code>&lt;/pre>&lt;p>The predicates resolve ambiguities by comparing the precedence of the current operator against the precedence of the previous operator. An expansion of expr[pr] can match only those subexpressions whose precedence meets or exceeds pr.&lt;/p>
&lt;h3 id="formal-rules">Formal rules
&lt;/h3>&lt;p>The formal 4.0, 4.1 ANTLR left-recursion elimination rules were changed (simplified) for 4.2 and are laid out in the &lt;a class="link" href="http://www.antlr.org/papers/allstar-techreport.pdf" target="_blank" rel="noopener"
>ALL(*) tech report&lt;/a>:&lt;/p>
&lt;ul>
&lt;li>Binary expressions are expressions which contain a recursive invocation of the rule as the first and last element of the alternative.&lt;/li>
&lt;li>Suffix expressions contain a recursive invocation of the rule as the first element of the alternative, but not as the last element.&lt;/li>
&lt;li>Prefix expressions contain a recursive invocation of the rule as the last element of the alternative, but not as the first element.&lt;/li>
&lt;/ul>
&lt;p>There is no such thing as a &amp;ldquo;ternary&amp;rdquo; expression&amp;ndash;they are just binary expressions in disguise.&lt;/p>
&lt;p>The right associativity specifiers used to be on the individual tokens but it&amp;rsquo;s done on alternative basis anyway so the option is now on the individual alternative; e.g.,&lt;/p>
&lt;pre tabindex="0">&lt;code>e : e &amp;#39;*&amp;#39; e
| e &amp;#39;+&amp;#39; e
|&amp;lt;assoc=right&amp;gt; e &amp;#39;?&amp;#39; e &amp;#39;:&amp;#39; e
|&amp;lt;assoc=right&amp;gt; e &amp;#39;=&amp;#39; e
| INT
;
&lt;/code>&lt;/pre>&lt;p>If your 4.0 or 4.1 grammar uses a right-associative ternary operator, you will need to update your grammar to include &lt;code>&amp;lt;assoc=right&amp;gt;&lt;/code> on the alternative operator. To smooth the transition, &lt;code>&amp;lt;assoc=right&amp;gt;&lt;/code> is still allowed on token references but it is ignored.&lt;/p>
&lt;h2 id="actions-and-attributes">Actions and Attributes
&lt;/h2>&lt;p>Actions are blocks of text written in the target language and enclosed in curly braces. The recognizer triggers them according to their locations within the grammar. For example, the following rule emits &amp;ldquo;found a decl&amp;rdquo; after the parser has seen a valid declaration:&lt;/p>
&lt;pre tabindex="0">&lt;code>decl: type ID &amp;#39;;&amp;#39; {System.out.println(&amp;#34;found a decl&amp;#34;);} ;
type: &amp;#39;int&amp;#39; | &amp;#39;float&amp;#39; ;
&lt;/code>&lt;/pre>&lt;p>Most often, actions access the attributes of tokens and rule references:&lt;/p>
&lt;pre tabindex="0">&lt;code>decl: type ID &amp;#39;;&amp;#39;
{System.out.println(&amp;#34;var &amp;#34;+$ID.text+&amp;#34;:&amp;#34;+$type.text+&amp;#34;;&amp;#34;);}
| t=ID id=ID &amp;#39;;&amp;#39;
{System.out.println(&amp;#34;var &amp;#34;+$id.text+&amp;#34;:&amp;#34;+$t.text+&amp;#34;;&amp;#34;);}
;
&lt;/code>&lt;/pre>&lt;h3 id="token-attributes">Token Attributes
&lt;/h3>&lt;p>All tokens have a collection of predefined, read-only &lt;strong>attributes&lt;/strong>. The attributes include useful token &lt;strong>properties&lt;/strong> such as the token type and text matched for a token. Actions can access these attributes via &lt;code>$label.attribute&lt;/code> where label labels a particular instance of a token reference (&lt;code>a&lt;/code> and &lt;code>b&lt;/code> in the example below are used in the action code as &lt;code>$a&lt;/code> and &lt;code>$b&lt;/code>). Often, a particular token is only referenced once in the rule, in which case the token name itself can be used unambiguously in the action code (token &lt;code>INT&lt;/code> can be used as &lt;code>$INT&lt;/code> in the action). The following example illustrates token attribute expression syntax:&lt;/p>
&lt;pre tabindex="0">&lt;code>r : INT {int x = $INT.line;}
( ID {if ($INT.line == $ID.line) ...;} )?
a=FLOAT b=FLOAT {if ($a.line == $b.line) ...;}
;
&lt;/code>&lt;/pre>&lt;p>The action within the &lt;code>(...)?&lt;/code> subrule can see the &lt;code>INT&lt;/code> token matched before it in the outer level.&lt;/p>
&lt;p>Because there are two references to the &lt;code>FLOAT&lt;/code> token, a reference to &lt;code>$FLOAT&lt;/code> in an action is not unique; you must use labels to specify which token reference you’re interested in.&lt;/p>
&lt;p>Token references within different alternatives are unique because only one of them can be matched for any invocation of the rule. For example, in the following rule, actions in both alternatives can reference &lt;code>$ID&lt;/code> directly without using a label:&lt;/p>
&lt;pre tabindex="0">&lt;code> r : ... ID {System.out.println($ID.text);}
| ... ID {System.out.println($ID.text);}
;
&lt;/code>&lt;/pre>&lt;p>To access the tokens matched for literals, you must use a label:&lt;/p>
&lt;pre tabindex="0">&lt;code> stat: r=&amp;#39;return&amp;#39; expr &amp;#39;;&amp;#39; {System.out.println(&amp;#34;line=&amp;#34;+$r.line);} ;
&lt;/code>&lt;/pre>&lt;p>Most of the time you access the attributes of the token, but sometimes it is useful to access the Token object itself because it aggregates all the attributes. Further, you can use it to test whether an optional subrule matched a token:&lt;/p>
&lt;pre tabindex="0">&lt;code> stat: &amp;#39;if&amp;#39; expr &amp;#39;then&amp;#39; stat (el=&amp;#39;else&amp;#39; stat)?
{if ( $el!=null ) System.out.println(&amp;#34;found an else&amp;#34;);}
| ...
;
&lt;/code>&lt;/pre>&lt;p>&lt;code>$T&lt;/code> and &lt;code>$L&lt;/code> evaluate to &lt;code>Token&lt;/code> objects for token name &lt;code>T&lt;/code> and token label &lt;code>L&lt;/code>. &lt;code>$ll&lt;/code> evaluates to &lt;code>List&amp;lt;Token&amp;gt;&lt;/code> for list label &lt;code>ll&lt;/code>. &lt;code>$T.attr&lt;/code> evaluates to the type and value specified in the following table for attribute &lt;code>attr&lt;/code>:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Attribute&lt;/th>
&lt;th>Type&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>text&lt;/td>
&lt;td>String&lt;/td>
&lt;td>The text matched for the token; translates to a call to getText. Example: $ID.text.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>type&lt;/td>
&lt;td>int&lt;/td>
&lt;td>The token type (nonzero positive integer) of the token such as INT; translates to a call to getType. Example: $ID.type.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>line&lt;/td>
&lt;td>int&lt;/td>
&lt;td>The line number on which the token occurs, counting from 1; translates to a call to getLine. Example: $ID.line.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>pos&lt;/td>
&lt;td>int&lt;/td>
&lt;td>The character position within the line at which the token’s first character occurs counting from zero; translates to a call to getCharPositionInLine. Example: $ID.pos.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>index&lt;/td>
&lt;td>int&lt;/td>
&lt;td>The overall index of this token in the token stream, counting from zero; translates to a call to getTokenIndex. Example: $ID.index.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>channel&lt;/td>
&lt;td>int&lt;/td>
&lt;td>The token’s channel number. The parser tunes to only one channel, effectively ignoring off-channel tokens. The default channel is 0 (Token.DEFAULT_CHANNEL), and the default hidden channel is Token.HIDDEN_CHANNEL. Translates to a call to getChannel. Example: $ID.channel.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>int&lt;/td>
&lt;td>int&lt;/td>
&lt;td>The integer value of the text held by this token; it assumes that the text is a valid numeric string. Handy for building calculators and so on. Translates to Integer.valueOf(text-of-token). Example: $INT.int.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="parser-rule-attributes">Parser Rule Attributes
&lt;/h3>&lt;p>ANTLR predefines a number of read-only attributes associated with parser rule references that are available to actions. Actions can access rule attributes only for references that precede the action. The syntax is &lt;code>$r.attr&lt;/code> for rule name &lt;code>r&lt;/code> or a label assigned to a rule reference. For example, &lt;code>$expr.text&lt;/code> returns the complete text matched by a preceding invocation of rule &lt;code>expr&lt;/code>:&lt;/p>
&lt;pre tabindex="0">&lt;code>returnStat : &amp;#39;return&amp;#39; expr {System.out.println(&amp;#34;matched &amp;#34;+$expr.text);} ;
&lt;/code>&lt;/pre>&lt;p>Using a rule label looks like this:&lt;/p>
&lt;pre tabindex="0">&lt;code>returnStat : &amp;#39;return&amp;#39; e=expr {System.out.println(&amp;#34;matched &amp;#34;+$e.text);} ;
&lt;/code>&lt;/pre>&lt;p>You can also use &lt;code>$&lt;/code> followed by the name of the attribute to access the value associated with the currently executing rule. For example, &lt;code>$start&lt;/code> is the starting token of the current rule.&lt;/p>
&lt;pre tabindex="0">&lt;code>returnStat : &amp;#39;return&amp;#39; expr {System.out.println(&amp;#34;first token &amp;#34;+$start.getText());} ;
&lt;/code>&lt;/pre>&lt;p>&lt;code>$r&lt;/code> and &lt;code>$rl&lt;/code> evaluate to &lt;code>ParserRuleContext&lt;/code> objects of type &lt;code>RContext&lt;/code> for rule name &lt;code>r&lt;/code> and rule label &lt;code>rl&lt;/code>. &lt;code>$rll&lt;/code> evaluates to &lt;code>List&amp;lt;RContext&amp;gt;&lt;/code> for rule list label &lt;code>rll&lt;/code>. &lt;code>$r.attr&lt;/code> evaluates to the type and value specified in the following table for attribute &lt;code>attr&lt;/code>:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Attribute&lt;/th>
&lt;th>Type&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>text&lt;/td>
&lt;td>String&lt;/td>
&lt;td>The &lt;strong>text matched&lt;/strong> for a rule or the text matched from the start of the rule up until the point of the &lt;code>$text&lt;/code> expression evaluation. Note that this includes the text for all tokens including those on hidden channels, which is what you want because usually that has all the whitespace and comments. When referring to the current rule, this attribute is available in any action including any exception actions.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>start&lt;/td>
&lt;td>Token&lt;/td>
&lt;td>The &lt;strong>first token&lt;/strong> to be potentially matched by the rule that is on the main token channel; in other words, this attribute is never a hidden token. For rules that end up matching no tokens, this attribute points at the first token that could have been matched by this rule. When referring to the current rule, this attribute is available to any action within the rule.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>stop&lt;/td>
&lt;td>Token&lt;/td>
&lt;td>The last nonhidden channel token to be matched by the rule. When referring to the current rule, this attribute is available only to the after and finally actions.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ctx&lt;/td>
&lt;td>ParserRuleContext&lt;/td>
&lt;td>The rule context object associated with a rule invocation. All of the other attributes are available through this attribute. For example, &lt;code>$ctx.start&lt;/code> accesses the start field within the current rules context object. It’s the same as &lt;code>$start&lt;/code>.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>parser&lt;/td>
&lt;td>Parser&lt;/td>
&lt;td>The parser itself. This attribute can be used, for example, to invoke a method defined in the parser&amp;rsquo;s &lt;code>@members&lt;/code> section from a semantic predicate.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="dynamically-scoped-attributes">Dynamically-Scoped Attributes
&lt;/h3>&lt;p>You can pass information to and from rules using parameters and return values, just like functions in a general-purpose programming language. Programming languages don’t allow functions to access the local variables or parameters of invoking functions, however. For example, the following reference to local variable &lt;code>x&lt;/code> form a nested method call is illegal in Java:&lt;/p>
&lt;pre tabindex="0">&lt;code>void f() {
int x = 0;
g();
}
void g() {
h();
}
void h() {
int y = x; // INVALID reference to f&amp;#39;s local variable x
}
&lt;/code>&lt;/pre>&lt;p>Variable &lt;code>x&lt;/code> is available only within the scope of &lt;code>f&lt;/code>, which is the text lexically delimited by curly brackets. For this reason, Java is said to use lexical scoping. Lexical scoping is the norm for most programming languages. Languages that allow methods further down in the call chain to access local variables defined earlier are said to use dynamic scoping. The term dynamic refers to the fact that a compiler cannot statically determine the set of visible variables. This is because the set of variables visible to a method changes depending on who calls that method.&lt;/p>
&lt;p>It turns out that, in the grammar realm, distant rules sometimes need to communicate with each other, mostly to provide context information to rules matched below in the rule invocation chain. (Naturally, this assumes that you are using actions directly in the grammar instead of the parse-tree listener event mechanism.) ANTLR allows dynamic scoping in that actions can access attributes from invoking rules using syntax &lt;code>$r::x&lt;/code> where &lt;code>r&lt;/code> is a rule name and &lt;code>x&lt;/code> is an attribute within that rule. It is up to the programmer to ensure that &lt;code>r&lt;/code> is in fact an invoking rule of the current rule. A runtime exception occurs if &lt;code>r&lt;/code> is not in the current call chain when you access &lt;code>$r::x&lt;/code>.&lt;/p>
&lt;p>To illustrate the use of dynamic scoping, consider the real problem of defining variables and ensuring that variables in expressions are defined. The following grammar defines the symbols attribute where it belongs in the block rule but adds variable names to it in rule &lt;code>decl&lt;/code>. Rule &lt;code>stat&lt;/code> then consults the list to see whether variables have been defined.&lt;/p>
&lt;pre tabindex="0">&lt;code>grammar DynScope;
prog: block ;
block
/* List of symbols defined within this block */
locals [
List&amp;lt;String&amp;gt; symbols = new ArrayList&amp;lt;String&amp;gt;()
]
: &amp;#39;{&amp;#39; decl* stat+ &amp;#39;}&amp;#39;
// print out all symbols found in block
// $block::symbols evaluates to a List as defined in scope
{System.out.println(&amp;#34;symbols=&amp;#34;+$symbols);}
;
/** Match a declaration and add identifier name to list of symbols */
decl: &amp;#39;int&amp;#39; ID {$block::symbols.add($ID.text);} &amp;#39;;&amp;#39; ;
/** Match an assignment then test list of symbols to verify
* that it contains the variable on the left side of the assignment.
* Method contains() is List.contains() because $block::symbols
* is a List.
*/
stat: ID &amp;#39;=&amp;#39; INT &amp;#39;;&amp;#39;
{
if ( !$block::symbols.contains($ID.text) ) {
System.err.println(&amp;#34;undefined variable: &amp;#34;+$ID.text);
}
}
| block
;
ID : [a-z]+ ;
INT : [0-9]+ ;
WS : [ \t\r\n]+ -&amp;gt; skip ;
&lt;/code>&lt;/pre>&lt;p>Here’s a simple build and test sequence:&lt;/p>
&lt;pre tabindex="0">&lt;code>$ antlr4 DynScope.g4
$ javac DynScope*.java
$ grun DynScope prog
=&amp;gt; {
=&amp;gt; int i;
=&amp;gt; i = 0;
=&amp;gt; j = 3;
=&amp;gt; }
=&amp;gt; EOF
&amp;lt;= undefined variable: j
symbols=[i]
&lt;/code>&lt;/pre>&lt;p>There’s an important difference between a simple field declaration in a &lt;code>@members&lt;/code> action and dynamic scoping. symbols is a local variable and so there is a copy for each invocation of rule &lt;code>block&lt;/code>. That’s exactly what we want for nested blocks so that we can reuse the same input variable name in an inner block. For example, the following nested code block redefines &lt;code>i&lt;/code> in the inner scope. This new definition must hide the definition in the outer scope.&lt;/p>
&lt;pre tabindex="0">&lt;code>{
int i;
int j;
i = 0;
{
int i;
int x;
x = 5;
}
x = 3;
}
&lt;/code>&lt;/pre>&lt;p>Here’s the output generated for that input by DynScope:&lt;/p>
&lt;pre tabindex="0">&lt;code>$ grun DynScope prog nested-input
symbols=[i, x]
undefined variable: x
symbols=[i, j]
&lt;/code>&lt;/pre>&lt;p>Referencing &lt;code>$block::symbols&lt;/code> accesses the &lt;code>symbols&lt;/code> field of the most recently invoked &lt;code>block&lt;/code>’s rule context object. If you need access to a symbols instance from a rule invocation farther up the call chain, you can walk backwards starting at the current context, &lt;code>$ctx&lt;/code>. Use &lt;code>getParent&lt;/code> to walk up the chain.&lt;/p>
&lt;h2 id="parse-tree-listeners">Parse Tree Listeners
&lt;/h2>&lt;p>By default, ANTLR-generated parsers build a data structure called a parse tree or syntax tree that records how the parser recognized the structure of the input sentence and component phrases.&lt;/p>
&lt;p>The interior nodes of the parse tree are &lt;strong>phrase names&lt;/strong> that &lt;strong>group and identify their children&lt;/strong>. The root node is the &lt;strong>most abstract&lt;/strong> phrase name. The leaves of a parse tree are always the &lt;strong>input tokens&lt;/strong>.&lt;/p>
&lt;p>Parse trees sit between a language recognizer and an interpreter or translator implementation. They are extremely effective data structures because they contain all of the input and complete knowledge of &lt;strong>how&lt;/strong> the parser grouped the symbols into phrases. Better yet, they are easy to understand and the parser generates them &lt;strong>automatically&lt;/strong> (unless you turn them off with &lt;code>parser.setBuildParseTree(false)&lt;/code>).&lt;/p>
&lt;p>Because we specify phrase structure with a set of rules, parse tree subtree roots &lt;strong>correspond to grammar rule names&lt;/strong>.&lt;/p>
&lt;p>ANTLR has a &lt;strong>ParseTreeWalker&lt;/strong> that knows how to walk these parse trees and trigger events in listener implementation objects that you can create. The ANTLR tool generates listener interfaces for you also, &lt;strong>unless you turn that off&lt;/strong> with a commandline option. You can also have it generate &lt;strong>visitors&lt;/strong>.&lt;/p>
&lt;p>For example from a Java.g4 grammar, ANTLR generates:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">interface&lt;/span> &lt;span class="nc">JavaListener&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">extends&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ParseTreeListener&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Token&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">enterClassDeclaration&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">JavaParser&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ClassDeclarationContext&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ctx&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">exitClassDeclaration&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">JavaParser&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ClassDeclarationContext&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ctx&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">enterMethodDeclaration&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">JavaParser&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">MethodDeclarationContext&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ctx&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>where there is an &lt;strong>enter and exit method&lt;/strong> for &lt;strong>each rule&lt;/strong> in the parser grammar.&lt;/p>
&lt;p>ANTLR also generates &lt;strong>a base listener with empty implementations&lt;/strong> of all listener interface methods, in this case called JavaBaseListener. You can build your listener by subclassing this base and overriding the methods of interest.&lt;/p>
&lt;p>Assuming you&amp;rsquo;ve created a listener object called &lt;code>MyListener&lt;/code>, here is how to call the Java parser and walk the parse tree:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">JavaLexer&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lexer&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JavaLexer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">input&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">CommonTokenStream&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tokens&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">CommonTokenStream&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">lexer&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">JavaParser&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parser&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JavaParser&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tokens&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">JavaParser&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">CompilationUnitContext&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tree&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parser&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">compilationUnit&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// parse a compilationUnit&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">MyListener&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">extractor&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">MyListener&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">parser&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">ParseTreeWalker&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">DEFAULT&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">walk&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">extractor&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tree&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// initiate walk of tree with listener in use of default walker&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Listeners and visitors are great because they &lt;strong>keep application-specific code out of grammars&lt;/strong>, making grammars easier to read and preventing them from getting entangled with a particular application.&lt;/p>
&lt;p>The biggest difference between the listener and visitor mechanisms is that &lt;strong>listener methods are called independently by an ANTLR-provided walker object&lt;/strong>, whereas &lt;strong>visitor methods must walk their children with explicit visit calls&lt;/strong>. Forgetting to invoke visitor methods on a node’s children, means those subtrees don’t get visited.&lt;/p>
&lt;h3 id="listening-during-the-parse">Listening during the parse
&lt;/h3>&lt;p>We can also use listeners to execute code &lt;strong>during the parse&lt;/strong> instead of waiting for a tree walker walks the resulting parse tree. Let&amp;rsquo;s say we have the following simple expression grammar.&lt;/p>
&lt;pre tabindex="0">&lt;code>grammar CalcNoLR;
s : expr EOF ;
expr: add ((MUL | DIV) add)* ;
add : atom ((ADD | SUB) atom)* ;
atom : INT ;
INT : [0-9]+;
MUL : &amp;#39;*&amp;#39;;
DIV : &amp;#39;/&amp;#39;;
ADD : &amp;#39;+&amp;#39;;
SUB : &amp;#39;-&amp;#39;;
WS : [ \t]+ -&amp;gt; channel(HIDDEN);
&lt;/code>&lt;/pre>&lt;p>We can create a listener that executes during the parse by implementing the listener interface as before:&lt;/p>
&lt;pre tabindex="0">&lt;code>class CountListener extends CalcNoLRBaseListener {
public int nums = 0;
public boolean execExitS = false;
@Override
public void exitS(CalcNoLRParser.SContext ctx) {
execExitS = true;
}
@Override
public void exitAtom(CalcNoLRParser.AtomContext ctx) {
nums++;
}
}
&lt;/code>&lt;/pre>&lt;p>And then passing it to &lt;code>addParseListener()&lt;/code>:&lt;/p>
&lt;pre tabindex="0">&lt;code>String input = &amp;#34;2 + 8 / 2&amp;#34;;
CalcNoLRLexer lexer = new CalcNoLRLexer(new ANTLRInputStream(input));
CalcNoLRParser parser = new CalcNoLRParser(new CommonTokenStream(lexer));
CountListener counter = new CountListener();
parser.addParseListener(counter);
// Check that the purses valid first
CalcNoLRParser.SContext context = parser.s();
String parseTreeS = context.toStringTree(parser);
assertEquals(&amp;#34;(s (expr (add (atom 2) + (atom 8)) / (add (atom 2))) &amp;lt;EOF&amp;gt;)&amp;#34;, parseTreeS);
assertEquals(3, counter.nums);
assertEquals(true, counter.execExitS);
&lt;/code>&lt;/pre>&lt;p>One should not do very complicated work during the parse because the parser is throwing exception to handle syntax errors. If you&amp;rsquo;re complicated code throws different kind of exception it will screw up the parsing and things will go nuts. If you want to catch and properly handle exceptions in your listener code during the parse, you should override this method from &lt;code>Parser&lt;/code>:&lt;/p>
&lt;pre tabindex="0">&lt;code>protected boolean listenerExceptionOccurred = false;
/**
* Notify any parse listeners of an exit rule event.
*
* @see #addParseListener
*/
@override
protected void triggerExitRuleEvent() {
if ( listenerExceptionOccurred ) return;
try {
// reverse order walk of listeners
for (int i = _parseListeners.size() - 1; i &amp;gt;= 0; i--) {
ParseTreeListener listener = _parseListeners.get(i);
_ctx.exitRule(listener);
listener.exitEveryRule(_ctx);
}
}
catch (Throwable e) {
// If an exception is thrown in the user&amp;#39;s listener code, we need to bail out
// completely out of the parser, without executing anymore user code. We
// must also stop the parse otherwise other listener actions will attempt to execute
// almost certainly with invalid results. So, record the fact an exception occurred
listenerExceptionOccurred = true;
throw e;
}
}
&lt;/code>&lt;/pre>&lt;p>Now, if you throw an exception inside one of the listener methods:&lt;/p>
&lt;pre tabindex="0">&lt;code>// Now throw an exception in the listener
class ErrorListener extends CalcNoLRBaseListener {
public boolean execExitS = false;
public boolean execExitAtom = false;
@Override
public void exitS(CalcNoLRParser.SContext ctx) {
execExitS = true;
}
@Override
public void exitAtom(CalcNoLRParser.AtomContext ctx) {
execExitAtom = true;
throw new NullPointerException(&amp;#34;bail out&amp;#34;);
}
}
&lt;/code>&lt;/pre>&lt;p>then the exception will properly cause the parser to bailout and the exception will not be thrown out:&lt;/p>
&lt;pre tabindex="0">&lt;code>java.lang.NullPointerException: bail out
at org.antlr.v4.test.runtime.java.api.TestParseListener$2ErrorListener.exitAtom(TestParseListener.java:102)
at org.antlr.v4.test.runtime.java.api.CalcNoLRParser$AtomContext.exitRule(CalcNoLRParser.java:311)
at org.antlr.v4.runtime.Parser.triggerExitRuleEvent(Parser.java:412)
at org.antlr.v4.runtime.Parser.exitRule(Parser.java:654)
at org.antlr.v4.test.runtime.java.api.CalcNoLRParser.atom(CalcNoLRParser.java:336)
at org.antlr.v4.test.runtime.java.api.CalcNoLRParser.add(CalcNoLRParser.java:261)
at org.antlr.v4.test.runtime.java.api.CalcNoLRParser.expr(CalcNoLRParser.java:181)
at org.antlr.v4.test.runtime.java.api.CalcNoLRParser.s(CalcNoLRParser.java:123)
&lt;/code>&lt;/pre>&lt;h2 id="semantic-predicates">Semantic Predicates
&lt;/h2>&lt;p>Semantic predicates, &lt;code>{...}?&lt;/code>, are &lt;strong>boolean expressions&lt;/strong> written in the target language that indicate the validity of continuing the parse along the path &amp;ldquo;guarded&amp;rdquo; by the predicate. &lt;strong>Predicates can appear anywhere within a parser rule just like actions can&lt;/strong>, but only those appearing on the left edge of alternatives can affect prediction (choosing between alternatives). This section provides all of the fine print regarding the use of semantic predicates in parser and lexer rules. Let&amp;rsquo;s start out by digging deeper into how the parser incorporates predicates into parsing decisions.&lt;/p>
&lt;h3 id="making-predicated-parsing-decisions">Making Predicated Parsing Decisions
&lt;/h3>&lt;p>ANTLR&amp;rsquo;s general decision-making strategy is to find all viable alternatives and then ignore the alternatives guarded with predicates that currently evaluate to false. (A viable alternative is one that matches the current input.) If more than one viable alternative remains, the parser chooses the alternative specified first in the decision.&lt;/p>
&lt;p>Consider a variant of C++ where array references also use parentheses instead of square brackets. If we only predicate one of the alternatives, we still have an ambiguous decision in expr:&lt;/p>
&lt;pre tabindex="0">&lt;code>expr: ID &amp;#39;(&amp;#39; expr &amp;#39;)&amp;#39; // array reference (ANTLR picks this one)
| {istype()}? ID &amp;#39;(&amp;#39; expr &amp;#39;)&amp;#39; // ctor-style typecast
| ID &amp;#39;(&amp;#39; expr &amp;#39;)&amp;#39; // function call
;
&lt;/code>&lt;/pre>&lt;p>In this case, all three alternatives are viable for input &lt;code>x(i)&lt;/code>. When &lt;code>x&lt;/code> is not a type name, the predicate evaluates to false, leaving only the first and third alternatives as possible matches for expr. ANTLR automatically chooses the first alternative matching the array reference to resolve the ambiguity. Leaving ANTLR with more than one viable alternative because of too few predicates is probably not a good idea. It&amp;rsquo;s best to cover n viable alternatives with at least n-1 predicates. In other words, don&amp;rsquo;t build rules like expr with too few predicates.&lt;/p>
&lt;p>Sometimes, the parser finds multiple visible predicates associated with a single choice. No worries. ANTLR just combines the predicates with appropriate logical operators to conjure up a single meta-predicate on-the-fly.&lt;/p>
&lt;p>For example, the decision in rule &lt;code>stat&lt;/code> joins the predicates from both alternatives of expr with the &lt;code>||&lt;/code> operator to guard the second stat alternative:&lt;/p>
&lt;pre tabindex="0">&lt;code>stat: decl | expr ;
decl: ID ID ;
expr: {istype()}? ID &amp;#39;(&amp;#39; expr &amp;#39;)&amp;#39; // ctor-style typecast
| {isfunc()}? ID &amp;#39;(&amp;#39; expr &amp;#39;)&amp;#39; // function call
;
&lt;/code>&lt;/pre>&lt;p>The parser will only predict an expr from stat when &lt;code>istype()||isfunc()&lt;/code> evaluates to true. This makes sense because the parser should only choose to match an expression if the upcoming &lt;code>ID&lt;/code> is a type name or function name. It wouldn&amp;rsquo;t make sense to just test one of the predicates in this case. Note that, when the parser gets to &lt;code>expr&lt;/code> itself, the parsing decision tests the predicates individually, one for each alternative.&lt;/p>
&lt;p>If multiple predicates occur in a sequence, the parser joins them with the &lt;code>&amp;amp;&amp;amp;&lt;/code> operator. For example, consider changing &lt;code>stat&lt;/code> to include a predicate before the call &lt;code>toexpr&lt;/code>:&lt;/p>
&lt;pre tabindex="0">&lt;code>stat: decl | {java5}? expr ;
&lt;/code>&lt;/pre>&lt;p>Now, the parser would only predict the second alternative if &lt;code>java5&amp;amp;&amp;amp;(istype()||isfunc())&lt;/code> evaluated to true.&lt;/p>
&lt;p>Turning to the code inside the predicates themselves now, keep in mind the following guidelines.&lt;/p>
&lt;p>Even when the parser isn&amp;rsquo;t making decisions, predicates can deactivate alternatives, causing rules to fail. This happens when a rule only has a single alternative. There is no choice to make, but ANTLR evaluates the predicate as part of the normal parsing process, just like it does for actions. That means that the following rule always fails to match.&lt;/p>
&lt;pre tabindex="0">&lt;code>prog: {false}? &amp;#39;return&amp;#39; INT ; // throws FailedPredicateException
&lt;/code>&lt;/pre>&lt;p>ANTLR converts &lt;code>{false}?&lt;/code> in the grammar to a conditional in the generated parser:&lt;/p>
&lt;pre tabindex="0">&lt;code>if ( !false ) throw new FailedPredicateException(...);
&lt;/code>&lt;/pre>&lt;p>So far, all of the predicates we&amp;rsquo;ve seen have been visible and available to the prediction process, but that&amp;rsquo;s not always the case.&lt;/p>
&lt;h3 id="finding-visible-predicates">Finding Visible Predicates
&lt;/h3>&lt;p>The parser will not evaluate predicates during prediction that occur after an action or token reference. Let&amp;rsquo;s think about the relationship between actions and predicates first.&lt;/p>
&lt;p>ANTLR has no idea what&amp;rsquo;s inside the raw code of an action and so it must assume any predicate could depend on side effects of that action. Imagine an action that computed value &lt;code>x&lt;/code> and a predicate that tested &lt;code>x&lt;/code>. Evaluating that predicate before the action executed to create &lt;code>x&lt;/code> would violate the implied order of operations within the grammar.&lt;/p>
&lt;p>More importantly, the parser can&amp;rsquo;t execute actions until it has decided which alternative to match. That&amp;rsquo;s because actions have side effects and we can&amp;rsquo;t undo things like print statements. For example, in the following rule, the parser can&amp;rsquo;t execute the action in front of the &lt;code>{java5}?&lt;/code> predicate before committing to that alternative.&lt;/p>
&lt;pre tabindex="0">&lt;code>@members {boolean allowgoto=false;}
stat: {System.out.println(&amp;#34;goto&amp;#34;); allowgoto=true;} {java5}? &amp;#39;goto&amp;#39; ID &amp;#39;;&amp;#39;
| ...
;
&lt;/code>&lt;/pre>&lt;p>If we can&amp;rsquo;t execute the action during prediction, we shouldn&amp;rsquo;t evaluate the &lt;code>{java5}?&lt;/code> predicate because it depends on that action.&lt;/p>
&lt;p>The prediction process also can&amp;rsquo;t see through token references. Token references have the side effect of advancing the input one symbol. A predicate that tested the current input symbol would find itself out of sync if the parser shifted it over the token reference. For example, in the following grammar, the predicates expect &lt;code>getCurrentToken&lt;/code> to return an &lt;code>ID&lt;/code> token.&lt;/p>
&lt;pre tabindex="0">&lt;code>stat: &amp;#39;{&amp;#39; decl &amp;#39;}&amp;#39;
| &amp;#39;{&amp;#39; stat &amp;#39;}&amp;#39;
;
decl: {istype(getCurrentToken().getText())}? ID ID &amp;#39;;&amp;#39; ;
expr: {isvar(getCurrentToken().getText())}? ID ;
&lt;/code>&lt;/pre>&lt;p>The decision in stat can&amp;rsquo;t test those predicates because, at the start of stat, the current token is a left curly. To preserve the semantics, ANTLR won&amp;rsquo;t test the predicates in that decision.&lt;/p>
&lt;p>Visible predicates are those that prediction encounters before encountering an action or token. The prediction process ignores nonvisible predicates, treating them as if they don&amp;rsquo;t exist.&lt;/p>
&lt;p>In rare cases, the parser won&amp;rsquo;t be able to use a predicate, even if it&amp;rsquo;s visible to a particular decision. That brings us to our next fine print topic.&lt;/p>
&lt;h3 id="using-context-dependent-predicates">Using Context-Dependent Predicates
&lt;/h3>&lt;p>A predicate that depends on a parameter or local variable of the surrounding rule, is considered a context-dependent predicate. Clearly, we can only evaluate such predicates within the rules in which they&amp;rsquo;re defined. For example, it makes no sense for the decision in prog below to test context-dependent predicate &lt;code>{$i&amp;lt;=5}?&lt;/code>. That &lt;code>$i&lt;/code> local variable is not even defined in &lt;code>prog&lt;/code>.&lt;/p>
&lt;pre tabindex="0">&lt;code>prog: vec5
| ...
;
vec5
locals [int i=1]
: ( {$i&amp;lt;=5}? INT {$i++;} )* // match 5 INTs
;
&lt;/code>&lt;/pre>&lt;p>ANTLR ignores context-dependent predicates that it can&amp;rsquo;t evaluate in the proper context. Normally the proper context is simply the rule defining the predicate, but sometimes the parser can&amp;rsquo;t even evaluate a context-dependent predicate from within the same rule! Detecting these cases is done on-the-fly at runtime during adaptive LL(*) prediction.&lt;/p>
&lt;p>For example, prediction for the optional branch of the else subrule in stat below &amp;ldquo;falls off&amp;rdquo; the end of stat and continues looking for symbols in the invoking prog rule.&lt;/p>
&lt;pre tabindex="0">&lt;code>prog: stat+ ; // stat can follow stat
stat
locals [int i=0]
: {$i==0}? &amp;#39;if&amp;#39; expr &amp;#39;then&amp;#39; stat {$i=5;} (&amp;#39;else&amp;#39; stat)?
| &amp;#39;break&amp;#39; &amp;#39;;&amp;#39;
;
&lt;/code>&lt;/pre>&lt;p>The prediction process is trying to figure out what can follow an if statement other than an else clause. Since the input can have multiple stats in a row, the prediction for the optional branch of the else subrule reenters stat. This time, of course, it gets a new copy of &lt;code>$i&lt;/code> with a value of 0, not 5. ANTLR ignores context-dependent predicate &lt;code>{$i==0}?&lt;/code> because it knows that the parser isn&amp;rsquo;t in the original stat call. The predicate would test a different version of &lt;code>$i&lt;/code> so the parser can&amp;rsquo;t evaluate it.&lt;/p>
&lt;p>The fine print for predicates in the lexer more or less follow these same guidelines, except of course lexer rules can&amp;rsquo;t have parameters and local variables. Let&amp;rsquo;s look at all of the lexer-specific guidelines in the next section.&lt;/p>
&lt;h3 id="predicates-in-lexer-rules">Predicates in Lexer Rules
&lt;/h3>&lt;p>In parser rules, predicates must appear on the left edge of alternatives to aid in alternative prediction. Lexers, on the other hand, prefer predicates on the right edge of lexer rules because they choose rules after seeing a token&amp;rsquo;s entire text. Predicates in lexer rules can technically be anywhere within the rule. Some positions might be more or less efficient than others; ANTLR makes no guarantees about the optimal spot. A predicate in a lexer rule might be executed multiple times even during a single token match. You can embed multiple predicates per lexer rule and they are evaluated as the lexer reaches them during matching.&lt;/p>
&lt;p>Loosely speaking, the lexer&amp;rsquo;s goal is to choose the rule that matches the most input characters. At each character, the lexer decides which rules are still viable. Eventually, only a single rule will be still viable. At that point, the lexer creates a token object according the rule&amp;rsquo;s token type and matched text.&lt;/p>
&lt;p>Sometimes the lexer is faced with more than a single viable matching rule. For example, input enum would match an &lt;code>ENUM&lt;/code> rule and an &lt;code>ID&lt;/code> rule. If the next character after enum is a space, neither rule can continue. The lexer resolves the ambiguity by choosing the viable rule specified first in the grammar. That&amp;rsquo;s why we have to place keyword rules before an identifier rule like this:&lt;/p>
&lt;pre tabindex="0">&lt;code>ENUM : &amp;#39;enum&amp;#39; ;
ID : [a-z]+ ;
&lt;/code>&lt;/pre>&lt;p>If, on the other hand, the next character after input &lt;code>enum&lt;/code> is a letter, then only &lt;code>ID&lt;/code> is viable.&lt;/p>
&lt;p>Predicates come into play by pruning the set of viable lexer rules. When the lexer encounters a false predicate, it deactivates that rule just like parsers deactivate alternatives with false predicates.&lt;/p>
&lt;p>Like parser predicates, lexer predicates can&amp;rsquo;t depend on side effects from lexer actions. That said, the predicate can depend on a side effect of an action that occured during the recognition of the previous token. That&amp;rsquo;s because actions can only execute after the lexer positively identifies the rule to match. Since predicates are part of the rule selection process, they can&amp;rsquo;t rely on action side effects created by actions in currently-prospective rules. Lexer actions must appear after predicates in lexer rules. As an example, here&amp;rsquo;s another way to match enum as a keyword in the lexer:&lt;/p>
&lt;pre tabindex="0">&lt;code>ENUM: [a-z]+ {getText().equals(&amp;#34;enum&amp;#34;)}?
{System.out.println(&amp;#34;enum!&amp;#34;);}
;
ID : [a-z]+ {System.out.println(&amp;#34;ID &amp;#34;+getText());} ;
&lt;/code>&lt;/pre>&lt;p>The print action in &lt;code>ENUM&lt;/code> appears last and executes only if the current input matches &lt;code>[a-z]+&lt;/code> and the predicate is true. Let&amp;rsquo;s build and test &lt;code>Enum3&lt;/code> to see if it distinguishes between enum and an identifier:&lt;/p>
&lt;pre tabindex="0">&lt;code>$ antlr4 Enum3.g4
$ javac Enum3.java
$ grun Enum3 tokens
=&amp;gt; enum abc
=&amp;gt; EOF
&amp;lt;= enum!
ID abc
&lt;/code>&lt;/pre>&lt;p>That works great, but it&amp;rsquo;s really just for instructional purposes. It&amp;rsquo;s easier to understand and more efficient to match enum keywords with a simple rule like this:&lt;/p>
&lt;pre tabindex="0">&lt;code>ENUM : &amp;#39;enum&amp;#39; ;
&lt;/code>&lt;/pre>&lt;p>Here&amp;rsquo;s another example of a predicate. It&amp;rsquo;s important to note that the predicate is evaluated before the action because actions are only executed if the lexer rule matches. The actions are not executed in line; they are collected and executed en mass later.&lt;/p>
&lt;pre tabindex="0">&lt;code>INDENT : [ \t]+ {System.out.println(&amp;#34;INDENT&amp;#34;)&amp;gt;} {this.getCharPositionInLine()==0}? ;
&lt;/code>&lt;/pre>&lt;p>For more information on how actions and predicates operate in the lexer, see &lt;a class="link" href="https://github.com/antlr/antlr4/issues/3611" target="_blank" rel="noopener"
>Lexer actions and semantic predicates are executed out of order&lt;/a> and &lt;a class="link" href="https://github.com/antlr/antlr4/issues/3606" target="_blank" rel="noopener"
>Lexer.getCharIndex() return value not behaving as expected&lt;/a>. The lexer rule that will not work as expected is:&lt;/p>
&lt;pre tabindex="0">&lt;code>Stuff : ( &amp;#39;a&amp;#39;+ {count++;} | &amp;#39;b&amp;#39;) &amp;#39;c&amp;#39; &amp;#39;d&amp;#39; {count == 3}? ;
&lt;/code>&lt;/pre>&lt;p>The &lt;code>count++&lt;/code> code we&amp;rsquo;ll not execute until after &lt;code>Stuff&lt;/code> has been recognized (assuming count!=3).&lt;/p>
&lt;h2 id="华为云">华为云
&lt;/h2>&lt;p>一般如果语法非常复杂，会基于Lexer和Parser写到两个不同的文件中（例如Java，可参考：https://github.com/antlr/grammars-v4/tree/master/java/java8），如果语法比较简单，可以只写到一个文件中（例如Lua，可参考：https://github.com/antlr/grammars-v4/blob/master/lua/Lua.g4）。&lt;/p>
&lt;p>Antlr4&lt;strong>整体结构&lt;/strong>如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/** Optional javadoc style comment */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">grammar&lt;/span> &lt;span class="nx">Name&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">options&lt;/span> &lt;span class="p">{...}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">...&lt;/span> &lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">tokens&lt;/span> &lt;span class="p">{...}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">channels&lt;/span> &lt;span class="p">{...}&lt;/span> &lt;span class="c1">// lexer only
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">@&lt;/span>&lt;span class="nx">actionName&lt;/span> &lt;span class="p">{...}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">rule1&lt;/span> &lt;span class="c1">// parser and lexer rules, possibly intermingled
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">ruleN&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>替代标签&lt;/strong>&lt;/p>
&lt;p>通过在语句后面，添加 #替代标签，可以将语句转换为这些替代标签，从而加以区分&lt;/p>
&lt;p>&lt;strong>结合性&lt;/strong>&lt;/p>
&lt;p>默认情况下，ANTLR从左到右结合运算符，然而某些像指数群这样的运算符则是从右到左。可以使用选项assoc手动指定运算符记号上的相关性。&lt;/p>
&lt;p>实际上，Antlr4 已经对一些常用的操作符的优先级进行了处理，例如加减乘除等，这些就不需要再特殊处理&lt;/p>
&lt;p>&lt;strong>通道&lt;/strong>&lt;/p>
&lt;p>很多信息，例如注释、空格等，是结果信息生成不需要处理的，但是我们又不适合直接丢弃，安全地忽略掉注释和空格的方法是把这些发送给语法分析器的记号放到一个“隐藏通道”中，语法分析器仅需要调协到单个通道即可。我们可以把任何我们想要的东西传递到其它通道中。&lt;/p></description></item><item><title>【Qt】Basics</title><link>https://dyhes.github.io/p/qtbasics/</link><pubDate>Mon, 15 Aug 2022 00:00:00 +0000</pubDate><guid>https://dyhes.github.io/p/qtbasics/</guid><description>&lt;h2 id="qapplication">QApplication
&lt;/h2>&lt;p>The &lt;strong>QCoreApplication&lt;/strong> class and &lt;strong>QApplication&lt;/strong> class and provides an event loop for console Qt applications. Those class are used by applications to provide event loop. For non-GUI application that uses Qt, there should be exactly one &lt;strong>QCoreApplication&lt;/strong> object. For GUI applications, we will use &lt;strong>QApplication&lt;/strong>.&lt;/p>
&lt;p>When calling &lt;strong>a.exec()&lt;/strong> the event loop is launched.&lt;/p>
&lt;p>When we compile the project, behind the scene, our Qt app is compiled in the following steps:&lt;/p>
&lt;ol>
&lt;li>&lt;strong>qmake&lt;/strong> parses the &lt;strong>.pro&lt;/strong> file, and generates &lt;strong>makefile&lt;/strong>.&lt;/li>
&lt;li>The program is build using &lt;strong>make&lt;/strong> (&lt;strong>jom&lt;/strong> on windows).&lt;/li>
&lt;/ol>
&lt;h2 id="signals-and-slots">Signals and Slots
&lt;/h2>&lt;p>Signals and slots are used for communication between objects. The signals and slots mechanism is a central feature of Qt and probably the part that differs most from the features provided by other frameworks.&lt;/p>
&lt;p>A signal is emitted when a particular event occurs. Qt&amp;rsquo;s widgets have many predefined signals, but we can always subclass widgets to add our own signals to them. A slot is a function that is called in response to a particular signal. Qt&amp;rsquo;s widgets have many pre-defined slots, but it is common practice to subclass widgets and add your own slots so that you can handle the signals that you are interested in.&lt;/p>
&lt;p>All classes that inherit from QObject or one of its subclasses (e.g., QWidget) can contain signals and slots.&lt;/p>
&lt;p>Just as an object does not know if anything receives its signals, a slot does not know if it has any signals connected to it. This ensures that truly independent components can be created with Qt. You can connect as many signals as you want to a single slot, and a signal can be connected to as many slots as you need.&lt;/p>
&lt;h2 id="q_object-macro">&lt;strong>Q_OBJECT Macro&lt;/strong>
&lt;/h2>&lt;p>The Q_OBJECT macro must appear in the private section of a class definition that declares its own signals and slots or that uses other services provided by Qt&amp;rsquo;s meta-object system.&lt;/p>
&lt;p>Note that when we want to make connection between signal and slot, we actually do it with &lt;strong>Object&lt;/strong> scope:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">QObject&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">connect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sender&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">signal&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">receiver&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">slot&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="qstring">QString
&lt;/h2>&lt;p>We will use all three methods to find some substrings of a given string.&lt;/p>
&lt;pre tabindex="0">&lt;code>out &amp;lt;&amp;lt; str.right(5) &amp;lt;&amp;lt; endl;
&lt;/code>&lt;/pre>&lt;p>With the &lt;code>right&lt;/code> method, we get five rightmost characters of the &lt;code>str&lt;/code> string. The &amp;rsquo;train&amp;rsquo; is printed.&lt;/p>
&lt;pre tabindex="0">&lt;code>out &amp;lt;&amp;lt; str.left(9) &amp;lt;&amp;lt; endl;
&lt;/code>&lt;/pre>&lt;p>With the &lt;code>left&lt;/code> method, we get nine leftmost characters of the &lt;code>str&lt;/code> string. The &amp;lsquo;The night&amp;rsquo; is printed.&lt;/p>
&lt;pre tabindex="0">&lt;code>out &amp;lt;&amp;lt; str.mid(4, 5) &amp;lt;&amp;lt; endl;
&lt;/code>&lt;/pre>&lt;p>With the &lt;code>mid&lt;/code> method, we get five characters starting from the 4th position. The &amp;rsquo;night&amp;rsquo; is printed.&lt;/p>
&lt;pre tabindex="0">&lt;code>QString str2(&amp;#34;The big apple&amp;#34;);
QStringRef sub(&amp;amp;str2, 0, 7);
&lt;/code>&lt;/pre>&lt;p>The &lt;code>QStringRef&lt;/code> class is a read-only version of a &lt;code>QString&lt;/code>. Here we create a &lt;code>QStringRef&lt;/code> of a portion of the &lt;code>str2&lt;/code> string. The second parameter is the position and the third is the length of the substring.&lt;/p>
&lt;p>The Q_OBJECT macro must be included in classes that declare their own signals and slots.&lt;/p>
&lt;ol>
&lt;li>QMainWindow 是主窗口类，主窗口具有主菜单栏、工具栏和状态栏，类似于一般的应用程序的主窗口；&lt;/li>
&lt;li>QWidget 是所有具有可视界面类的基类，选择 QWidget 创建的界面对各种界面组件都可以 支持；&lt;/li>
&lt;li>QDialog 是对话框类，可建立一个基于对话框的界面；&lt;/li>
&lt;/ol></description></item></channel></rss>