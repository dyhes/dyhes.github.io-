<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Application Fundamentals An Android package, which is an archive file with an .apk suffix, contains the contents of an Android app that are required at runtime and it is the file that Android-powered devices use to install the app.\nAn Android App Bundle, which is an archive file with an .aab suffix, contains the contents of an Android app project including some additional metadata that is not required at runtime. An AAB is a publishing format and is not installable on Android devices, it defers APK generation and signing to a later stage. When distributing your app through Google Play for example, Google Play&rsquo;s servers generate optimized APKs that contain only the resources and code that are required by a particular device that is requesting installation of the app.\n"><title>【Android】Jetpack Compose</title>
<link rel=canonical href=https://dyhes.github.io/p/androidjetpack-compose/><link rel=stylesheet href=/scss/style.min.6aa4d43a5cae1c51ef34b3f851ae7421f4b2f2d13827e2d975acbeb4f13c8710.css><meta property='og:title' content="【Android】Jetpack Compose"><meta property='og:description' content="Application Fundamentals An Android package, which is an archive file with an .apk suffix, contains the contents of an Android app that are required at runtime and it is the file that Android-powered devices use to install the app.\nAn Android App Bundle, which is an archive file with an .aab suffix, contains the contents of an Android app project including some additional metadata that is not required at runtime. An AAB is a publishing format and is not installable on Android devices, it defers APK generation and signing to a later stage. When distributing your app through Google Play for example, Google Play&rsquo;s servers generate optimized APKs that contain only the resources and code that are required by a particular device that is requesting installation of the app.\n"><meta property='og:url' content='https://dyhes.github.io/p/androidjetpack-compose/'><meta property='og:site_name' content='飞鸿踏雪泥'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Android'><meta property='article:published_time' content='2021-11-18T00:00:00+00:00'><meta property='article:modified_time' content='2021-11-18T00:00:00+00:00'><meta name=twitter:title content="【Android】Jetpack Compose"><meta name=twitter:description content="Application Fundamentals An Android package, which is an archive file with an .apk suffix, contains the contents of an Android app that are required at runtime and it is the file that Android-powered devices use to install the app.\nAn Android App Bundle, which is an archive file with an .aab suffix, contains the contents of an Android app project including some additional metadata that is not required at runtime. An AAB is a publishing format and is not installable on Android devices, it defers APK generation and signing to a later stage. When distributing your app through Google Play for example, Google Play&rsquo;s servers generate optimized APKs that contain only the resources and code that are required by a particular device that is requesting installation of the app.\n"><link rel="shortcut icon" href=/github.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu17834253352308399148.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>飞鸿踏雪泥</a></h1><h2 class=site-description>没有记录，就没有发生</h2></div></header><ol class=menu-social><li><a href=https://github.com/dyhes target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=mailto:dyheslin@gmail.com target=_blank title=Gmail rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-gmail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16 20h3a1 1 0 001-1V5a1 1 0 00-1-1h-3v16z"/><path d="M5 20h3V4H5A1 1 0 004 5v14a1 1 0 001 1z"/><path d="M16 4l-4 4-4-4"/><path d="M4 6.5l8 7.5 8-7.5"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/categories/><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
<span>Categories</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#application-fundamentals>Application Fundamentals</a><ol><li><a href=#app-components>App components</a></li></ol></li><li><a href=#app-architecture>App Architecture</a><ol><li><a href=#principles>Principles</a><ol><li><a href=#separation-of-concerns>Separation of concerns</a></li><li><a href=#drive-ui-from-data-models>Drive UI from data models</a></li><li><a href=#single-source-of-truth>Single source of truth</a></li></ol></li><li><a href=#recommended-app-architecture>Recommended app architecture</a><ol><li><a href=#ui-layer>UI layer</a></li><li><a href=#data-layer>Data layer</a></li><li><a href=#domain-layer>Domain layer</a></li></ol></li><li><a href=#general-best-practices>General best practices</a></li></ol></li><li><a href=#state>State</a><ol><li><a href=#state-hoisting>State hoisting</a><ol><li><a href=#ui-state>UI state</a></li><li><a href=#logic>Logic</a></li><li><a href=#unidirectional-data-flow>unidirectional data flow</a></li></ol></li><li><a href=#state-storage>state storage</a></li></ol></li><li><a href=#lifecycle>Lifecycle</a><ol><li><a href=#stable>Stable</a></li></ol></li><li><a href=#modifiers>Modifiers</a></li><li><a href=#side-effects>Side-effects</a><ol><li><a href=#launchedeffect-run-suspend-functions-in-the-scope-of-a-composable>LaunchedEffect: run suspend functions in the scope of a composable</a></li><li><a href=#remembercoroutinescope-obtain-a-composition-aware-scope-to-launch-a-coroutine-outside-a-composable>rememberCoroutineScope: obtain a composition-aware scope to launch a coroutine outside a composable</a></li><li><a href=#rememberupdatedstate-reference-a-value-in-an-effect-that-shouldnt-restart-if-the-value-changes>rememberUpdatedState: reference a value in an effect that shouldn&rsquo;t restart if the value changes</a></li><li><a href=#disposableeffect-effects-that-require-cleanup>DisposableEffect: effects that require cleanup</a></li><li><a href=#sideeffect-publish-compose-state-to-non-compose-code>SideEffect: publish Compose state to non-compose code</a></li><li><a href=#producestate-convert-non-compose-state-into-compose-state>produceState: convert non-Compose state into Compose state</a></li><li><a href=#derivedstateof-convert-one-or-multiple-state-objects-into-another-state>derivedStateOf: convert one or multiple state objects into another state</a></li><li><a href=#snapshotflow-convert-composes-state-into-flows>snapshotFlow: convert Compose&rsquo;s State into Flows</a></li><li><a href=#restarting-effects>Restarting effects</a></li></ol></li><li><a href=#phases>Phases</a></li><li><a href=#architectural-layering>Architectural Layering</a></li><li><a href=#semantics>Semantics</a></li><li><a href=#compositionlocal>CompositionLocal</a></li><li><a href=#navigation>Navigation</a></li><li><a href=#ui-design>UI Design</a><ol><li><a href=#layout>Layout</a><ol><li><a href=#content-slots>Content slots</a></li></ol></li></ol></li><li><a href=#testing-apis>Testing APIs</a><ol><li><a href=#finders>Finders</a></li><li><a href=#assertions>Assertions</a></li><li><a href=#actions>Actions</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/nutrition/ style=background-color:#93b5cf;color:>积雪粮</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/androidjetpack-compose/>【Android】Jetpack Compose</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Nov 18, 2021</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>27 minute read</time></div></footer></div></header><section class=article-content><h2 id=application-fundamentals>Application Fundamentals</h2><p>An <em>Android package</em>, which is an archive file with an <code>.apk</code> suffix, contains the contents of an Android app that are required at runtime and it is the file that Android-powered devices use to install the app.</p><p>An Android App Bundle, which is an archive file with an <code>.aab</code> suffix, contains the contents of an Android app project including some additional metadata that is not required at runtime. An AAB is a publishing format and is not installable on Android devices, it defers APK generation and signing to a later stage. When distributing your app through Google Play for example, Google Play&rsquo;s servers generate optimized APKs that contain only the resources and code that are required by a particular device that is requesting installation of the app.</p><p>Each Android app lives in its own security sandbox, protected by the following Android security features:</p><ul><li>The Android operating system is a multi-user Linux system in which each app is a different user.</li><li>By default, the system assigns each app a unique Linux user ID (the ID is used only by the system and is unknown to the app). The system sets permissions for all the files in an app so that only the user ID assigned to that app can access them.</li><li>Each process has its own virtual machine (VM), so an app&rsquo;s code runs in isolation from other apps.</li><li>By default, every app runs in its own Linux process. The Android system starts the process when any of the app&rsquo;s components need to be executed, and then shuts down the process when it&rsquo;s no longer needed or when the system must recover memory for other apps.</li></ul><h3 id=app-components>App components</h3><p>App components are the essential building blocks of an Android app. Each component is an entry point through which the system or a user can enter your app. Some components depend on others.</p><p>There are four different types of app components:</p><ul><li>Activities</li><li>Services</li><li>Broadcast receivers</li><li>Content providers</li></ul><p>Each type serves a distinct purpose and has a distinct lifecycle that defines how the component is created and destroyed.</p><h2 id=app-architecture>App Architecture</h2><p>An app architecture defines the boundaries between parts of the app and the responsibilities each part should have. In order to meet the needs mentioned above, you should design your app architecture to follow a few specific principles.</p><h3 id=principles>Principles</h3><h4 id=separation-of-concerns>Separation of concerns</h4><p>The most important principle to follow is <a class=link href=https://en.wikipedia.org/wiki/Separation_of_concerns target=_blank rel=noopener>separation of concerns</a>.</p><h4 id=drive-ui-from-data-models>Drive UI from data models</h4><p>Another important principle is that you should drive your UI from data models, preferably persistent models.</p><h4 id=single-source-of-truth>Single source of truth</h4><p>When a new data type is defined in your app, you should assign a Single Source of Truth (SSOT) to it.</p><p>The <a class=link href="https://developer.android.com/topic/architecture?hl=en#single-source-of-truth" target=_blank rel=noopener>single source of truth principle</a> is often used in our guides with the Unidirectional Data Flow (UDF) pattern. In UDF, <strong>state</strong> flows in only one direction. The <strong>events</strong> that modify the data flow in the opposite direction.</p><h3 id=recommended-app-architecture>Recommended app architecture</h3><p>Considering the common architectural principles mentioned in the previous section, each application should have at least two layers:</p><ul><li>The <em>UI layer</em> that displays application data on the screen.</li><li>The <em>data layer</em> that contains the business logic of your app and exposes application data.</li></ul><p>You can add an additional layer called the <em>domain layer</em> to simplify and reuse the interactions between the UI and data layers.</p><p><img src=https://developer.android.com/static/topic/libraries/architecture/images/mad-arch-overview.png loading=lazy alt="In a typical app architecture, the UI layer gets the application data     from the data layer or from the optional domain layer, which sits between     the UI layer and the data layer."></p><h4 id=ui-layer>UI layer</h4><p>The role of the UI layer (or <em>presentation layer</em>) is to display the application data on the screen. Whenever the data changes, either due to user interaction (such as pressing a button) or external input (such as a network response), the UI should update to reflect the changes.</p><p>The UI layer is made up of two things:</p><ul><li>UI elements that render the data on the screen. You build these elements using Views or <a class=link href=https://developer.android.com/jetpack/compose target=_blank rel=noopener>Jetpack Compose</a> functions.</li><li>State holders (such as <a class=link href=https://developer.android.com/topic/libraries/architecture/viewmodel target=_blank rel=noopener>ViewModel</a> classes) that hold data, expose it to the UI, and handle logic.</li></ul><p><img src=https://developer.android.com/static/topic/libraries/architecture/images/mad-arch-overview-ui.png loading=lazy alt="In a typical architecture, the UI layers UI elements depend on state     holders, which in turn depend on classes from either the data layer or the     optional domain layer."></p><h4 id=data-layer>Data layer</h4><p>The data layer of an app contains the <em>business logic</em>. The business logic is what gives value to your app—it&rsquo;s made of rules that determine how your app creates, stores, and changes data.</p><p>The data layer is made of <em>repositories</em> that each can contain zero to many <em>data sources</em>. You should create a repository class for each different type of data you handle in your app.</p><p><img src=https://developer.android.com/static/topic/libraries/architecture/images/mad-arch-overview-data.png loading=lazy alt="In a typical architecture, the data layers repositories provide data     to the rest of the app and depend on the data sources."></p><p>Repository classes are responsible for the following tasks:</p><ul><li>Exposing data to the rest of the app.</li><li>Centralizing changes to the data.</li><li>Resolving conflicts between multiple data sources.</li><li>Abstracting sources of data from the rest of the app.</li><li>Containing business logic.</li></ul><p>Each data source class should have the responsibility of working with only one source of data, which can be a file, a network source, or a local database. Data source classes are the bridge between the application and the system for data operations.</p><h4 id=domain-layer>Domain layer</h4><p>The domain layer is an optional layer that sits between the UI and data layers.</p><p>The domain layer is responsible for encapsulating complex business logic, or simple business logic that is reused by multiple ViewModels. This layer is optional because not all apps will have these requirements. You should use it only when needed—for example, to handle complexity or favor reusability.</p><p>Classes in this layer are commonly called <em>use cases</em> or <em>interactors</em>. Each use case should have responsibility over a <em>single</em> functionality. For example, your app could have a <code>GetTimeZoneUseCase</code> class if multiple ViewModels rely on time zones to display the proper message on the screen.</p><h3 id=general-best-practices>General best practices</h3><ul><li><p><strong>Don&rsquo;t store data in app components.</strong></p><p>Avoid designating your app&rsquo;s entry points—such as activities, services, and broadcast receivers—as sources of data.</p></li><li><p><strong>Reduce dependencies on Android classes.</strong></p><p>Your app components should be the only classes that rely on Android framework SDK APIs such as <a class=link href=https://developer.android.com/reference/android/content/Context target=_blank rel=noopener><code>Context</code></a>, or <a class=link href=https://developer.android.com/guide/topics/ui/notifiers/toasts target=_blank rel=noopener><code>Toast</code></a>.</p></li><li><p><strong>Create well-defined boundaries of responsibility between various modules in your app.</strong></p><p>For example, don&rsquo;t spread the code that loads data from the network across multiple classes or packages in your code base. Similarly, don&rsquo;t define multiple unrelated responsibilities—such as data caching and data binding—in the same class.</p></li><li><p><strong>Expose as little as possible from each module.</strong></p></li><li><p><strong>Focus on the unique core of your app so it stands out from other apps.</strong></p><p>Don&rsquo;t reinvent the wheel by writing the same boilerplate code again and again.</p></li><li><p><strong>Consider how to make each part of your app testable in isolation.</strong></p></li><li><p><strong>Types are responsible for their concurrency policy.</strong></p><p>If a type is performing long-running blocking work, it should be responsible for moving that computation to the right thread.</p></li><li><p><strong>Persist as much relevant and fresh data as possible.</strong></p><p>That way, users can enjoy your app&rsquo;s functionality even when their device is in offline mode.</p></li></ul><h2 id=state>State</h2><p>There are three ways to declare a <code>MutableState</code> object in a composable:</p><ul><li><code>val value = remember { mutableStateOf(default) }</code></li><li><code>var value by remember { mutableStateOf(default) }</code></li><li><code>val (value, setValue) = remember { mutableStateOf(default) }</code></li></ul><p>These declarations are equivalent, and are provided as syntax sugar for different uses of state</p><blockquote><p><strong>Caution:</strong> Using mutable objects such as <code>ArrayList&lt;T></code> or <code>mutableListOf()</code> as state in Compose causes your users to see incorrect or stale data in your app. Mutable objects that are not observable, such as ArrayList or a mutable data class, are not observable by Compose and don&rsquo;t trigger a recomposition when they change. Instead of using non-observable mutable objects, the recommendation is to use an observable data holder such as <code>State&lt;List&lt;T>></code> and the immutable <code>listOf()</code>.</p></blockquote><p>While <code>remember</code> helps you retain state across recompositions, the state is not retained across configuration changes. For this, you must use <code>rememberSaveable</code>. <code>rememberSaveable</code> automatically saves any value that can be saved in a <code>Bundle</code>.</p><blockquote><p>Compose automatically recomposes from reading <code>State</code> objects. If you use another observable type such as <code>LiveData</code> in Compose, you should convert it to <code>State</code> before reading it. Make sure that type conversion happens in a composable, using a composable extension function like <code>LiveData&lt;T>.observeAsState()</code>.</p></blockquote><h3 id=state-hoisting>State hoisting</h3><p>State hoisting in Compose is a pattern of moving state to a composable&rsquo;s caller to make a composable stateless.</p><p>The general pattern for state hoisting in Jetpack Compose is to replace the state variable with two parameters:</p><ul><li><strong><code>value: T</code>:</strong> the current value to display</li><li><strong><code>onValueChange: (T) -> Unit</code>:</strong> an event that requests the value to change, where <code>T</code> is the proposed new value</li></ul><h4 id=ui-state>UI state</h4><p><a class=link href=https://developer.android.com/topic/architecture/ui-layer/stateholders#ui-state target=_blank rel=noopener>UI state</a> is the property that describes the UI. There are two types of UI state:</p><ul><li><strong>Screen UI state</strong> is <em>what</em> you need to display on the screen. This state is usually connected with other layers of the hierarchy because it contains app data.</li><li><strong>UI element state</strong> refers to properties intrinsic to UI elements that influence how they are rendered. A UI element may be shown or hidden and may have a certain font, font size, or font color.</li></ul><h4 id=logic>Logic</h4><p>Logic in an application can be either business logic or UI logic:</p><ul><li><strong>Business logic</strong> is the implementation of product requirements for app data. For example, bookmarking an article in a news reader app when the user taps the button. This logic to save a bookmark to a file or database is usually placed in the domain or data layers. The state holder usually delegates this logic to those layers by calling the methods they expose.</li><li><strong>UI logic</strong> is related to <em>how</em> to display UI state on the screen. For example, obtaining the right search bar hint when the user has selected a category, scrolling to a particular item in a list, or the navigation logic to a particular screen when the user clicks a button.</li></ul><h5 id=ui-logic>UI Logic</h5><p>When <a class=link href=https://developer.android.com/topic/architecture/ui-layer#logic-types target=_blank rel=noopener>UI logic</a> needs to read or write state, you should scope the state to the UI, following its lifecycle. To achieve this, you should hoist the state at the correct level in a composable function. Alternatively, you can do so in a <a class=link href=https://developer.android.com/topic/architecture/ui-layer/stateholders#ui-logic target=_blank rel=noopener>plain state holder class</a>, also scoped to the UI lifecycle.</p><blockquote><p><strong>Key Point:</strong> Keeping UI element state internal to composable functions is acceptable. This is a good solution if the state and logic you apply to it is simple and other parts of the UI hierarchy don&rsquo;t need the state.</p></blockquote><h5 id=business-logic>Business logic</h5><p>If composables and plain state holders classes are in charge of the UI logic and UI element state, a screen level state holder is in charge of the following tasks:</p><ul><li>Providing access to the <a class=link href=https://developer.android.com/topic/architecture/ui-layer#logic-types target=_blank rel=noopener>business logic</a> of the application that is usually placed in other layers of the hierarchy such as the business and data layers.</li><li>Preparing the application data for presentation in a particular screen, which becomes the screen UI state.</li></ul><p>The <a class=link href=https://developer.android.com/topic/libraries/architecture/viewmodel#best-practices target=_blank rel=noopener>benefits</a> of AAC ViewModels in Android development make them suitable for providing access to the business logic and preparing the application data for presentation on the screen.</p><p>When you hoist UI state in the <code>ViewModel</code>, you move it outside of the Composition.</p><p><strong>Figure 6</strong>: State hoisted to the ViewModel is stored outside of the Composition.</p><p>ViewModels aren&rsquo;t stored as part of the Composition. They&rsquo;re provided by the framework and they&rsquo;re scoped to a <a class=link href=https://developer.android.com/reference/androidx/lifecycle/ViewModelStoreOwner target=_blank rel=noopener><code>ViewModelStoreOwner</code></a> which can be an Activity, Fragment, navigation graph, or destination of a navigation graph.</p><p>You should inject the <code>ViewModel</code> instance in your screen-level composables to provide access to business logic.</p><blockquote><p><strong>Note:</strong> You should not pass <code>ViewModel</code> instances down to other composables.</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-Kotlin data-lang=Kotlin><span class=line><span class=cl><span class=n>ConversationScreen</span>
</span></span><span class=line><span class=cl><span class=n>ConversationScreen</span>
</span></span></code></pre></div><h4 id=unidirectional-data-flow>unidirectional data flow</h4><p>The pattern where the state goes down, and events go up is called a <em>unidirectional data flow</em>.</p><p><img src=https://developer.android.com/static/images/jetpack/compose/mmodel-flow-data.png loading=lazy alt="Illustration of the flow of data in a Compose UI, from high-level objects down to their children."></p><p><img src=https://developer.android.com/static/images/jetpack/compose/mmodel-flow-events.png loading=lazy alt="Illustration of how UI elements respond to interaction, by triggering events that are handled by the app logic."></p><blockquote><p><strong>Key Point:</strong> When hoisting state, there are three rules to help you figure out where state should go:</p><ol><li>State should be hoisted to at <em>least</em> the <strong>lowest common parent</strong> of all composables that use the state (read).</li><li>State should be hoisted to at <em>least</em> the <strong>highest level it may be changed</strong> (write).</li><li>If <strong>two states change in response to the same events</strong> they should be <strong>hoisted together.</strong></li></ol><p>You can hoist state higher than these rules require, but underhoisting state makes it difficult or impossible to follow unidirectional data flow.</p></blockquote><h3 id=state-storage>state storage</h3><p><strong>Parcelize</strong></p><p>The simplest solution is to add the <a class=link href=https://github.com/Kotlin/KEEP/blob/master/proposals/extensions/android-parcelable.md target=_blank rel=noopener><code>@Parcelize</code></a> annotation to the object. The object becomes parcelable, and can be bundled. For example, this code makes a parcelable <code>City</code> data type and saves it to the state.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=nd>@Parcelize</span>
</span></span><span class=line><span class=cl><span class=k>data</span> <span class=k>class</span> <span class=nc>City</span><span class=p>(</span><span class=k>val</span> <span class=py>name</span><span class=p>:</span> <span class=n>String</span><span class=p>,</span> <span class=k>val</span> <span class=py>country</span><span class=p>:</span> <span class=n>String</span><span class=p>)</span> <span class=p>:</span> <span class=n>Parcelable</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Composable</span>
</span></span><span class=line><span class=cl><span class=k>fun</span> <span class=nf>CityScreen</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=py>selectedCity</span> <span class=p>=</span> <span class=n>rememberSaveable</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>mutableStateOf</span><span class=p>(</span><span class=n>City</span><span class=p>(</span><span class=s2>&#34;Madrid&#34;</span><span class=p>,</span> <span class=s2>&#34;Spain&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>MapSaver</strong></p><p>If for some reason <code>@Parcelize</code> is not suitable, you can use <code>mapSaver</code> to define your own rule for converting an object into a set of values that the system can save to the <code>Bundle</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>data</span> <span class=k>class</span> <span class=nc>City</span><span class=p>(</span><span class=k>val</span> <span class=py>name</span><span class=p>:</span> <span class=n>String</span><span class=p>,</span> <span class=k>val</span> <span class=py>country</span><span class=p>:</span> <span class=n>String</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>val</span> <span class=py>CitySaver</span> <span class=p>=</span> <span class=n>run</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>nameKey</span> <span class=p>=</span> <span class=s2>&#34;Name&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>countryKey</span> <span class=p>=</span> <span class=s2>&#34;Country&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>mapSaver</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>save</span> <span class=p>=</span> <span class=p>{</span> <span class=n>mapOf</span><span class=p>(</span><span class=n>nameKey</span> <span class=n>to</span> <span class=k>it</span><span class=p>.</span><span class=n>name</span><span class=p>,</span> <span class=n>countryKey</span> <span class=n>to</span> <span class=k>it</span><span class=p>.</span><span class=n>country</span><span class=p>)</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=n>restore</span> <span class=p>=</span> <span class=p>{</span> <span class=n>City</span><span class=p>(</span><span class=k>it</span><span class=p>[</span><span class=n>nameKey</span><span class=p>]</span> <span class=k>as</span> <span class=n>String</span><span class=p>,</span> <span class=k>it</span><span class=p>[</span><span class=n>countryKey</span><span class=p>]</span> <span class=k>as</span> <span class=n>String</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Composable</span>
</span></span><span class=line><span class=cl><span class=k>fun</span> <span class=nf>CityScreen</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=py>selectedCity</span> <span class=p>=</span> <span class=n>rememberSaveable</span><span class=p>(</span><span class=n>stateSaver</span> <span class=p>=</span> <span class=n>CitySaver</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>mutableStateOf</span><span class=p>(</span><span class=n>City</span><span class=p>(</span><span class=s2>&#34;Madrid&#34;</span><span class=p>,</span> <span class=s2>&#34;Spain&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>ListSaver</strong></p><p>To avoid needing to define the keys for the map, you can also use <code>listSaver</code> and use its indices as keys:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>data</span> <span class=k>class</span> <span class=nc>City</span><span class=p>(</span><span class=k>val</span> <span class=py>name</span><span class=p>:</span> <span class=n>String</span><span class=p>,</span> <span class=k>val</span> <span class=py>country</span><span class=p>:</span> <span class=n>String</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>val</span> <span class=py>CitySaver</span> <span class=p>=</span> <span class=n>listSaver</span><span class=p>&lt;</span><span class=n>City</span><span class=p>,</span> <span class=n>Any</span><span class=p>&gt;(</span>
</span></span><span class=line><span class=cl>    <span class=n>save</span> <span class=p>=</span> <span class=p>{</span> <span class=n>listOf</span><span class=p>(</span><span class=k>it</span><span class=p>.</span><span class=n>name</span><span class=p>,</span> <span class=k>it</span><span class=p>.</span><span class=n>country</span><span class=p>)</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=n>restore</span> <span class=p>=</span> <span class=p>{</span> <span class=n>City</span><span class=p>(</span><span class=k>it</span><span class=p>[</span><span class=m>0</span><span class=p>]</span> <span class=k>as</span> <span class=n>String</span><span class=p>,</span> <span class=k>it</span><span class=p>[</span><span class=m>1</span><span class=p>]</span> <span class=k>as</span> <span class=n>String</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Composable</span>
</span></span><span class=line><span class=cl><span class=k>fun</span> <span class=nf>CityScreen</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=py>selectedCity</span> <span class=p>=</span> <span class=n>rememberSaveable</span><span class=p>(</span><span class=n>stateSaver</span> <span class=p>=</span> <span class=n>CitySaver</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>mutableStateOf</span><span class=p>(</span><span class=n>City</span><span class=p>(</span><span class=s2>&#34;Madrid&#34;</span><span class=p>,</span> <span class=s2>&#34;Spain&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=lifecycle>Lifecycle</h2><p>The lifecycle of a composable is defined by the following events:</p><ul><li>entering the Composition</li><li>getting recomposed 0 or more times</li><li>leaving the Composition.</li></ul><p><img src=https://developer.android.com/static/images/jetpack/compose/lifecycle-composition.png loading=lazy alt="Diagram showing the lifecycle of a composable"></p><p>Recomposition is typically triggered by a change to a <a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/runtime/State target=_blank rel=noopener><code>State</code></a> object. Compose tracks these and runs all composables in the Composition that read that particular <code>State&lt;T></code>, and any composables that they call that cannot be <a class=link href=https://developer.android.com/jetpack/compose/lifecycle#skipping target=_blank rel=noopener>skipped</a>.</p><blockquote><p>A Composable&rsquo;s&rsquo; lifecycle is simpler than the lifecycle of views, activities, and fragments. When a composable needs to manage or interact with external resources that <em>do</em> have a more complex lifecycle, you should use <a class=link href=https://developer.android.com/jetpack/compose/lifecycle#state-effect-use-cases target=_blank rel=noopener>effects</a>.</p></blockquote><p>Add extra information to help smart recompositions</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=nd>@Composable</span>
</span></span><span class=line><span class=cl><span class=k>fun</span> <span class=nf>MoviesScreen</span><span class=p>(</span><span class=n>movies</span><span class=p>:</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Column</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>key</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>id</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// Unique ID for this movie
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>MovieOverview</span><span class=p>(</span><span class=n>movie</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=stable>Stable</h3><p>If a composable is already in the Composition, it can skip recomposition if all the inputs are stable and haven&rsquo;t changed.</p><p>A stable type must comply with the following contract:</p><ul><li>The result of <code>equals</code> for two instances will <em>forever</em> be the same for the same two instances.</li><li>If a public property of the type changes, Composition will be notified.</li><li>All public property types are also stable.</li></ul><p>There are some important common types that fall into this contract that the compose compiler will treat as stable, even though they are not explicitly marked as stable by using the <code>@Stable</code> annotation:</p><ul><li>All primitive value types: <code>Boolean</code>, <code>Int</code>, <code>Long</code>, <code>Float</code>, <code>Char</code>, etc.</li><li>Strings</li><li>All Function types (lambdas)</li></ul><p>All of these types are able to follow the contract of stable because they are immutable. Since immutable types never change, they never have to notify Composition of the change, so it is much easier to follow this contract.</p><blockquote><p><strong>Note:</strong> All deeply immutable types can safely be considered stable types.</p></blockquote><p>One notable type that is stable but <em>is</em> mutable is Compose’s <code>MutableState</code> type. If a value is held in a <code>MutableState</code>, the state object overall is considered to be stable as Compose will be notified of any changes to the <code>.value</code> property of <code>State</code>.</p><p>If Compose is not able to infer that a type is stable, but you want to force Compose to treat it as stable, mark it with the <a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/runtime/Stable target=_blank rel=noopener><code>@Stable</code></a> annotation.</p><h2 id=modifiers>Modifiers</h2><p>odifiers allow you to decorate or augment a composable. Modifiers let you do these sorts of things:</p><ul><li>Change the composable&rsquo;s size, layout, behavior, and appearance</li><li>Add information, like accessibility labels</li><li>Process user input</li><li>Add high-level interactions, like making an element clickable, scrollable, draggable, or zoomable</li></ul><p>It&rsquo;s a best practice to have <em>all</em> of your Composables accept a <code>modifier</code> parameter, and pass that modifier to its first child that emits UI.</p><p>The order of modifier functions is <strong>significant</strong>. Since each function makes changes to the <code>Modifier</code>returned by the previous function, the sequence affects the final result.</p><p>Multiple modifiers can be chained together to decorate or augment a composable. This chain is created via the <a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/ui/Modifier target=_blank rel=noopener><code>Modifier</code></a> interface which represents an ordered, immutable list of single <a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/ui/Modifier.Element target=_blank rel=noopener><code>Modifier.Elements</code></a>.</p><p>Each <code>Modifier.Element</code> represents an individual behavior, like layout, drawing and graphics behaviors, all gesture-related, focus and semantics behaviors, as well as device input events. Their ordering matters: modifier elements that are added first will be applied first.</p><p>Sometimes it can be beneficial to reuse the same modifier chain instances in multiple composables, by extracting them into variables and hoisting them into higher scopes. It can improve code readability or help improve your app&rsquo;s performance.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>val</span> <span class=py>reusableModifier</span> <span class=p>=</span> <span class=n>Modifier</span>
</span></span><span class=line><span class=cl>                        <span class=p>.</span><span class=n>fillMaxWidth</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                        <span class=p>.</span><span class=n>background</span><span class=p>(</span><span class=nc>Color</span><span class=p>.</span><span class=n>Red</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=p>.</span><span class=n>padding</span><span class=p>(</span><span class=m>12.</span><span class=n>dp</span><span class=p>)</span>
</span></span></code></pre></div><p>You can further chain or append your extracted modifier chains by calling the <a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/ui/Modifier#then%28androidx.compose.ui.Modifier%29 target=_blank rel=noopener><code>.then()</code></a> function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>val</span> <span class=py>reusableModifier</span> <span class=p>=</span> <span class=n>Modifier</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=n>fillMaxWidth</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=n>background</span><span class=p>(</span><span class=nc>Color</span><span class=p>.</span><span class=n>Red</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=n>padding</span><span class=p>(</span><span class=m>12.</span><span class=n>dp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Append to your reusableModifier
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>reusableModifier</span><span class=p>.</span><span class=n>clickable</span> <span class=p>{</span> <span class=err>…</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Append your reusableModifier
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>otherModifier</span><span class=p>.</span><span class=n>then</span><span class=p>(</span><span class=n>reusableModifier</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=side-effects>Side-effects</h2><p>A <strong>side-effect</strong> is a change to the state of the app that happens outside the scope of a composable function.</p><p>Composables should be side-effect free. When you need to make changes to the state of the app, <strong>you should use the Effect APIs so that those side effects are executed in a predictable manner</strong>.</p><blockquote><p><strong>Key Term:</strong> An <strong>effect</strong> is a composable function that doesn&rsquo;t emit UI and causes side effects to run when a composition completes.</p></blockquote><h3 id=launchedeffect-run-suspend-functions-in-the-scope-of-a-composable>LaunchedEffect: run suspend functions in the scope of a composable</h3><p>To call suspend functions safely from inside a composable, use the <a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/runtime/package-summary#LaunchedEffect%28kotlin.Any,kotlin.coroutines.SuspendFunction1%29 target=_blank rel=noopener><code>LaunchedEffect</code></a> composable. When <code>LaunchedEffect</code> enters the Composition, it launches a coroutine with the block of code passed as a parameter. The coroutine will be cancelled if <code>LaunchedEffect</code> leaves the composition. If <code>LaunchedEffect</code> is recomposed with different keys, the existing coroutine will be cancelled and the new suspend function will be launched in a new coroutine.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=nd>@Composable</span>
</span></span><span class=line><span class=cl><span class=k>fun</span> <span class=nf>LandingScreen</span><span class=p>(</span><span class=n>onTimeout</span><span class=p>:</span> <span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Unit</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// This will always refer to the latest onTimeout function that
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// LandingScreen was recomposed with
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>val</span> <span class=py>currentOnTimeout</span> <span class=k>by</span> <span class=n>rememberUpdatedState</span><span class=p>(</span><span class=n>onTimeout</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Create an effect that matches the lifecycle of LandingScreen.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// If LandingScreen recomposes, the delay shouldn&#39;t start again.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>LaunchedEffect</span><span class=p>(</span><span class=k>true</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>delay</span><span class=p>(</span><span class=n>SplashWaitTimeMillis</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>currentOnTimeout</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/* Landing screen content */</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=remembercoroutinescope-obtain-a-composition-aware-scope-to-launch-a-coroutine-outside-a-composable>rememberCoroutineScope: obtain a composition-aware scope to launch a coroutine outside a composable</h3><p>As <code>LaunchedEffect</code> is a composable function, it can only be used inside other composable functions. In order to launch a coroutine outside of a composable, but scoped so that it will be automatically canceled once it leaves the composition, use <a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/runtime/package-summary#rememberCoroutineScope%28kotlin.Function0%29 target=_blank rel=noopener><code>rememberCoroutineScope</code></a></p><p><code>rememberCoroutineScope</code> is a composable function that returns a <code>CoroutineScope</code> bound to the point of the Composition where it&rsquo;s called. The scope will be cancelled when the call leaves the Composition.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=nd>@Composable</span>
</span></span><span class=line><span class=cl><span class=k>fun</span> <span class=nf>LandingScreen</span><span class=p>(</span><span class=n>onTimeout</span><span class=p>:</span> <span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Unit</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// This will always refer to the latest onTimeout function that
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// LandingScreen was recomposed with
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>val</span> <span class=py>currentOnTimeout</span> <span class=k>by</span> <span class=n>rememberUpdatedState</span><span class=p>(</span><span class=n>onTimeout</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Create an effect that matches the lifecycle of LandingScreen.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// If LandingScreen recomposes, the delay shouldn&#39;t start again.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>LaunchedEffect</span><span class=p>(</span><span class=k>true</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>delay</span><span class=p>(</span><span class=n>SplashWaitTimeMillis</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>currentOnTimeout</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/* Landing screen content */</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=rememberupdatedstate-reference-a-value-in-an-effect-that-shouldnt-restart-if-the-value-changes>rememberUpdatedState: reference a value in an effect that shouldn&rsquo;t restart if the value changes</h3><p><code>LaunchedEffect</code> restarts when one of the key parameters changes. However, in some situations you might want to capture a value in your effect that, if it changes, you do not want the effect to restart. In order to do this, it is required to use <code>rememberUpdatedState</code> to create a reference to this value which can be captured and updated. This approach is helpful for effects that contain long-lived operations that may be expensive or prohibitive to recreate and restart.</p><p>For example, suppose your app has a <code>LandingScreen</code> that disappears after some time. Even if <code>LandingScreen</code> is recomposed, the effect that waits for some time and notifies that the time passed shouldn&rsquo;t be restarted:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=nd>@Composable</span>
</span></span><span class=line><span class=cl><span class=k>fun</span> <span class=nf>LandingScreen</span><span class=p>(</span><span class=n>onTimeout</span><span class=p>:</span> <span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Unit</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// This will always refer to the latest onTimeout function that
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// LandingScreen was recomposed with
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>val</span> <span class=py>currentOnTimeout</span> <span class=k>by</span> <span class=n>rememberUpdatedState</span><span class=p>(</span><span class=n>onTimeout</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Create an effect that matches the lifecycle of LandingScreen.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// If LandingScreen recomposes, the delay shouldn&#39;t start again.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>LaunchedEffect</span><span class=p>(</span><span class=k>true</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>delay</span><span class=p>(</span><span class=n>SplashWaitTimeMillis</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>currentOnTimeout</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/* Landing screen content */</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=disposableeffect-effects-that-require-cleanup>DisposableEffect: effects that require cleanup</h3><p>For side effects that need to be <em>cleaned up</em> after the keys change or if the composable leaves the Composition, use <a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/runtime/package-summary#DisposableEffect%28kotlin.Any,kotlin.Function1%29 target=_blank rel=noopener><code>DisposableEffect</code></a>. If the <code>DisposableEffect</code> keys change, the composable needs to <em>dispose</em> (do the cleanup for) its current effect, and reset by calling the effect again.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=nd>@Composable</span>
</span></span><span class=line><span class=cl><span class=k>fun</span> <span class=nf>HomeScreen</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>lifecycleOwner</span><span class=p>:</span> <span class=n>LifecycleOwner</span> <span class=p>=</span> <span class=nc>LocalLifecycleOwner</span><span class=p>.</span><span class=n>current</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>onStart</span><span class=p>:</span> <span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Unit</span><span class=p>,</span> <span class=c1>// Send the &#39;started&#39; analytics event
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>onStop</span><span class=p>:</span> <span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Unit</span> <span class=c1>// Send the &#39;stopped&#39; analytics event
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Safely update the current lambdas when a new one is provided
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>val</span> <span class=py>currentOnStart</span> <span class=k>by</span> <span class=n>rememberUpdatedState</span><span class=p>(</span><span class=n>onStart</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>currentOnStop</span> <span class=k>by</span> <span class=n>rememberUpdatedState</span><span class=p>(</span><span class=n>onStop</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// If `lifecycleOwner` changes, dispose and reset the effect
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>DisposableEffect</span><span class=p>(</span><span class=n>lifecycleOwner</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Create an observer that triggers our remembered callbacks
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// for sending analytics events
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>val</span> <span class=py>observer</span> <span class=p>=</span> <span class=n>LifecycleEventObserver</span> <span class=p>{</span> <span class=n>_</span><span class=p>,</span> <span class=n>event</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>event</span> <span class=o>==</span> <span class=nc>Lifecycle</span><span class=p>.</span><span class=nc>Event</span><span class=p>.</span><span class=n>ON_START</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>currentOnStart</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>event</span> <span class=o>==</span> <span class=nc>Lifecycle</span><span class=p>.</span><span class=nc>Event</span><span class=p>.</span><span class=n>ON_STOP</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>currentOnStop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Add the observer to the lifecycle
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>lifecycleOwner</span><span class=p>.</span><span class=n>lifecycle</span><span class=p>.</span><span class=n>addObserver</span><span class=p>(</span><span class=n>observer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// When the effect leaves the Composition, remove the observer
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>onDispose</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>lifecycleOwner</span><span class=p>.</span><span class=n>lifecycle</span><span class=p>.</span><span class=n>removeObserver</span><span class=p>(</span><span class=n>observer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/* Home screen content */</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=sideeffect-publish-compose-state-to-non-compose-code>SideEffect: publish Compose state to non-compose code</h3><p>To share Compose state with objects not managed by compose, use the <a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/runtime/package-summary#SideEffect%28kotlin.Function0%29 target=_blank rel=noopener><code>SideEffect</code></a> composable, as it&rsquo;s invoked on every successful recomposition.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=nd>@Composable</span>
</span></span><span class=line><span class=cl><span class=k>fun</span> <span class=nf>rememberAnalytics</span><span class=p>(</span><span class=n>user</span><span class=p>:</span> <span class=n>User</span><span class=p>):</span> <span class=n>FirebaseAnalytics</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>analytics</span><span class=p>:</span> <span class=n>FirebaseAnalytics</span> <span class=p>=</span> <span class=n>remember</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=cm>/* ... */</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// On every successful composition, update FirebaseAnalytics with
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// the userType from the current User, ensuring that future analytics
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// events have this metadata attached
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>SideEffect</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>analytics</span><span class=p>.</span><span class=n>setUserProperty</span><span class=p>(</span><span class=s2>&#34;userType&#34;</span><span class=p>,</span> <span class=n>user</span><span class=p>.</span><span class=n>userType</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>analytics</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=producestate-convert-non-compose-state-into-compose-state>produceState: convert non-Compose state into Compose state</h3><p><a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/runtime/package-summary#produceState%28kotlin.Any,kotlin.coroutines.SuspendFunction1%29 target=_blank rel=noopener><code>produceState</code></a> launches a coroutine scoped to the Composition that can push values into a returned <a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/runtime/State target=_blank rel=noopener><code>State</code></a>. Use it to convert non-Compose state into Compose state, for example bringing external subscription-driven state such as <code>Flow</code>, <code>LiveData</code>, or <code>RxJava</code> into the Composition.</p><p>The producer is launched when <code>produceState</code> enters the Composition, and will be cancelled when it leaves the Composition.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=nd>@Composable</span>
</span></span><span class=line><span class=cl><span class=k>fun</span> <span class=nf>loadNetworkImage</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span><span class=p>:</span> <span class=n>String</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>imageRepository</span><span class=p>:</span> <span class=n>ImageRepository</span>
</span></span><span class=line><span class=cl><span class=p>):</span> <span class=n>State</span><span class=p>&lt;</span><span class=n>Result</span><span class=p>&lt;</span><span class=n>Image</span><span class=p>&gt;&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Creates a State&lt;T&gt; with Result.Loading as initial value
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// If either `url` or `imageRepository` changes, the running producer
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// will cancel and will be re-launched with the new inputs.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=n>produceState</span><span class=p>&lt;</span><span class=n>Result</span><span class=p>&lt;</span><span class=n>Image</span><span class=p>&gt;&gt;(</span><span class=n>initialValue</span> <span class=p>=</span> <span class=nc>Result</span><span class=p>.</span><span class=n>Loading</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>imageRepository</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// In a coroutine, can make suspend calls
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>val</span> <span class=py>image</span> <span class=p>=</span> <span class=n>imageRepository</span><span class=p>.</span><span class=n>load</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Update State with either an Error or Success result.
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// This will trigger a recomposition where this State is read
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>value</span> <span class=p>=</span> <span class=k>if</span> <span class=p>(</span><span class=n>image</span> <span class=o>==</span> <span class=k>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nc>Result</span><span class=p>.</span><span class=n>Error</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nc>Result</span><span class=p>.</span><span class=n>Success</span><span class=p>(</span><span class=n>image</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><blockquote><p><strong>Note:</strong> Composables with a return type should be named the way you&rsquo;d name a normal Kotlin function, starting with a lowercase letter.</p></blockquote><h3 id=derivedstateof-convert-one-or-multiple-state-objects-into-another-state>derivedStateOf: convert one or multiple state objects into another state</h3><p>Use <a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/runtime/package-summary#derivedStateOf%28kotlin.Function0%29 target=_blank rel=noopener><code>derivedStateOf</code></a> when a certain state is calculated or derived from other state objects. Using this function guarantees that the calculation will only occur whenever one of the states used in the calculation changes.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=nd>@Composable</span>
</span></span><span class=line><span class=cl><span class=k>fun</span> <span class=nf>TodoList</span><span class=p>(</span><span class=n>highPriorityKeywords</span><span class=p>:</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>String</span><span class=p>&gt;</span> <span class=p>=</span> <span class=n>listOf</span><span class=p>(</span><span class=s2>&#34;Review&#34;</span><span class=p>,</span> <span class=s2>&#34;Unblock&#34;</span><span class=p>,</span> <span class=s2>&#34;Compose&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>todoTasks</span> <span class=p>=</span> <span class=n>remember</span> <span class=p>{</span> <span class=n>mutableStateListOf</span><span class=p>&lt;</span><span class=n>String</span><span class=p>&gt;()</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Calculate high priority tasks only when the todoTasks or highPriorityKeywords
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// change, not on every recomposition
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>val</span> <span class=py>highPriorityTasks</span> <span class=k>by</span> <span class=n>remember</span><span class=p>(</span><span class=n>highPriorityKeywords</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>derivedStateOf</span> <span class=p>{</span> <span class=n>todoTasks</span><span class=p>.</span><span class=n>filter</span> <span class=p>{</span> <span class=k>it</span><span class=p>.</span><span class=n>containsWord</span><span class=p>(</span><span class=n>highPriorityKeywords</span><span class=p>)</span> <span class=p>}</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Box</span><span class=p>(</span><span class=nc>Modifier</span><span class=p>.</span><span class=n>fillMaxSize</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>LazyColumn</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>items</span><span class=p>(</span><span class=n>highPriorityTasks</span><span class=p>)</span> <span class=p>{</span> <span class=cm>/* ... */</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>items</span><span class=p>(</span><span class=n>todoTasks</span><span class=p>)</span> <span class=p>{</span> <span class=cm>/* ... */</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=cm>/* Rest of the UI where users can add elements to the list */</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=snapshotflow-convert-composes-state-into-flows>snapshotFlow: convert Compose&rsquo;s State into Flows</h3><p>Use <a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/runtime/package-summary#snapshotFlow%28kotlin.Function0%29 target=_blank rel=noopener><code>snapshotFlow</code></a> to convert <a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/runtime/State target=_blank rel=noopener><code>State</code></a> objects into a cold Flow. <code>snapshotFlow</code> runs its block when collected and emits the result of the <code>State</code> objects read in it. When one of the <code>State</code> objects read inside the <code>snapshotFlow</code> block mutates, the Flow will emit the new value to its collector if the new value is not <a class=link href=https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-any/equals.html target=_blank rel=noopener>equal to</a> the previous emitted value (this behavior is similar to that of <a class=link href=https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/distinct-until-changed.html target=_blank rel=noopener><code>Flow.distinctUntilChanged</code></a>).</p><p>The following example shows a side effect that records when the user scrolls past the first item in a list to analytics:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>val</span> <span class=py>listState</span> <span class=p>=</span> <span class=n>rememberLazyListState</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>LazyColumn</span><span class=p>(</span><span class=n>state</span> <span class=p>=</span> <span class=n>listState</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>LaunchedEffect</span><span class=p>(</span><span class=n>listState</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>snapshotFlow</span> <span class=p>{</span> <span class=n>listState</span><span class=p>.</span><span class=n>firstVisibleItemIndex</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=n>map</span> <span class=p>{</span> <span class=n>index</span> <span class=o>-&gt;</span> <span class=n>index</span> <span class=p>&gt;</span> <span class=m>0</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=n>distinctUntilChanged</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=n>filter</span> <span class=p>{</span> <span class=k>it</span> <span class=o>==</span> <span class=k>true</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=n>collect</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nc>MyAnalyticsService</span><span class=p>.</span><span class=n>sendScrolledPastFirstItemEvent</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=restarting-effects>Restarting effects</h3><p>As a rule of thumb, mutable and immutable variables used in the effect block of code should be added as parameters to the effect composable. Apart from those, more parameters can be added to force restarting the effect. If the change of a variable shouldn&rsquo;t cause the effect to restart, the variable should be wrapped in <a class=link href=https://developer.android.com/jetpack/compose/side-effects#rememberupdatedstate target=_blank rel=noopener><code>rememberUpdatedState</code></a>. If the variable never changes because it&rsquo;s wrapped in a <code>remember</code> with no keys, you don&rsquo;t need to pass the variable as a key to the effect.</p><p>You can use a constant like <code>true</code> as an effect key to make it <strong>follow the lifecycle of the call site</strong>.</p><h2 id=phases>Phases</h2><p>Like most other UI toolkits, Compose renders a frame through several distinct <em>phases</em>.</p><p>Compose has three main phases:</p><ol><li><strong>Composition</strong>: <em>What</em> UI to show. Compose runs composable functions and creates a description of your UI.</li><li><strong>Layout</strong>: <em>Where</em> to place UI. This phase consists of two steps: measurement and placement. Layout elements measure and place themselves and any child elements in 2D coordinates, for each node in the layout tree.</li><li><strong>Drawing</strong>: <em>How</em> it renders. UI elements draw into a Canvas, usually a device screen.</li></ol><p>The order of these phases is generally the same, allowing data to flow in one direction from composition to layout to drawing to produce a frame (also known as <a class=link href=https://developer.android.com/jetpack/compose/architecture#udf target=_blank rel=noopener>unidirectional data flow</a>). <a class=link href=https://developer.android.com/jetpack/compose/layouts/basics#constraints target=_blank rel=noopener><code>BoxWithConstraints</code></a> and <a class=link href=https://developer.android.com/jetpack/compose/lists#lazy target=_blank rel=noopener><code>LazyColumn</code> and <code>LazyRow</code></a> are notable exceptions, where the composition of its children depends on the parent&rsquo;s layout phase.</p><h2 id=architectural-layering>Architectural Layering</h2><p>The major layers of Jetpack Compose are:</p><p><img src=https://developer.android.com/static/images/jetpack/compose/layering-major-layers.svg loading=lazy alt=img></p><p>Each layer is built upon the lower levels, combining functionality to create higher level components.</p><h2 id=semantics>Semantics</h2><p>The Composition is a tree-structure that consists of the composables that describe your UI.</p><p>Next to the Composition, there exists a parallel tree, called the <em>Semantics tree</em>. This tree describes your UI in an alternative manner that is understandable for <a class=link href=https://developer.android.com/jetpack/compose/accessibility target=_blank rel=noopener>Accessibility</a> services and for the <a class=link href=https://developer.android.com/jetpack/compose/testing target=_blank rel=noopener>Testing</a> framework.</p><p>If your app consists of composables and modifiers from the Compose foundation and material library, the Semantics tree is automatically filled and generated for you. However <strong>when you’re adding custom low-level composables, you will have to manually provide its semantics</strong></p><h2 id=compositionlocal>CompositionLocal</h2><p><code>CompositionLocal</code>s can be used as an implicit way to have data flow through a composition.</p><p><code>CompositionLocal</code> elements are usually provided with a value in a certain node of the UI tree. That value can be used by its composable descendants without declaring the <code>CompositionLocal</code> as a parameter in the composable function.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=c1>// Define a CompositionLocal global object with a default
</span></span></span><span class=line><span class=cl><span class=c1>// This instance can be accessed by all composables in the app
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>val</span> <span class=py>ActiveUser</span> <span class=p>=</span> <span class=n>compositionLocalOf</span><span class=p>&lt;</span><span class=n>User</span><span class=p>&gt;</span> <span class=p>{</span> <span class=n>error</span><span class=p>(</span><span class=s2>&#34;No active user found!&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Composable</span>
</span></span><span class=line><span class=cl><span class=k>fun</span> <span class=nf>UserPhoto</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>user</span> <span class=p>=</span> <span class=nc>ActiveUser</span><span class=p>.</span><span class=n>current</span>
</span></span><span class=line><span class=cl>    <span class=n>ProfileIcon</span><span class=p>(</span><span class=n>src</span> <span class=p>=</span> <span class=n>user</span><span class=p>.</span><span class=n>profilePhotoUrl</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nd>@Composable</span>
</span></span><span class=line><span class=cl><span class=k>fun</span> <span class=nf>App</span><span class=p>(</span><span class=n>user</span><span class=p>:</span> <span class=n>User</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>CompositionLocalProvider</span><span class=p>(</span><span class=n>ActiveUser</span> <span class=n>provides</span> <span class=n>user</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>SomeScreen</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Composable</span>
</span></span><span class=line><span class=cl><span class=k>fun</span> <span class=nf>SomeScreen</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>UserPhoto</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Composable</span>
</span></span><span class=line><span class=cl><span class=k>fun</span> <span class=nf>UserPhoto</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>user</span> <span class=p>=</span> <span class=nc>ActiveUser</span><span class=p>.</span><span class=n>current</span>
</span></span><span class=line><span class=cl>    <span class=n>ProfileIcon</span><span class=p>(</span><span class=n>src</span> <span class=p>=</span> <span class=n>user</span><span class=p>.</span><span class=n>profilePhotoUrl</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>There are two APIs to create a <code>CompositionLocal</code>:</p><ul><li><a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/runtime/package-summary#compositionLocalOf%28androidx.compose.runtime.SnapshotMutationPolicy,kotlin.Function0%29 target=_blank rel=noopener><code>compositionLocalOf</code></a>: Changing the value provided during recomposition invalidates <em>only</em> the content that reads its <a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/runtime/CompositionLocal#current%28%29 target=_blank rel=noopener><code>current</code></a> value.</li><li><a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/runtime/package-summary#staticCompositionLocalOf%28kotlin.Function0%29 target=_blank rel=noopener><code>staticCompositionLocalOf</code></a>: Unlike <code>compositionLocalOf</code>, reads of a <code>staticCompositionLocalOf</code> are not tracked by Compose. Changing the value causes the entirety of the <code>content</code> lambda where the <code>CompositionLocal</code> is provided to be recomposed, instead of just the places where the <code>current</code> value is read in the Composition.</li></ul><p>If the value provided to the <code>CompositionLocal</code> is highly unlikely to change or will never change, use <code>staticCompositionLocalOf</code> to get performance benefits.</p><h2 id=navigation>Navigation</h2><p>The <a class=link href=https://developer.android.com/reference/androidx/navigation/NavController target=_blank rel=noopener><code>NavController</code></a> is the central API for the Navigation component. It is stateful and keeps track of the back stack of composables that make up the screens in your app and the state of each screen.</p><p>You can create a <code>NavController</code> by using the <a class=link href=https://developer.android.com/reference/kotlin/androidx/navigation/compose/package-summary#rememberNavController%28kotlin.Array%29 target=_blank rel=noopener><code>rememberNavController()</code></a> method in your composable:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>val</span> <span class=py>navController</span> <span class=p>=</span> <span class=n>rememberNavController</span><span class=p>()</span>
</span></span></code></pre></div><p>You should create the <code>NavController</code> in the place in your composable hierarchy where all composables that need to reference it have access to it. This follows the principles of <a class=link href=https://developer.android.com/jetpack/compose/state#state-hoisting target=_blank rel=noopener>state hoisting</a> and allows you to use the <code>NavController</code> and the state it provides via <a class=link href=https://developer.android.com/reference/kotlin/androidx/navigation/compose/package-summary#%28androidx.navigation.NavController%29.currentBackStackEntryAsState%28%29 target=_blank rel=noopener><code>currentBackStackEntryAsState()</code></a> to be used as the source of truth for updating composables outside of your screens.</p><p>Each <a class=link href=https://developer.android.com/reference/androidx/navigation/NavController target=_blank rel=noopener><code>NavController</code></a> must be associated with a single <a class=link href=https://developer.android.com/reference/androidx/navigation/NavHost target=_blank rel=noopener><code>NavHost</code></a> composable. The <code>NavHost</code> links the <code>NavController</code> with a navigation graph that specifies the composable destinations that you should be able to navigate between. As you navigate between composables, the content of the <code>NavHost</code> is automatically <a class=link href=https://developer.android.com/jetpack/compose/mental-model#recomposition target=_blank rel=noopener>recomposed</a>. Each composable destination in your navigation graph is associated with a <em>route</em>.</p><blockquote><p><strong>Key Term:</strong> <strong>Route</strong> is a <code>String</code> that defines the path to your composable. You can think of it as an implicit deep link that leads to a specific destination. Each destination should have a unique route.</p></blockquote><p>Creating the <code>NavHost</code> requires the <code>NavController</code> previously created via <code>rememberNavController()</code> and the route of the starting destination of your graph. <code>NavHost</code> creation uses the lambda syntax from the <a class=link href=https://developer.android.com/guide/navigation/navigation-kotlin-dsl#navgraphbuilder target=_blank rel=noopener>Navigation Kotlin DSL</a> to construct your navigation graph. You can add to your navigation structure by using the <a class=link href=https://developer.android.com/reference/kotlin/androidx/navigation/compose/package-summary#%28androidx.navigation.NavGraphBuilder%29.composable%28kotlin.String,kotlin.collections.List,kotlin.collections.List,kotlin.Function1%29 target=_blank rel=noopener><code>composable()</code></a> method. This method requires that you provide a route and the composable that should be linked to the destination:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=n>NavHost</span><span class=p>(</span><span class=n>navController</span> <span class=p>=</span> <span class=n>navController</span><span class=p>,</span> <span class=n>startDestination</span> <span class=p>=</span> <span class=s2>&#34;profile&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>composable</span><span class=p>(</span><span class=s2>&#34;profile&#34;</span><span class=p>)</span> <span class=p>{</span> <span class=n>Profile</span><span class=p>(</span><span class=cm>/*...*/</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>composable</span><span class=p>(</span><span class=s2>&#34;friendslist&#34;</span><span class=p>)</span> <span class=p>{</span> <span class=n>FriendsList</span><span class=p>(</span><span class=cm>/*...*/</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=cm>/*...*/</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><blockquote><p><strong>Note:</strong> the Navigation Component requires that you follow the <a class=link href=https://developer.android.com/guide/navigation/navigation-principles#fixed_start_destination target=_blank rel=noopener>Principles of Navigation</a> and use a fixed starting destination. You should not use a composable value for the <code>startDestination</code> route.</p></blockquote><p>To navigate to a composable destination in the navigation graph, you must use the <a class=link href=https://developer.android.com/reference/androidx/navigation/NavController#navigate%28kotlin.String,androidx.navigation.NavOptions,androidx.navigation.Navigator.Extras%29 target=_blank rel=noopener><code>navigate</code></a> method. <code>navigate</code> takes a single <code>String</code> parameter that represents the destination’s route. To navigate from a composable within the navigation graph, call <code>navigate</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=n>navController</span><span class=p>.</span><span class=n>navigate</span><span class=p>(</span><span class=s2>&#34;friendslist&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>By default, <a class=link href=https://developer.android.com/reference/androidx/navigation/NavController#navigate%28kotlin.String,androidx.navigation.NavOptions,androidx.navigation.Navigator.Extras%29 target=_blank rel=noopener><code>navigate</code></a> adds your new destination to the back stack. You can modify the behavior of <code>navigate</code> by attaching additional navigation options to our <code>navigate()</code> call:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=c1>// Pop everything up to the &#34;home&#34; destination off the back stack before
</span></span></span><span class=line><span class=cl><span class=c1>// navigating to the &#34;friendslist&#34; destination
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>navController</span><span class=p>.</span><span class=n>navigate</span><span class=p>(</span><span class=s2>&#34;friendslist&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>popUpTo</span><span class=p>(</span><span class=s2>&#34;home&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Pop everything up to and including the &#34;home&#34; destination off
</span></span></span><span class=line><span class=cl><span class=c1>// the back stack before navigating to the &#34;friendslist&#34; destination
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>navController</span><span class=p>.</span><span class=n>navigate</span><span class=p>(</span><span class=s2>&#34;friendslist&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>popUpTo</span><span class=p>(</span><span class=s2>&#34;home&#34;</span><span class=p>)</span> <span class=p>{</span> <span class=n>inclusive</span> <span class=p>=</span> <span class=k>true</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Navigate to the &#34;search” destination only if we’re not already on
</span></span></span><span class=line><span class=cl><span class=c1>// the &#34;search&#34; destination, avoiding multiple copies on the top of the
</span></span></span><span class=line><span class=cl><span class=c1>// back stack
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>navController</span><span class=p>.</span><span class=n>navigate</span><span class=p>(</span><span class=s2>&#34;search&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>launchSingleTop</span> <span class=p>=</span> <span class=k>true</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Destinations can be grouped into a <a class=link href=https://developer.android.com/guide/navigation/navigation-design-graph#nested_graphs target=_blank rel=noopener>nested graph</a> to modularize a particular flow in your app’s UI. An example of this could be a self-contained login flow.</p><p>The nested graph encapsulates its destinations. As with the root graph, a nested graph must have a destination identified as the start destination by its route. This is the destination that is navigated to when you navigate to the route associated with the nested graph.</p><p>To add a nested graph to your <code>NavHost</code>, you can use the <a class=link href=https://developer.android.com/reference/kotlin/androidx/navigation/compose/package-summary#%28androidx.navigation.NavGraphBuilder%29.navigation%28kotlin.String,kotlin.String,kotlin.collections.List,kotlin.collections.List,kotlin.Function1%29 target=_blank rel=noopener><code>navigation</code></a> extension function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=n>NavHost</span><span class=p>(</span><span class=n>navController</span><span class=p>,</span> <span class=n>startDestination</span> <span class=p>=</span> <span class=s2>&#34;home&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Navigating to the graph via its route (&#39;login&#39;) automatically
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// navigates to the graph&#39;s start destination - &#39;username&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// therefore encapsulating the graph&#39;s internal routing logic
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>navigation</span><span class=p>(</span><span class=n>startDestination</span> <span class=p>=</span> <span class=s2>&#34;username&#34;</span><span class=p>,</span> <span class=n>route</span> <span class=p>=</span> <span class=s2>&#34;login&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>composable</span><span class=p>(</span><span class=s2>&#34;username&#34;</span><span class=p>)</span> <span class=p>{</span> <span class=o>..</span><span class=p>.</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>composable</span><span class=p>(</span><span class=s2>&#34;password&#34;</span><span class=p>)</span> <span class=p>{</span> <span class=o>..</span><span class=p>.</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>composable</span><span class=p>(</span><span class=s2>&#34;registration&#34;</span><span class=p>)</span> <span class=p>{</span> <span class=o>..</span><span class=p>.</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>It is strongly recommended that you split your navigation graph into multiple methods as the graph grows in size. This also allows multiple modules to contribute their own navigation graphs.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>fun</span> <span class=nf>NavGraphBuilder</span><span class=p>.</span><span class=n>loginGraph</span><span class=p>(</span><span class=n>navController</span><span class=p>:</span> <span class=n>NavController</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>navigation</span><span class=p>(</span><span class=n>startDestination</span> <span class=p>=</span> <span class=s2>&#34;username&#34;</span><span class=p>,</span> <span class=n>route</span> <span class=p>=</span> <span class=s2>&#34;login&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>composable</span><span class=p>(</span><span class=s2>&#34;username&#34;</span><span class=p>)</span> <span class=p>{</span> <span class=o>..</span><span class=p>.</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>composable</span><span class=p>(</span><span class=s2>&#34;password&#34;</span><span class=p>)</span> <span class=p>{</span> <span class=o>..</span><span class=p>.</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>composable</span><span class=p>(</span><span class=s2>&#34;registration&#34;</span><span class=p>)</span> <span class=p>{</span> <span class=o>..</span><span class=p>.</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>By making the method an extension method on <a class=link href=https://developer.android.com/reference/kotlin/androidx/navigation/NavGraphBuilder target=_blank rel=noopener><code>NavGraphBuilder</code></a>, you can use it alongside the prebuilt <code>navigation</code>, <code>composable</code>, and <code>dialog</code> extension methods:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=n>NavHost</span><span class=p>(</span><span class=n>navController</span><span class=p>,</span> <span class=n>startDestination</span> <span class=p>=</span> <span class=s2>&#34;home&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl>    <span class=n>loginGraph</span><span class=p>(</span><span class=n>navController</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=ui-design>UI Design</h2><h3 id=layout>Layout</h3><ul><li><p>Column</p><p>Use <a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/foundation/layout/package-summary#Column%28androidx.compose.ui.Modifier,androidx.compose.foundation.layout.Arrangement.Vertical,androidx.compose.ui.Alignment.Horizontal,kotlin.Function1%29%28androidx.compose.ui.Modifier,androidx.compose.foundation.layout.Arrangement.Vertical,androidx.compose.ui.Alignment.Horizontal,kotlin.Function1%29 target=_blank rel=noopener><code>Column</code></a> to place items vertically on the screen.</p></li><li><p>Row</p><p>Similarly, use <a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/foundation/layout/package-summary#Row%28androidx.compose.ui.Modifier,androidx.compose.foundation.layout.Arrangement.Horizontal,androidx.compose.ui.Alignment.Vertical,kotlin.Function1%29%28androidx.compose.ui.Modifier,androidx.compose.foundation.layout.Arrangement.Horizontal,androidx.compose.ui.Alignment.Vertical,kotlin.Function1%29 target=_blank rel=noopener><code>Row</code></a> to place items horizontally on the screen. Both <code>Column</code> and <code>Row</code> support configuring the alignment of the elements they contain.</p></li><li><p>Box</p><p>Use <a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/foundation/layout/package-summary#Box%28androidx.compose.ui.Modifier,androidx.compose.ui.Alignment,kotlin.Boolean,kotlin.Function1%29 target=_blank rel=noopener><code>Box</code></a> to put elements on top of another. <code>Box</code> also supports configuring specific alignment of the elements it contains.</p></li></ul><p>Often these building blocks are all you need. You can write your own composable function to combine these layouts into a more elaborate layout that suits your app.</p><p><img src=https://developer.android.com/static/images/jetpack/compose/layout-column-row-box.svg loading=lazy alt="Compares three simple layout composables: column, row, and box"></p><p>To set children&rsquo;s position within a <code>Row</code>, set the <code>horizontalArrangement</code> and <code>verticalAlignment</code> arguments. For a <code>Column</code>, set the <code>verticalArrangement</code> and <code>horizontalAlignment</code> arguments.</p><p>In order to know the constraints coming from the parent and design the layout accordingly, you can use a <code>BoxWithConstraints</code>.</p><h4 id=content-slots>Content slots</h4><p>Material Components that support inner content (text labels, icons, etc.) tend to offer “slots” — generic lambdas that accept composable content — as well as public constants, like size and padding, to support laying out inner content to match Material specifications.</p><h2 id=testing-apis>Testing APIs</h2><p>There are three main ways to interact with elements:</p><ul><li><strong>Finders</strong> let you select one or multiple elements (or <em>nodes</em> in the Semantics tree) to make assertions or perform actions on them.</li><li><strong>Assertions</strong> are used to verify that the elements exist or have certain attributes.</li><li><strong>Actions</strong> inject simulated user events on the elements, such as clicks or other gestures.</li></ul><p>Some of these APIs accept a <a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/ui/test/SemanticsMatcher target=_blank rel=noopener><code>SemanticsMatcher</code></a> to refer to one or more <em>nodes</em> in the semantics tree.</p><h3 id=finders>Finders</h3><p>You can use <a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/ui/test/SemanticsNodeInteractionsProvider#onNode%28androidx.compose.ui.test.SemanticsMatcher,kotlin.Boolean%29 target=_blank rel=noopener><code>onNode</code></a> and <a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/ui/test/SemanticsNodeInteractionsProvider#onAllNodes%28androidx.compose.ui.test.SemanticsMatcher,kotlin.Boolean%29 target=_blank rel=noopener><code>onAllNodes</code></a> to select one or multiple nodes respectively, but you can also use convenience finders for the most common searches, such as <a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/ui/test/package-summary#%28androidx.compose.ui.test.SemanticsNodeInteractionsProvider%29.onNodeWithText%28kotlin.String,kotlin.Boolean,kotlin.Boolean,kotlin.Boolean%29 target=_blank rel=noopener><code>onNodeWithText</code></a> , <a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/ui/test/package-summary#%28androidx.compose.ui.test.SemanticsNodeInteractionsProvider%29.onNodeWithContentDescription%28kotlin.String,kotlin.Boolean,kotlin.Boolean,kotlin.Boolean%29 target=_blank rel=noopener><code>onNodeWithContentDescription</code></a>, etc.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=n>composeTestRule</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=n>onNode</span><span class=p>(</span><span class=n>hasText</span><span class=p>(</span><span class=s2>&#34;Button&#34;</span><span class=p>))</span> <span class=c1>// Equivalent to onNodeWithText(&#34;Button&#34;)
</span></span></span></code></pre></div><h3 id=assertions>Assertions</h3><p>Check assertions by calling <code>assert()</code> on the <code>SemanticsNodeInteraction</code> returned by a finder with one or multiple matchers:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=c1>// Single matcher:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>composeTestRule</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=n>onNode</span><span class=p>(</span><span class=n>matcher</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=n>assert</span><span class=p>(</span><span class=n>hasText</span><span class=p>(</span><span class=s2>&#34;Button&#34;</span><span class=p>))</span> <span class=c1>// hasText is a SemanticsMatcher
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Multiple matchers can use and / or
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>composeTestRule</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=n>onNode</span><span class=p>(</span><span class=n>matcher</span><span class=p>).</span><span class=n>assert</span><span class=p>(</span><span class=n>hasText</span><span class=p>(</span><span class=s2>&#34;Button&#34;</span><span class=p>)</span> <span class=n>or</span> <span class=n>hasText</span><span class=p>(</span><span class=s2>&#34;Button2&#34;</span><span class=p>))</span>
</span></span></code></pre></div><p>You can also use convenience functions for the most common assertions, such as <a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/ui/test/SemanticsNodeInteraction#assertExists%28kotlin.String%29 target=_blank rel=noopener><code>assertExists</code></a> , <a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/ui/test/SemanticsNodeInteraction#%28androidx.compose.ui.test.SemanticsNodeInteraction%29.assertIsDisplayed%28%29 target=_blank rel=noopener><code>assertIsDisplayed</code></a> , <a class=link href=https://developer.android.com/reference/kotlin/androidx/compose/ui/test/SemanticsNodeInteraction#%28androidx.compose.ui.test.SemanticsNodeInteraction%29.assertTextEquals%28kotlin.Array,kotlin.Boolean%29 target=_blank rel=noopener><code>assertTextEquals</code></a> , etc. You can browse the complete list in the <a class=link href=https://developer.android.com/jetpack/compose/testing-cheatsheet target=_blank rel=noopener>Compose Testing cheat sheet</a>.</p><h3 id=actions>Actions</h3><p>To inject an action on a node, call a <code>perform…()</code> function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=n>composeTestRule</span><span class=p>.</span><span class=n>onNode</span><span class=p>(</span><span class=o>..</span><span class=p>.).</span><span class=n>performClick</span><span class=p>()</span>
</span></span></code></pre></div><blockquote><p><strong>Note:</strong> You cannot chain actions inside a perform function. Instead, make multiple <code>perform()</code> calls.</p></blockquote></section><footer class=article-footer><section class=article-tags><a href=/tags/android/>Android</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>Last updated on Nov 18, 2021 00:00 UTC</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/mac.db_store-file/><div class=article-image><img src=/covers/cover20.jpg loading=lazy data-key data-hash=/covers/cover20.jpg></div><div class=article-details><h2 class=article-title>【Mac】.DB_Store file</h2></div></a></article><article><a href=/p/android%E9%87%91%E6%97%AD%E4%BA%AE-android%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/><div class=article-details><h2 class=article-title>【Android】金旭亮-Android应用开发</h2></div></a></article><article><a href=/p/openharmonybasics/><div class=article-details><h2 class=article-title>【OpenHarmony】Basics</h2></div></a></article><article><a href=/p/base64encoding/><div class=article-details><h2 class=article-title>【Base64】Encoding</h2></div></a></article><article><a href=/p/node.env/><div class=article-details><h2 class=article-title>【Node】.env</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 飞鸿踏雪泥</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>