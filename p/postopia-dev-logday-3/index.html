<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="遇到一个好像很有用的网站 Programming & DevOps news, tutorials & tools\n实现了一个BadRequestExceptionHandler\nSpring Security 有点复杂，没找到好的参考资料\n在claude 3.5的帮助下初步实现了基于简单jwt的Authentication\n测试filter的时候不小心调用了两次chain.doFilter导致返回的json数据是重复的两份 Duplicate Json in Spring Boot Response\nKnowledge Keycloak Keycloak is an open-source Identity and Access Management (IAM) solution developed by Red Hat. It provides a comprehensive set of features for managing authentication and authorization in modern applications.\nKey Features 1 Single Sign-On (SSO): Keycloak allows users to authenticate once and access multiple applications without re-entering credentials.\n"><title>【Postopia Dev Log】Day 3</title>
<link rel=canonical href=https://dyhes.github.io/p/postopia-dev-logday-3/><link rel=stylesheet href=/scss/style.min.6aa4d43a5cae1c51ef34b3f851ae7421f4b2f2d13827e2d975acbeb4f13c8710.css><meta property='og:title' content="【Postopia Dev Log】Day 3"><meta property='og:description' content="遇到一个好像很有用的网站 Programming & DevOps news, tutorials & tools\n实现了一个BadRequestExceptionHandler\nSpring Security 有点复杂，没找到好的参考资料\n在claude 3.5的帮助下初步实现了基于简单jwt的Authentication\n测试filter的时候不小心调用了两次chain.doFilter导致返回的json数据是重复的两份 Duplicate Json in Spring Boot Response\nKnowledge Keycloak Keycloak is an open-source Identity and Access Management (IAM) solution developed by Red Hat. It provides a comprehensive set of features for managing authentication and authorization in modern applications.\nKey Features 1 Single Sign-On (SSO): Keycloak allows users to authenticate once and access multiple applications without re-entering credentials.\n"><meta property='og:url' content='https://dyhes.github.io/p/postopia-dev-logday-3/'><meta property='og:site_name' content='飞鸿踏雪泥'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Postopia'><meta property='article:published_time' content='2024-07-09T00:00:00+00:00'><meta property='article:modified_time' content='2024-07-09T00:00:00+00:00'><meta property='og:image' content='https://dyhes.github.io/covers/cover14.png'><meta name=twitter:title content="【Postopia Dev Log】Day 3"><meta name=twitter:description content="遇到一个好像很有用的网站 Programming & DevOps news, tutorials & tools\n实现了一个BadRequestExceptionHandler\nSpring Security 有点复杂，没找到好的参考资料\n在claude 3.5的帮助下初步实现了基于简单jwt的Authentication\n测试filter的时候不小心调用了两次chain.doFilter导致返回的json数据是重复的两份 Duplicate Json in Spring Boot Response\nKnowledge Keycloak Keycloak is an open-source Identity and Access Management (IAM) solution developed by Red Hat. It provides a comprehensive set of features for managing authentication and authorization in modern applications.\nKey Features 1 Single Sign-On (SSO): Keycloak allows users to authenticate once and access multiple applications without re-entering credentials.\n"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://dyhes.github.io/covers/cover14.png'><link rel="shortcut icon" href=/github.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu17834253352308399148.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>飞鸿踏雪泥</a></h1><h2 class=site-description>没有记录，就没有发生</h2></div></header><ol class=menu-social><li><a href=https://github.com/dyhes target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=mailto:dyheslin@gmail.com target=_blank title=Gmail rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-gmail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16 20h3a1 1 0 001-1V5a1 1 0 00-1-1h-3v16z"/><path d="M5 20h3V4H5A1 1 0 004 5v14a1 1 0 001 1z"/><path d="M16 4l-4 4-4-4"/><path d="M4 6.5l8 7.5 8-7.5"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/categories/><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
<span>Categories</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#knowledge>Knowledge</a><ol><li><a href=#keycloak>Keycloak</a><ol><li><a href=#key-features>Key Features</a></li></ol></li><li><a href=#oauth2>Oauth2</a><ol><li><a href=#involved-actors>Involved Actors</a></li><li><a href=#authorization-grant-types><strong>Authorization Grant Types</strong></a></li></ol></li><li><a href=#transactions>Transactions</a><ol><li><a href=#isolation-level>Isolation level</a></li><li><a href=#1-read-uncommitted>1. READ UNCOMMITTED</a></li><li><a href=#2-read-committed>2. READ COMMITTED</a></li><li><a href=#3-repeatable-read>3. REPEATABLE READ</a></li><li><a href=#4-serializable>4. SERIALIZABLE</a></li></ol></li><li><a href=#transactional>@Transactional</a></li></ol></li><li><a href=#articles>Articles</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/postopia-dev-logday-3/><img src=/covers/cover14.png loading=lazy alt="Featured image of post 【Postopia Dev Log】Day 3"></a></div><div class=article-details><header class=article-category><a href=/categories/moon/ style=background-color:#b7ae8f;color:>月满西楼
</a><a href=/categories/snow/ style=background-color:#aa6a4c;color:>踏雪泥</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/postopia-dev-logday-3/>【Postopia Dev Log】Day 3</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jul 09, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>7 minute read</time></div></footer></div></header><section class=article-content><p>遇到一个好像很有用的网站 <a class=link href=https://dzone.com/ target=_blank rel=noopener>Programming & DevOps news, tutorials & tools</a></p><p>实现了一个BadRequestExceptionHandler</p><p>Spring Security 有点复杂，没找到好的参考资料</p><p>在claude 3.5的帮助下初步实现了基于简单jwt的Authentication</p><p>测试filter的时候不小心调用了两次chain.doFilter导致返回的json数据是重复的两份
<a class=link href=https://stackoverflow.com/questions/73892445/duplicate-json-in-spring-boot-response target=_blank rel=noopener>Duplicate Json in Spring Boot Response</a></p><h2 id=knowledge>Knowledge</h2><h3 id=keycloak>Keycloak</h3><p>Keycloak is an open-source Identity and Access Management (IAM) solution developed by Red Hat. It provides a comprehensive set of features for managing authentication and authorization in modern applications.</p><h4 id=key-features>Key Features</h4><p><strong>1</strong> <strong>Single Sign-On (SSO)</strong>: Keycloak allows users to authenticate once and access multiple applications without re-entering credentials.</p><p><strong>2</strong> <strong>Identity Brokering</strong>: It can integrate with external identity providers like Google, Facebook, or other SAML 2.0 or OpenID Connect providers.</p><p><strong>3</strong> <strong>User Federation</strong>: Keycloak can sync with existing LDAP or Active Directory servers.</p><p><strong>4</strong> <strong>Customizable Authentication</strong>: Supports various authentication mechanisms including password, OTP, and custom authenticators.</p><p><strong>5</strong> <strong>Fine-grained Authorization</strong>: Provides role-based access control (RBAC) and attribute-based access control (ABAC).</p><p><strong>6</strong> <strong>Admin Console</strong>: Offers a user-friendly interface for managing users, roles, clients, and realm settings.</p><p><strong>7</strong> <strong>Standard Protocols</strong>: Supports OAuth 2.0, OpenID Connect, and SAML 2.0.</p><p><strong>8</strong> <strong>Client Adapters</strong>: Provides adapters for easy integration with various application stacks.</p><p><strong>9</strong> <strong>Themes and Internationalization</strong>: Allows customization of login pages and supports multiple languages.</p><p><strong>10</strong> <strong>Social Login</strong>: Enables users to log in using their social media accounts.</p><h3 id=oauth2>Oauth2</h3><h4 id=involved-actors>Involved Actors</h4><p><strong>i) Resource Server</strong>: The server hosting user-owned resources that are protected by OAuth2. The resource server validates the access-token and serves the protected resources.</p><p><strong>ii) Resource Owner</strong>: Typically, the user of the application is the resource owner. The resource owner has the ability to grant or deny access to their own data hosted on the resource server.</p><p><strong>iii) Authorization Server</strong>: The authorization server gets consent from the resource owner and issues access tokens to clients for accessing protected resources hosted by a resource server.</p><p><strong>iv) Client</strong>: An application making API requests to perform actions on protected resources on behalf of the resource owner. Before it may do so, it must be authorized by the resource owner, and the authorization must be validated by resource server/authorization server. OAuth2 defines two client types, based on their ability to authenticate securely with the authorization server (i.e., ability to <strong>maintain the confidentiality</strong> of their client credentials):</p><p><strong>a)Confidential</strong>: Clients capable of maintaining the confidentiality of their credentials. Confidential clients are implemented on a secure server with restricted access to the client credentials (e.g., a web application running on a <strong>web server</strong>).</p><p><strong>b) Public</strong>: Clients incapable of maintaining the confidentiality of their credentials (e.g. an installed native application or a <strong>web browser-based application</strong>), and incapable of secure client authentication via any other means.</p><h4 id=authorization-grant-types><strong>Authorization Grant Types</strong></h4><p>To get the access token, the client obtains authorization from the resource owner. The authorization is expressed in the form of an <strong>authorization grant, which the client uses to request the access token.</strong> OAuth2 defines four standard grant types: authorization code, implicit, resource owner password credentials, and client credentials. It also provides an extension mechanism for defining additional grant types.</p><p><strong>i) Authorization Code Grant</strong>: this grant type is optimized for confidential clients (web application server). The authorization code flow <strong>does not expose the access token to the resource owner’s browser</strong>. Instead, authorization is accomplished using an intermediary “authorization code” that is passed through the browser. This code must be exchanged for an access token before calls can be made to protected APIs.</p><p><strong>ii) Implicit Grant</strong>: this grant type is suitable <strong>for public clients</strong>. The implicit grant flow <strong>does not accommodate refresh tokens</strong>. If the authorization server expires access tokens regularly, your application will need to run through the authorization flow whenever it needs access. In this flow, an access token is immediately returned to the client after a user grants the requested authorization. An <strong>intermediate authorization code is not required</strong> as it is in the authorization code grant.</p><p><strong>iii) Resource Owner Password Credentials</strong>: the resource owner password credentials grant type is suitable in cases where <strong>the resource owner has a trust relationship with the client</strong>, and the resource owner agrees to share hise/her credentials (username, password) with the client. Then the client can use resources from the owner&rsquo;s credentials to get the access token from the authorization server.</p><p><strong>iv) Client Credentials</strong>: this grant type is suitable when <strong>the client itself owns the data and does not need delegated access from a resource owner</strong>, or delegated access has already been granted to the application outside of a typical OAuth flow. In this flow, user consent is not involved. The client exchanges his client credentials to get an access token.</p><h3 id=transactions>Transactions</h3><p>A database transaction is a sequence of one or more database operations that are treated as a single unit of work. Transactions adhere to the ACID properties:</p><p><strong>1</strong> <strong>Atomicity</strong>: All operations in a transaction either complete successfully or fail altogether. There&rsquo;s no partial completion.</p><p><strong>2</strong> <strong>Consistency</strong>: A transaction brings the database from one valid state to another. All rules and constraints must be satisfied.</p><p><strong>3</strong> <strong>Isolation</strong>: Concurrent execution of transactions results in a state that would be obtained if transactions were executed sequentially.</p><p><strong>4</strong> <strong>Durability</strong>: Once a transaction has been committed, it will remain so, even in the event of power loss, crashes, or errors.</p><h4 id=isolation-level>Isolation level</h4><p>Isolation levels define how transaction integrity is visible to other users and systems. They provide a trade-off between consistency and performance.</p><h4 id=1-read-uncommitted>1. READ UNCOMMITTED</h4><ul><li>Lowest isolation level</li><li>One transaction may read not-yet-committed changes made by other transactions (&ldquo;dirty reads&rdquo;)</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>Transaction</span><span class=w> </span><span class=mi>1</span><span class=p>:</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=n>Account</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>100</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>account_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;A&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>Transaction</span><span class=w> </span><span class=mi>2</span><span class=p>:</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>Account</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>account_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;A&#39;</span><span class=p>;</span><span class=w> </span><span class=c1>-- May read the updated (uncommitted) balance
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>Transaction</span><span class=w> </span><span class=mi>1</span><span class=p>:</span><span class=w> </span><span class=k>ROLLBACK</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h4 id=2-read-committed>2. READ COMMITTED</h4><ul><li>A transaction only sees data committed before the transaction began</li><li>Prevents dirty reads, but &ldquo;non-repeatable reads&rdquo; can occur</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>Transaction</span><span class=w> </span><span class=mi>1</span><span class=p>:</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>Account</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>account_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;A&#39;</span><span class=p>;</span><span class=w> </span><span class=c1>-- Reads original balance
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>Transaction</span><span class=w> </span><span class=mi>2</span><span class=p>:</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=n>Account</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>100</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>account_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;A&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>Transaction</span><span class=w> </span><span class=mi>2</span><span class=p>:</span><span class=w> </span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>Transaction</span><span class=w> </span><span class=mi>1</span><span class=p>:</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>Account</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>account_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;A&#39;</span><span class=p>;</span><span class=w> </span><span class=c1>-- Reads new balance
</span></span></span></code></pre></div><h4 id=3-repeatable-read>3. REPEATABLE READ</h4><ul><li>Ensures that if a transaction reads a row, it will consistently see the same data for that row until the transaction completes</li><li>Prevents non-repeatable reads, but &ldquo;phantom reads&rdquo; can occur</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>Transaction</span><span class=w> </span><span class=mi>1</span><span class=p>:</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>Account</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1000</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>Transaction</span><span class=w> </span><span class=mi>2</span><span class=p>:</span><span class=w> </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>Account</span><span class=w> </span><span class=p>(</span><span class=n>account_id</span><span class=p>,</span><span class=w> </span><span class=n>balance</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;C&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>1500</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>Transaction</span><span class=w> </span><span class=mi>2</span><span class=p>:</span><span class=w> </span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>Transaction</span><span class=w> </span><span class=mi>1</span><span class=p>:</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>Account</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1000</span><span class=p>;</span><span class=w> </span><span class=c1>-- May see the new account (phantom read)
</span></span></span></code></pre></div><h4 id=4-serializable>4. SERIALIZABLE</h4><ul><li>Highest isolation level</li><li>Transactions are completely isolated from one another</li><li>Prevents dirty reads, non-repeatable reads, and phantom reads</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>Transaction</span><span class=w> </span><span class=mi>1</span><span class=p>:</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>Account</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1000</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>Transaction</span><span class=w> </span><span class=mi>2</span><span class=p>:</span><span class=w> </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>Account</span><span class=w> </span><span class=p>(</span><span class=n>account_id</span><span class=p>,</span><span class=w> </span><span class=n>balance</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;C&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>1500</span><span class=p>);</span><span class=w> </span><span class=c1>-- This will be blocked until Transaction 1 completes
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>Transaction</span><span class=w> </span><span class=mi>1</span><span class=p>:</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>Account</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1000</span><span class=p>;</span><span class=w> </span><span class=c1>-- Will not see any changes made by other transactions
</span></span></span></code></pre></div><h5 id=concurrency-issues>Concurrency Issues</h5><p><strong>1</strong> <strong>Dirty Read</strong>: Reading uncommitted data from another transaction.</p><p><strong>2</strong> <strong>Non-Repeatable Read</strong>: Getting different results when reading the same row twice in the same transaction.</p><p><strong>3</strong> <strong>Phantom Read</strong>: Getting different results when querying for a range of rows twice in the same transaction.</p><p>⠀Isolation Level Comparison</p><div class=table-wrapper><table><thead><tr><th style=text-align:center>Isolation Level</th><th style=text-align:center>Dirty Read</th><th style=text-align:center>Non-Repeatable Read</th><th style=text-align:center>Phantom Read</th></tr></thead><tbody><tr><td style=text-align:center>READ UNCOMMITTED</td><td style=text-align:center>Possible</td><td style=text-align:center>Possible</td><td style=text-align:center>Possible</td></tr><tr><td style=text-align:center>READ COMMITTED</td><td style=text-align:center>Prevented</td><td style=text-align:center>Possible</td><td style=text-align:center>Possible</td></tr><tr><td style=text-align:center>REPEATABLE READ</td><td style=text-align:center>Prevented</td><td style=text-align:center>Prevented</td><td style=text-align:center>Possible</td></tr><tr><td style=text-align:center>SERIALIZABLE</td><td style=text-align:center>Prevented</td><td style=text-align:center>Prevented</td><td style=text-align:center>Prevented</td></tr></tbody></table></div><p>Higher isolation levels provide more consistency but may reduce concurrency and impact performance.</p><p>Many applications use READ COMMITTED as a default, as it provides a good balance between consistency and performance.</p><h3 id=transactional>@Transactional</h3><p>When you annotate a method with @Transactional, Spring will start a transaction before the method executes and commit it after the method completes. If <strong>an exception is thrown</strong>, the transaction will be rolled back.</p><p>You can place @Transactional on a method or a class. If placed on a class, <strong>all public methods</strong> of the class become transactional.(@Transactional only works on <strong>public</strong> methods)
By default, transactions roll back on <strong>runtime exceptions</strong>.</p><p>You can customize</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Transactional</span><span class=p>(</span><span class=n>rollbackFor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=n>CustomException</span><span class=p>.</span><span class=na>class</span><span class=p>})</span><span class=w>
</span></span></span></code></pre></div><p>In Spring Boot applications, transaction management is automatically enabled. In other Spring applications, you need to explicitly enable it with @EnableTransactionManagement.
scenarios:</p><ul><li>Multiple Database Operations</li><li>Read Operations Requiring Consistency</li><li>…
<strong>Service Layer Methods</strong> It&rsquo;s often a good practice to put @Transactional on service-layer methods rather than repository methods or controllers.
Don&rsquo;t use @Transactional for <strong>single, simple database operations</strong> - the underlying repository methods are often already transactional.</li></ul><h2 id=articles>Articles</h2><p><a class=link href=https://www.baeldung.com/rest-api-spring-oauth2-angular target=_blank rel=noopener>Spring REST API + OAuth2 + Angular</a></p><p><a class=link href=https://www.baeldung.com/keycloak-embedded-in-spring-boot-app target=_blank rel=noopener>Keycloak Embedded in a Spring Boot Application</a></p><p><a class=link href=https://dzone.com/articles/secure-spring-rest-with-spring-security-and-oauth2 target=_blank rel=noopener>Secure Spring REST With Spring Security and OAuth2</a></p><p><a class=link href=https://dzone.com/articles/oauth-20-beginners-guide target=_blank rel=noopener>OAuth 2.0 Beginner&rsquo;s Guide</a></p><p><a class=link href=https://dzone.com/refcardz/oauth-patterns-and-anti-patterns target=_blank rel=noopener>OAuth Patterns and Anti-Patterns</a></p></section><footer class=article-footer><section class=article-tags><a href=/tags/postopia/>Postopia</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>Last updated on Jul 09, 2024 00:00 UTC</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/postopia-dev-logweek-6/><div class=article-details><h2 class=article-title>【Postopia Dev Log】Week 6</h2></div></a></article><article><a href=/p/postopia-dev-logweek-5/><div class=article-details><h2 class=article-title>【Postopia Dev Log】Week 5</h2></div></a></article><article><a href=/p/postopia-dev-logweek-4/><div class=article-details><h2 class=article-title>【Postopia Dev Log】Week 4</h2></div></a></article><article><a href=/p/postopia-dev-logweek-3/><div class=article-details><h2 class=article-title>【Postopia Dev Log】Week 3</h2></div></a></article><article><a href=/p/postopia-dev-logweek-2/><div class=article-details><h2 class=article-title>【Postopia Dev Log】Week 2</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 飞鸿踏雪泥</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>