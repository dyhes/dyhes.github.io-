<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='benefits:\nIt’s more efficient, as it doesn’t require an additional database query to fetch the Space object. It’s particularly useful when you’re dealing with large volumes of data or when the related entity (Space in this case) has a lot of fields that you don’t need. However, there are a few things to keep in mind:\nMake sure the Space with the given ID actually exists in the database. If it doesn’t, you’ll get a EntityNotFoundException when the entity is first accessed. This approach only works for setting the relationship. If you need to access properties of the Space object beyond its ID, you’ll need to fetch the full object from the database. Be aware of any cascade operations or other JPA settings that might affect this behavior. entityManager.getReference @Autowired private EntityManager entityManager; // Post newPost = new Post(); newPost.setTitle("New Post Title"); newPost.setContent("Post content..."); Space spaceReference = entityManager.getReference(Space.class, knownSpaceId); newPost.setSpace(spaceReference); postRepository.save(newPost); Pros Type-safe: It ensures the referenced entity type is correct. JPA-compliant: It’s the standard JPA way of creating entity references. Lazy-loading: The reference is a proxy that can lazy-load the full entity when needed. Consistency: It maintains consistency with how JPA handles entity relationships. Cons Dependency: It requires injecting EntityManager, which might not always be desirable or available. Complexity: It adds a bit more complexity to your code. Simple Reference Object Post newPost = new Post(); newPost.setTitle("New Post Title"); newPost.setContent("Post content..."); Space spaceReference = new Space(); spaceReference.setId(knownSpaceId); newPost.setSpace(spaceReference); postRepository.save(newPost); Pros 1 Simplicity: It’s straightforward and easy to understand. 2 No additional dependencies: It doesn’t require EntityManager. 3 Lightweight: It’s a very lightweight operation. Cons Not type-safe: You need to ensure you’re using the correct entity class and ID type. Not a true JPA proxy: It won’t lazy-load additional entity details if accessed. Potential for inconsistency: If not used carefully, it could lead to inconsistencies with how JPA manages entities. Guidelines If you’re working within a JPA/Hibernate context and have easy access to EntityManager, using EntityManager.getReference() is generally the preferred method. It’s more aligned with JPA standards and provides better integration with JPA’s entity management. If you’re working in a simpler context, perhaps in a service layer where you don’t want to introduce a dependency on EntityManager, using a simple reference object can be appropriate. This is especially true if you’re sure you won’t need to access any properties of the referenced entity beyond its ID. If you’re working on a large-scale application where performance is critical, and you’re dealing with a high volume of entities, the simple reference object might be slightly more efficient as it doesn’t create a proxy object. If you’re using Spring Data JPA repositories, you can also use the getOne() method (deprecated in newer versions) or getReferenceById() method, which internally use EntityManager.getReference(). This approach combines the benefits of using EntityManager.getReference() with the convenience of working with repositories. Space spaceReference = spaceRepository.getReferenceById(knownSpaceId); newPost.setSpace(spaceReference); This approach combines the benefits of using EntityManager.getReference() with the convenience of working with repositories. In general, if you’re working within a JPA environment, using EntityManager.getReference() or the repository’s getReferenceById() method is often the most robust and recommended approach. However, in simpler scenarios or where JPA is not heavily used, a simple reference object can be perfectly adequate. Lazy-loaded Reference When using a lazy-loaded reference (like those created by EntityManager.getReference() or JpaRepository.getReferenceById()), the full entity will be lazy-loaded in the following scenarios:\n'><title>【Spring Data JPA】Reference Object</title>
<link rel=canonical href=https://dyhes.github.io/p/spring-data-jpareference-object/><link rel=stylesheet href=/scss/style.min.6aa4d43a5cae1c51ef34b3f851ae7421f4b2f2d13827e2d975acbeb4f13c8710.css><meta property='og:title' content="【Spring Data JPA】Reference Object"><meta property='og:description' content='benefits:\nIt’s more efficient, as it doesn’t require an additional database query to fetch the Space object. It’s particularly useful when you’re dealing with large volumes of data or when the related entity (Space in this case) has a lot of fields that you don’t need. However, there are a few things to keep in mind:\nMake sure the Space with the given ID actually exists in the database. If it doesn’t, you’ll get a EntityNotFoundException when the entity is first accessed. This approach only works for setting the relationship. If you need to access properties of the Space object beyond its ID, you’ll need to fetch the full object from the database. Be aware of any cascade operations or other JPA settings that might affect this behavior. entityManager.getReference @Autowired private EntityManager entityManager; // Post newPost = new Post(); newPost.setTitle("New Post Title"); newPost.setContent("Post content..."); Space spaceReference = entityManager.getReference(Space.class, knownSpaceId); newPost.setSpace(spaceReference); postRepository.save(newPost); Pros Type-safe: It ensures the referenced entity type is correct. JPA-compliant: It’s the standard JPA way of creating entity references. Lazy-loading: The reference is a proxy that can lazy-load the full entity when needed. Consistency: It maintains consistency with how JPA handles entity relationships. Cons Dependency: It requires injecting EntityManager, which might not always be desirable or available. Complexity: It adds a bit more complexity to your code. Simple Reference Object Post newPost = new Post(); newPost.setTitle("New Post Title"); newPost.setContent("Post content..."); Space spaceReference = new Space(); spaceReference.setId(knownSpaceId); newPost.setSpace(spaceReference); postRepository.save(newPost); Pros 1 Simplicity: It’s straightforward and easy to understand. 2 No additional dependencies: It doesn’t require EntityManager. 3 Lightweight: It’s a very lightweight operation. Cons Not type-safe: You need to ensure you’re using the correct entity class and ID type. Not a true JPA proxy: It won’t lazy-load additional entity details if accessed. Potential for inconsistency: If not used carefully, it could lead to inconsistencies with how JPA manages entities. Guidelines If you’re working within a JPA/Hibernate context and have easy access to EntityManager, using EntityManager.getReference() is generally the preferred method. It’s more aligned with JPA standards and provides better integration with JPA’s entity management. If you’re working in a simpler context, perhaps in a service layer where you don’t want to introduce a dependency on EntityManager, using a simple reference object can be appropriate. This is especially true if you’re sure you won’t need to access any properties of the referenced entity beyond its ID. If you’re working on a large-scale application where performance is critical, and you’re dealing with a high volume of entities, the simple reference object might be slightly more efficient as it doesn’t create a proxy object. If you’re using Spring Data JPA repositories, you can also use the getOne() method (deprecated in newer versions) or getReferenceById() method, which internally use EntityManager.getReference(). This approach combines the benefits of using EntityManager.getReference() with the convenience of working with repositories. Space spaceReference = spaceRepository.getReferenceById(knownSpaceId); newPost.setSpace(spaceReference); This approach combines the benefits of using EntityManager.getReference() with the convenience of working with repositories. In general, if you’re working within a JPA environment, using EntityManager.getReference() or the repository’s getReferenceById() method is often the most robust and recommended approach. However, in simpler scenarios or where JPA is not heavily used, a simple reference object can be perfectly adequate. Lazy-loaded Reference When using a lazy-loaded reference (like those created by EntityManager.getReference() or JpaRepository.getReferenceById()), the full entity will be lazy-loaded in the following scenarios:\n'><meta property='og:url' content='https://dyhes.github.io/p/spring-data-jpareference-object/'><meta property='og:site_name' content='飞鸿踏雪泥'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Spring Data JPA'><meta property='article:published_time' content='2024-07-18T00:00:00+00:00'><meta property='article:modified_time' content='2024-07-18T00:00:00+00:00'><meta name=twitter:title content="【Spring Data JPA】Reference Object"><meta name=twitter:description content='benefits:\nIt’s more efficient, as it doesn’t require an additional database query to fetch the Space object. It’s particularly useful when you’re dealing with large volumes of data or when the related entity (Space in this case) has a lot of fields that you don’t need. However, there are a few things to keep in mind:\nMake sure the Space with the given ID actually exists in the database. If it doesn’t, you’ll get a EntityNotFoundException when the entity is first accessed. This approach only works for setting the relationship. If you need to access properties of the Space object beyond its ID, you’ll need to fetch the full object from the database. Be aware of any cascade operations or other JPA settings that might affect this behavior. entityManager.getReference @Autowired private EntityManager entityManager; // Post newPost = new Post(); newPost.setTitle("New Post Title"); newPost.setContent("Post content..."); Space spaceReference = entityManager.getReference(Space.class, knownSpaceId); newPost.setSpace(spaceReference); postRepository.save(newPost); Pros Type-safe: It ensures the referenced entity type is correct. JPA-compliant: It’s the standard JPA way of creating entity references. Lazy-loading: The reference is a proxy that can lazy-load the full entity when needed. Consistency: It maintains consistency with how JPA handles entity relationships. Cons Dependency: It requires injecting EntityManager, which might not always be desirable or available. Complexity: It adds a bit more complexity to your code. Simple Reference Object Post newPost = new Post(); newPost.setTitle("New Post Title"); newPost.setContent("Post content..."); Space spaceReference = new Space(); spaceReference.setId(knownSpaceId); newPost.setSpace(spaceReference); postRepository.save(newPost); Pros 1 Simplicity: It’s straightforward and easy to understand. 2 No additional dependencies: It doesn’t require EntityManager. 3 Lightweight: It’s a very lightweight operation. Cons Not type-safe: You need to ensure you’re using the correct entity class and ID type. Not a true JPA proxy: It won’t lazy-load additional entity details if accessed. Potential for inconsistency: If not used carefully, it could lead to inconsistencies with how JPA manages entities. Guidelines If you’re working within a JPA/Hibernate context and have easy access to EntityManager, using EntityManager.getReference() is generally the preferred method. It’s more aligned with JPA standards and provides better integration with JPA’s entity management. If you’re working in a simpler context, perhaps in a service layer where you don’t want to introduce a dependency on EntityManager, using a simple reference object can be appropriate. This is especially true if you’re sure you won’t need to access any properties of the referenced entity beyond its ID. If you’re working on a large-scale application where performance is critical, and you’re dealing with a high volume of entities, the simple reference object might be slightly more efficient as it doesn’t create a proxy object. If you’re using Spring Data JPA repositories, you can also use the getOne() method (deprecated in newer versions) or getReferenceById() method, which internally use EntityManager.getReference(). This approach combines the benefits of using EntityManager.getReference() with the convenience of working with repositories. Space spaceReference = spaceRepository.getReferenceById(knownSpaceId); newPost.setSpace(spaceReference); This approach combines the benefits of using EntityManager.getReference() with the convenience of working with repositories. In general, if you’re working within a JPA environment, using EntityManager.getReference() or the repository’s getReferenceById() method is often the most robust and recommended approach. However, in simpler scenarios or where JPA is not heavily used, a simple reference object can be perfectly adequate. Lazy-loaded Reference When using a lazy-loaded reference (like those created by EntityManager.getReference() or JpaRepository.getReferenceById()), the full entity will be lazy-loaded in the following scenarios:\n'><link rel="shortcut icon" href=/github.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu17834253352308399148.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>飞鸿踏雪泥</a></h1><h2 class=site-description>没有记录，就没有发生</h2></div></header><ol class=menu-social><li><a href=https://github.com/dyhes target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=mailto:dyheslin@gmail.com target=_blank title=Gmail rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-gmail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16 20h3a1 1 0 001-1V5a1 1 0 00-1-1h-3v16z"/><path d="M5 20h3V4H5A1 1 0 004 5v14a1 1 0 001 1z"/><path d="M16 4l-4 4-4-4"/><path d="M4 6.5l8 7.5 8-7.5"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/categories/><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
<span>Categories</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#entitymanagergetreference> <code>entityManager.getReference</code></a><ol><li><a href=#pros>Pros</a></li><li><a href=#cons>Cons</a></li></ol></li><li><a href=#simple-reference-object>Simple Reference Object</a><ol><li><a href=#pros-1>Pros</a></li><li><a href=#cons-1>Cons</a></li></ol></li><li><a href=#guidelines>Guidelines</a></li><li><a href=#lazy-loaded-reference>Lazy-loaded Reference</a><ol><li><a href=#accessing-non-id-properties>Accessing Non-ID Properties</a></li><li><a href=#invoking-methods>Invoking Methods</a></li><li><a href=#relationship-navigation>Relationship Navigation</a></li><li><a href=#explicit-initialization>Explicit Initialization</a></li><li><a href=#tostring-equals-or-hashcode>toString(), equals(), or hashCode()</a></li><li><a href=#serialization>Serialization</a></li><li><a href=#important-points>Important points</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/nutrition/ style=background-color:#93b5cf;color:>积雪粮
</a><a href=/categories/willow/ style=background-color:#dc9123;color:>满城风絮</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/spring-data-jpareference-object/>【Spring Data JPA】Reference Object</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jul 18, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>4 minute read</time></div></footer></div></header><section class=article-content><p>benefits:</p><ul><li>It’s more <strong>efficient</strong>, as it doesn’t require an additional database query to fetch the Space object.</li><li>It’s particularly useful when you’re dealing with <strong>large volumes of data</strong> or when the related entity (Space in this case) has <strong>a lot of fields</strong> that you don’t need.</li></ul><p>However, there are a few things to keep in mind:</p><ul><li>Make sure the Space with the given ID <strong>actually exists</strong> in the database. If it doesn’t, you’ll get a EntityNotFoundException when the entity is first accessed.</li><li>This approach only works for <strong>setting the relationship</strong>. If you need to access properties of the Space object beyond its ID, you’ll need to fetch the full object from the database.</li><li>Be aware of any <strong>cascade operations</strong> or other JPA settings that might affect this behavior.</li></ul><h2 id=entitymanagergetreference> <code>entityManager.getReference</code></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=n>EntityManager</span><span class=w> </span><span class=n>entityManager</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Post</span><span class=w> </span><span class=n>newPost</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Post</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>newPost</span><span class=p>.</span><span class=na>setTitle</span><span class=p>(</span><span class=s>&#34;New Post Title&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>newPost</span><span class=p>.</span><span class=na>setContent</span><span class=p>(</span><span class=s>&#34;Post content...&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Space</span><span class=w> </span><span class=n>spaceReference</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entityManager</span><span class=p>.</span><span class=na>getReference</span><span class=p>(</span><span class=n>Space</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>knownSpaceId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>newPost</span><span class=p>.</span><span class=na>setSpace</span><span class=p>(</span><span class=n>spaceReference</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>postRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>newPost</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h3 id=pros>Pros</h3><ul><li><strong>Type-safe</strong>: It ensures the referenced entity type is correct.</li><li><strong>JPA-compliant</strong>: It’s the standard JPA way of creating entity references.</li><li><strong>Lazy-loading</strong>: The reference is a proxy that can lazy-load the full entity when needed.</li><li><strong>Consistency</strong>: It maintains consistency with how JPA handles entity relationships.</li></ul><h3 id=cons>Cons</h3><ul><li><strong>Dependency</strong>: It requires injecting EntityManager, which might not always be desirable or available.</li><li><strong>Complexity</strong>: It adds a bit more complexity to your code.</li></ul><h2 id=simple-reference-object>Simple Reference Object</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Post</span><span class=w> </span><span class=n>newPost</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Post</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>newPost</span><span class=p>.</span><span class=na>setTitle</span><span class=p>(</span><span class=s>&#34;New Post Title&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>newPost</span><span class=p>.</span><span class=na>setContent</span><span class=p>(</span><span class=s>&#34;Post content...&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Space</span><span class=w> </span><span class=n>spaceReference</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Space</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>spaceReference</span><span class=p>.</span><span class=na>setId</span><span class=p>(</span><span class=n>knownSpaceId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>newPost</span><span class=p>.</span><span class=na>setSpace</span><span class=p>(</span><span class=n>spaceReference</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>postRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>newPost</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h3 id=pros-1>Pros</h3><ul><li>1 <strong>Simplicity</strong>: It’s straightforward and easy to understand.</li><li>2 <strong>No additional dependencies</strong>: It doesn’t require EntityManager.</li><li>3 <strong>Lightweight</strong>: It’s a very lightweight operation.</li></ul><h3 id=cons-1>Cons</h3><ul><li><strong>Not type-safe</strong>: You need to ensure you’re using the correct entity class and ID type.</li><li><strong>Not a true JPA proxy</strong>: It won’t lazy-load additional entity details if accessed.</li><li><strong>Potential for inconsistency</strong>: If not used carefully, it could lead to inconsistencies with how JPA manages entities.</li></ul><h2 id=guidelines>Guidelines</h2><ul><li>If you’re working within a JPA/Hibernate context and have easy access to EntityManager, using EntityManager.getReference() is <strong>generally the preferred</strong> method. It’s more aligned with JPA standards and provides better integration with JPA’s entity management.</li><li>If you’re working in a simpler context, perhaps in a <strong>service layer</strong> where you don’t want to introduce a dependency on EntityManager, using a simple reference object can be appropriate. This is especially true if you’re sure you won’t need to access any properties of the referenced entity beyond its ID.</li><li>If you’re working on a large-scale application where <strong>performance is critical</strong>, and you’re dealing with a high volume of entities, the simple reference object might be slightly more efficient as it doesn’t create a proxy object.</li><li>If you’re using Spring Data JPA repositories, you can also use the <strong>getOne() method (deprecated in newer versions) or getReferenceById() method</strong>, which internally use EntityManager.getReference().</li><li>This approach combines the benefits of using EntityManager.getReference() with the convenience of working with repositories.<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Space</span><span class=w> </span><span class=n>spaceReference</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>spaceRepository</span><span class=p>.</span><span class=na>getReferenceById</span><span class=p>(</span><span class=n>knownSpaceId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>newPost</span><span class=p>.</span><span class=na>setSpace</span><span class=p>(</span><span class=n>spaceReference</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div>This approach combines the benefits of using EntityManager.getReference() with the convenience of working with repositories.</li><li>In general, if you’re working within a JPA environment, using EntityManager.getReference() or the repository’s getReferenceById() method is often the most <strong>robust and recommended</strong> approach. However, in simpler scenarios or where JPA is not heavily used, a simple reference object can be perfectly adequate.</li></ul><h2 id=lazy-loaded-reference>Lazy-loaded Reference</h2><p>When using a lazy-loaded reference (like those created by EntityManager.getReference() or JpaRepository.getReferenceById()), the full entity will be lazy-loaded in the following scenarios:</p><h3 id=accessing-non-id-properties>Accessing Non-ID Properties</h3><p>When you try to access any property of the entity other than its ID, the full entity will be loaded from the database.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Space</span><span class=w> </span><span class=n>spaceReference</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entityManager</span><span class=p>.</span><span class=na>getReference</span><span class=p>(</span><span class=n>Space</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>spaceId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>spaceName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>spaceReference</span><span class=p>.</span><span class=na>getName</span><span class=p>();</span><span class=w> </span><span class=c1>// This will trigger lazy loading</span><span class=w>
</span></span></span></code></pre></div><h3 id=invoking-methods>Invoking Methods</h3><p>If you call any method on the proxy object that requires data from the entity, it will trigger lazy loading.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Space</span><span class=w> </span><span class=n>spaceReference</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entityManager</span><span class=p>.</span><span class=na>getReference</span><span class=p>(</span><span class=n>Space</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>spaceId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>spaceReference</span><span class=p>.</span><span class=na>someMethod</span><span class=p>();</span><span class=w> </span><span class=c1>// This will trigger lazy loading if the method uses any non-ID fields</span><span class=w>
</span></span></span></code></pre></div><h3 id=relationship-navigation>Relationship Navigation</h3><p>If you navigate from the proxy to related entities (that are not already loaded), it will trigger lazy loading.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Space</span><span class=w> </span><span class=n>spaceReference</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entityManager</span><span class=p>.</span><span class=na>getReference</span><span class=p>(</span><span class=n>Space</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>spaceId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>Post</span><span class=o>&gt;</span><span class=w> </span><span class=n>posts</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>spaceReference</span><span class=p>.</span><span class=na>getPosts</span><span class=p>();</span><span class=w> </span><span class=c1>// This will trigger lazy loading</span><span class=w>
</span></span></span></code></pre></div><h3 id=explicit-initialization>Explicit Initialization</h3><p>If you explicitly initialize the proxy using Hibernate.initialize() or similar methods.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Space</span><span class=w> </span><span class=n>spaceReference</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entityManager</span><span class=p>.</span><span class=na>getReference</span><span class=p>(</span><span class=n>Space</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>spaceId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Hibernate</span><span class=p>.</span><span class=na>initialize</span><span class=p>(</span><span class=n>spaceReference</span><span class=p>);</span><span class=w> </span><span class=c1>// This will trigger lazy loading</span><span class=w>
</span></span></span></code></pre></div><h3 id=tostring-equals-or-hashcode>toString(), equals(), or hashCode()</h3><p>If these methods are overridden in your entity class to use non-ID fields, calling them will trigger lazy loading.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Space</span><span class=w> </span><span class=n>spaceReference</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entityManager</span><span class=p>.</span><span class=na>getReference</span><span class=p>(</span><span class=n>Space</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>spaceId</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>spaceReference</span><span class=p>);</span><span class=w> </span><span class=c1>// This might trigger lazy loading if toString() is overridden</span><span class=w>
</span></span></span></code></pre></div><h3 id=serialization>Serialization</h3><p>If you try to serialize the proxy object, it will typically trigger lazy loading to ensure all data is available for serialization.</p><h3 id=important-points>Important points</h3><ul><li>Lazy loading will only work within an <strong>active persistence context</strong> (typically, within a transaction).</li><li>If you try to access a lazy-loaded property outside of a persistence context, you might get a <strong>LazyInitializationException</strong>.</li><li>The ID of the entity is <strong>always available</strong> without triggering a load, as it’s used to create the proxy.</li><li>If the referenced entity doesn’t exist in the database, accessing it will throw an <strong>EntityNotFoundException</strong> when lazy loading is triggered.</li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/spring-data-jpa/>Spring Data JPA</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>Last updated on Jul 18, 2024 00:00 UTC</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/spring-data-jparecursive-model-query/><div class=article-details><h2 class=article-title>【Spring Data JPA】Recursive Model Query</h2></div></a></article><article><a href=/p/spring-data-jpadatabase-exception/><div class=article-details><h2 class=article-title>【Spring Data JPA】Database Exception</h2></div></a></article><article class=has-image><a href=/p/javaenum/><div class=article-image><img src=/covers/cover19.png loading=lazy data-key data-hash=/covers/cover19.png></div><div class=article-details><h2 class=article-title>【Java】Enum</h2></div></a></article><article class=has-image><a href=/p/spring-data-jpa@query-and-jpql/><div class=article-image><img src=/covers/cover19.png loading=lazy data-key data-hash=/covers/cover19.png></div><div class=article-details><h2 class=article-title>【Spring Data JPA】@Query and JPQL</h2></div></a></article><article><a href=/p/spring-data-jpapageable-and-sort/><div class=article-details><h2 class=article-title>【Spring Data JPA】Pageable and Sort</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 飞鸿踏雪泥</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>