<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="按部就班进行开发，发现自己可能会在一些自己认知范围内的性能优化点特别在意，又会觉得优化需要对语言底层有深刻的认知，接近于一个无穷无尽的过程，然后对自己的语言功底感到焦虑。\nDelete method Yes, derived delete methods in Spring Data JPA repositories can return a boolean value. When you define a derived delete method to return a boolean, it will indicate whether any records were actually deleted.\n@EntityListeners(AuditingEntityListener.class) 除\n@EnableJpaAuditting @CreateDate 还需要加上： @EntityListeners(AuditingEntityListener.class) Data Transfer Objects\u00a0query only the needed fields in Spring Data JPA for several reasons:\nPerformance optimization: By querying only the required fields, you reduce the amount of data transferred between the database and your application, which can improve performance, especially for large datasets. Reduced network traffic: Transferring only the necessary data minimizes network usage, which is particularly beneficial in distributed systems or when dealing with remote clients. Separation of concerns: DTOs help separate the data representation used in your application’s business logic from the underlying database entities, providing a clear boundary between layers. Flexibility and maintainability: DTOs allow you to shape the data according to specific use cases, making it easier to evolve your API without affecting the underlying data model. Security: By using DTOs, you can control which data is exposed to the client, reducing the risk of accidentally exposing sensitive information. Avoid lazy loading issues: When working with JPA entities, lazy-loaded associations can cause performance problems or errors if accessed outside of a transaction. DTOs help avoid these issues by containing only the required data. Var keyword In Java, the\u00a0var\u00a0keyword was introduced in Java 10 as part of the Local Variable Type Inference feature. It allows you to declare local variables without explicitly specifying their type. The compiler infers the type based on the initialization expression. Here are some key points about\u00a0var\u00a0in Java:\n"><title>【Postopia Dev Log】Week 2</title>
<link rel=canonical href=https://dyhes.github.io/p/postopia-dev-logweek-2/><link rel=stylesheet href=/scss/style.min.6aa4d43a5cae1c51ef34b3f851ae7421f4b2f2d13827e2d975acbeb4f13c8710.css><meta property='og:title' content="【Postopia Dev Log】Week 2"><meta property='og:description' content="按部就班进行开发，发现自己可能会在一些自己认知范围内的性能优化点特别在意，又会觉得优化需要对语言底层有深刻的认知，接近于一个无穷无尽的过程，然后对自己的语言功底感到焦虑。\nDelete method Yes, derived delete methods in Spring Data JPA repositories can return a boolean value. When you define a derived delete method to return a boolean, it will indicate whether any records were actually deleted.\n@EntityListeners(AuditingEntityListener.class) 除\n@EnableJpaAuditting @CreateDate 还需要加上： @EntityListeners(AuditingEntityListener.class) Data Transfer Objects\u00a0query only the needed fields in Spring Data JPA for several reasons:\nPerformance optimization: By querying only the required fields, you reduce the amount of data transferred between the database and your application, which can improve performance, especially for large datasets. Reduced network traffic: Transferring only the necessary data minimizes network usage, which is particularly beneficial in distributed systems or when dealing with remote clients. Separation of concerns: DTOs help separate the data representation used in your application’s business logic from the underlying database entities, providing a clear boundary between layers. Flexibility and maintainability: DTOs allow you to shape the data according to specific use cases, making it easier to evolve your API without affecting the underlying data model. Security: By using DTOs, you can control which data is exposed to the client, reducing the risk of accidentally exposing sensitive information. Avoid lazy loading issues: When working with JPA entities, lazy-loaded associations can cause performance problems or errors if accessed outside of a transaction. DTOs help avoid these issues by containing only the required data. Var keyword In Java, the\u00a0var\u00a0keyword was introduced in Java 10 as part of the Local Variable Type Inference feature. It allows you to declare local variables without explicitly specifying their type. The compiler infers the type based on the initialization expression. Here are some key points about\u00a0var\u00a0in Java:\n"><meta property='og:url' content='https://dyhes.github.io/p/postopia-dev-logweek-2/'><meta property='og:site_name' content='飞鸿踏雪泥'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Postopia'><meta property='article:published_time' content='2024-07-19T00:00:00+00:00'><meta property='article:modified_time' content='2024-07-19T00:00:00+00:00'><meta name=twitter:title content="【Postopia Dev Log】Week 2"><meta name=twitter:description content="按部就班进行开发，发现自己可能会在一些自己认知范围内的性能优化点特别在意，又会觉得优化需要对语言底层有深刻的认知，接近于一个无穷无尽的过程，然后对自己的语言功底感到焦虑。\nDelete method Yes, derived delete methods in Spring Data JPA repositories can return a boolean value. When you define a derived delete method to return a boolean, it will indicate whether any records were actually deleted.\n@EntityListeners(AuditingEntityListener.class) 除\n@EnableJpaAuditting @CreateDate 还需要加上： @EntityListeners(AuditingEntityListener.class) Data Transfer Objects\u00a0query only the needed fields in Spring Data JPA for several reasons:\nPerformance optimization: By querying only the required fields, you reduce the amount of data transferred between the database and your application, which can improve performance, especially for large datasets. Reduced network traffic: Transferring only the necessary data minimizes network usage, which is particularly beneficial in distributed systems or when dealing with remote clients. Separation of concerns: DTOs help separate the data representation used in your application’s business logic from the underlying database entities, providing a clear boundary between layers. Flexibility and maintainability: DTOs allow you to shape the data according to specific use cases, making it easier to evolve your API without affecting the underlying data model. Security: By using DTOs, you can control which data is exposed to the client, reducing the risk of accidentally exposing sensitive information. Avoid lazy loading issues: When working with JPA entities, lazy-loaded associations can cause performance problems or errors if accessed outside of a transaction. DTOs help avoid these issues by containing only the required data. Var keyword In Java, the\u00a0var\u00a0keyword was introduced in Java 10 as part of the Local Variable Type Inference feature. It allows you to declare local variables without explicitly specifying their type. The compiler infers the type based on the initialization expression. Here are some key points about\u00a0var\u00a0in Java:\n"><link rel="shortcut icon" href=/github.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu17834253352308399148.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>飞鸿踏雪泥</a></h1><h2 class=site-description>没有记录，就没有发生</h2></div></header><ol class=menu-social><li><a href=https://github.com/dyhes target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=mailto:dyheslin@gmail.com target=_blank title=Gmail rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-gmail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16 20h3a1 1 0 001-1V5a1 1 0 00-1-1h-3v16z"/><path d="M5 20h3V4H5A1 1 0 004 5v14a1 1 0 001 1z"/><path d="M16 4l-4 4-4-4"/><path d="M4 6.5l8 7.5 8-7.5"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/categories/><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
<span>Categories</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#delete-method>Delete method</a></li><li><a href=#entitylistenersauditingentitylistenerclass>@EntityListeners(AuditingEntityListener.class)</a></li><li><a href=#data-transfer-objects>Data Transfer Objects </a><ol><li><a href=#performance-optimization>Performance optimization:</a></li><li><a href=#reduced-network-traffic>Reduced network traffic:</a></li><li><a href=#separation-of-concerns>Separation of concerns:</a></li><li><a href=#flexibility-and-maintainability>Flexibility and maintainability:</a></li><li><a href=#security>Security:</a></li><li><a href=#avoid-lazy-loading-issues>Avoid lazy loading issues:</a></li></ol></li><li><a href=#var-keyword><code>Var</code> keyword</a></li><li><a href=#other-local-variable-type-inference-feature>Other Local Variable Type Inference feature</a></li><li><a href=#repository-layer-referencing>Repository Layer Referencing</a><ol><li><a href=#one-repository-and-multiple-services>One @Repository and Multiple @Services</a><ol><li><a href=#pros>Pros</a></li><li><a href=#cons>Cons</a></li></ol></li><li><a href=#multiple-repositories>Multiple @Repositories</a><ol><li><a href=#pros-1>Pros</a></li><li><a href=#cons-1>⠀Cons</a></li></ol></li><li><a href=#considerations>Considerations</a></li></ol></li><li><a href=#long-or-long> Long or long</a></li><li><a href=#check-or-not>Check Or Not</a><ol><li><a href=#checking-existence-before-update>Checking existence before update</a><ol><li><a href=#pros-2>Pros</a></li><li><a href=#cons-2>⠀Cons</a></li></ol></li><li><a href=#handling-the-update-exception-directly>Handling the update exception directly</a><ol><li><a href=#pros-3>Pros</a></li><li><a href=#cons-3>⠀Cons</a></li></ol></li><li><a href=#recommendation>Recommendation</a></li></ol></li><li><a href=#transactional-on-repository-layer>Transactional on Repository Layer</a></li><li><a href=#derived-query-method>Derived Query Method</a></li><li><a href=#malicious-use>Malicious Use</a></li><li><a href=#authenticatedprincipal-usage>@AuthenticatedPrincipal Usage</a><ol><li><a href=#passing-the-principal-from-the-controller>Passing the principal from the controller</a><ol><li><a href=#pros-4>Pros</a></li><li><a href=#cons-4>Cons</a></li></ol></li><li><a href=#usingauthenticatedprincipalin-the-service-layer>Using@AuthenticatedPrincipal in the service layer</a><ol><li><a href=#pros-5>Pros</a></li><li><a href=#cons-5>Cons</a></li></ol></li><li><a href=#recommendation-1>Recommendation</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/moon/ style=background-color:#b7ae8f;color:>月满西楼
</a><a href=/categories/snow/ style=background-color:#aa6a4c;color:>踏雪泥</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/postopia-dev-logweek-2/>【Postopia Dev Log】Week 2</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jul 19, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>9 minute read</time></div></footer></div></header><section class=article-content><p>按部就班进行开发，发现自己可能会在一些自己认知范围内的性能优化点特别在意，又会觉得优化需要对语言底层有深刻的认知，接近于一个无穷无尽的过程，然后对自己的语言功底感到焦虑。</p><h2 id=delete-method>Delete method</h2><p>Yes, derived delete methods in Spring Data JPA repositories can return a boolean value. When you define a derived delete method to return a boolean, it will indicate whether any records were actually deleted.</p><h2 id=entitylistenersauditingentitylistenerclass>@EntityListeners(AuditingEntityListener.class)</h2><p>除</p><ul><li>@EnableJpaAuditting</li><li>@CreateDate
还需要加上：</li><li><strong>@EntityListeners(AuditingEntityListener.class)</strong></li></ul><h2 id=data-transfer-objects>Data Transfer Objects </h2><p>query only the needed fields in Spring Data JPA for several reasons:</p><h3 id=performance-optimization>Performance optimization:</h3><ul><li>By querying only the required fields, you reduce the amount of data transferred between the database and your application, which can improve performance, especially for large datasets.</li></ul><h3 id=reduced-network-traffic>Reduced network traffic:</h3><ul><li>Transferring only the necessary data minimizes network usage, which is particularly beneficial in distributed systems or when dealing with remote clients.</li></ul><h3 id=separation-of-concerns>Separation of concerns:</h3><ul><li>DTOs help separate the data representation used in your application’s business logic from the underlying database entities, providing a clear boundary between layers.</li></ul><h3 id=flexibility-and-maintainability>Flexibility and maintainability:</h3><ul><li>DTOs allow you to shape the data according to specific use cases, making it easier to evolve your API without affecting the underlying data model.</li></ul><h3 id=security>Security:</h3><ul><li>By using DTOs, you can control which data is exposed to the client, reducing the risk of accidentally exposing sensitive information.</li></ul><h3 id=avoid-lazy-loading-issues>Avoid lazy loading issues:</h3><ul><li>When working with JPA entities, lazy-loaded associations can cause performance problems or errors if accessed outside of a transaction. DTOs help avoid these issues by containing only the required data.</li></ul><h2 id=var-keyword><code>Var</code> keyword</h2><p>In Java, the var keyword was introduced in <strong>Java 10</strong> as part of the <strong>Local Variable Type Inference feature</strong>. It allows you to declare local variables without explicitly specifying their type. The compiler infers the type <strong>based on the initialization expression</strong>.
Here are some key points about var in Java:</p><ul><li>usage</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>var</span><span class=w> </span><span class=n>variableName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>initialValue</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><ul><li>Scope: 
var can only be used for <strong>local variables</strong> inside methods or loops. It cannot be used for fields, method parameters, or return types.</li><li>Initialization:
Variables declared with var must be <strong>initialized in the same statement</strong>.</li><li>Type Inference:
The compiler infers the type based on the right-hand side of the assignment.</li><li>Limitations:<ul><li>Cannot be used with null literals</li><li>Cannot be used with array initializers</li><li>Cannot be used in a compound declaration (declaring multiple variables in one statement)</li></ul></li><li>Examples</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Basic usage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>var</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;John&#34;</span><span class=p>;</span><span class=w>  </span><span class=c1>// inferred as String</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>var</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>30</span><span class=p>;</span><span class=w>       </span><span class=c1>// inferred as int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>var</span><span class=w> </span><span class=n>list</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=p>();</span><span class=w>  </span><span class=c1>// inferred as ArrayList&lt;String&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// In a for loop</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kd>var</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>10</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>i</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// With lambda expressions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>var</span><span class=w> </span><span class=n>comparator</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>s1</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>s2</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>s1</span><span class=p>.</span><span class=na>compareTo</span><span class=p>(</span><span class=n>s2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// With try-with-resources</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=kd>var</span><span class=w> </span><span class=n>reader</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>BufferedReader</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>FileReader</span><span class=p>(</span><span class=s>&#34;file.txt&#34;</span><span class=p>)))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Use reader</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ul><li>Benefits of using var:<ul><li>Reduces boilerplate code, especially with long type names.</li><li>Improves <strong>readability</strong> in some cases, particularly with generic types.</li><li>Allows the type to change without changing the variable declaration.</li></ul></li><li>Considerations:<ul><li>Use var judiciously. Sometimes explicit type declarations can improve code clarity.</li><li>var doesn’t make Java a dynamically-typed language. The type is still <strong>determined at compile-time</strong>.</li><li>IDEs can usually show you the inferred type, which helps with code understanding.</li></ul></li></ul><h2 id=other-local-variable-type-inference-feature>Other Local Variable Type Inference feature</h2><ul><li>Diamond Operator (&lt;>):
Introduced in Java 7, it allows type inference for generic class instantiation.<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>list</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>  </span><span class=c1>// Instead of new ArrayList&lt;String&gt;()  </span><span class=w>
</span></span></span></code></pre></div></li><li>Method References:
Introduced in Java 8, method references work with type inference.<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>names</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Arrays</span><span class=p>.</span><span class=na>asList</span><span class=p>(</span><span class=s>&#34;Alice&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Bob&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Charlie&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>names</span><span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span><span class=w> 
</span></span></span></code></pre></div></li><li>Try-with-resources<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=kd>var</span><span class=w> </span><span class=n>input</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>FileInputStream</span><span class=p>(</span><span class=s>&#34;file.txt&#34;</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// Use input</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div></li></ul><h2 id=repository-layer-referencing>Repository Layer Referencing</h2><h3 id=one-repository-and-multiple-services>One @Repository and Multiple @Services</h3><h4 id=pros>Pros</h4><ul><li>Promotes <strong>separation of concerns</strong></li><li>Follows the <strong>Single Responsibility Principle</strong></li><li>Can lead to better code organization and maintainability</li><li>Easier to manage <strong>transactions</strong> across multiple services</li></ul><h4 id=cons>Cons</h4><ul><li>May require more classes and interfaces</li><li>Can potentially lead to more complex dependency injection</li></ul><h3 id=multiple-repositories>Multiple @Repositories</h3><h4 id=pros-1>Pros</h4><ul><li>Can <strong>simplify</strong> the service layer if operations frequently require data from multiple repositories</li><li>Reduces the number of classes and interfaces</li><li>May be more straightforward for simpler applications</li></ul><h4 id=cons-1>⠀Cons</h4><ul><li>Can lead to a “fat” service class with too many responsibilities</li><li>May make it <strong>harder to maintain</strong> and test the service class</li><li>Could potentially <strong>violate</strong> the Single Responsibility Principle</li></ul><h3 id=considerations>Considerations</h3><p>Generally speaking, it’s often considered a good practice to follow <strong>the first approach</strong> (one @Repository and multiple @Services) for the following reasons:</p><ul><li>Better separation of concerns: Each service class can focus on a specific domain or set of related operations.</li><li>Improved maintainability: Smaller, more focused classes are usually easier to understand and maintain.</li><li>Easier testing: With more granular services, it’s easier to write unit tests and mock dependencies.</li><li>Flexibility: It’s easier to reuse and combine services in different ways.</li><li>Scalability: As your application grows, it’s easier to add new features or modify existing ones without affecting other parts of the system.</li></ul><p>However, the best approach <strong>depends on your specific use case</strong>. If your application is small and simple, or if a particular service genuinely needs to work with multiple repositories directly, then referencing multiple repositories in a service class might be appropriate.</p><p>In conclusion, while referencing one @Repository and multiple @Services in a @Service class is often a good practice, the most important thing is to choose an approach that makes sense for your application’s architecture and maintainability goals.</p><h2 id=long-or-long> Long or long</h2><p>In Java, it’s <strong>generally recommended</strong> to use the primitive type long instead of the wrapper class Long in method signatures, unless you have a <strong>specific reason</strong> to use the object wrapper. Here’s why:</p><ul><li><strong>Performance</strong>: Primitive types are more efficient in terms of memory usage and performance. They don’t require object creation or autoboxing/unboxing.</li><li><strong>Simplicity</strong>: Using primitives makes the code simpler and more straightforward.</li><li><strong>Null safety</strong>: Primitive types can’t be null, which can prevent null pointer exceptions.</li></ul><p>However, there are cases where using Long might be preferable:</p><ul><li>When <strong>null values are meaningful</strong>: If you need to represent the absence of a value, Long can be null while long cannot.</li><li>In <strong>collections</strong>: Java collections (like ArrayList or HashMap) require object types, so you’d use Long in these cases.</li><li>When working with <strong>generics</strong>: Generics in Java don’t work with primitive types, so you’d need to use Long in these situations.</li><li>In certain APIs or frameworks: Some APIs or frameworks might require the use of wrapper classes.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Preferred for most cases</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>methodWithLong</span><span class=p>(</span><span class=kt>long</span><span class=w> </span><span class=n>value</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Use when null is a meaningful value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>methodWithLongObject</span><span class=p>(</span><span class=n>Long</span><span class=w> </span><span class=n>value</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Handle null case</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Handle non-null case</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>In summary, use long by default for better performance and simplicity, but don’t hesitate to use Long when the situation calls for it, such as when dealing with nullable values or working with Java collections and generics.</p><h2 id=check-or-not>Check Or Not</h2><h3 id=checking-existence-before-update>Checking existence before update</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>repository</span><span class=p>.</span><span class=na>existsById</span><span class=p>(</span><span class=n>id</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>repository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>entity</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>EntityNotFoundException</span><span class=p>(</span><span class=s>&#34;Entity not found&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h4 id=pros-2>Pros</h4><ul><li>Provides <strong>more control</strong> over the flow of your application.</li><li>Allows you to give <strong>more specific feedback</strong> to the user (e.g., “User not found” instead of a generic error).</li><li>Can be more efficient if you have <strong>additional logic</strong> that depends on the entity’s existence.</li></ul><h4 id=cons-2>⠀Cons</h4><ul><li>Requires an additional database query, which can <strong>impact performance</strong>, especially in high-traffic scenarios.</li><li>There’s a small chance of a <strong>race condition</strong> between the check and the update (though this is rare in most applications).</li></ul><h3 id=handling-the-update-exception-directly>Handling the update exception directly</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>repository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>entity</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>EntityNotFoundException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Handle the case where the entity doesn&#39;t exist</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h4 id=pros-3>Pros</h4><ul><li>More <strong>straightforward</strong> code, following the “it’s easier to ask forgiveness than permission” principle.</li><li>Potentially more <strong>efficient</strong> as it avoids an extra database query.</li><li><strong>Eliminates</strong> the possibility of race conditions between checking and updating.</li></ul><h4 id=cons-3>⠀Cons</h4><ul><li><strong>Less control</strong> over the specific error message or handling.</li><li>May <strong>catch other unexpected exceptions</strong> that you didn’t intend to handle in the same way.</li></ul><h3 id=recommendation>Recommendation</h3><ul><li>For most simple CRUD operations, handling the exception directly is often sufficient and more efficient.</li><li>Consider checking existence first if:<ul><li>You need to provide very specific feedback to the user.</li><li>You have complex logic that depends on whether the entity exists or not.</li><li>You’re in a scenario where the extra database query doesn’t significantly impact performance.</li></ul></li><li>In <strong>high-performance</strong> systems with many updates, handling the exception might be preferable to avoid the extra query.</li><li>If you’re using optimistic locking (e.g., with @Version), you might want to handle OptimisticLockingFailureException separately, as this indicates a concurrent modification rather than a non-existent entity.</li><li>Consider your specific use case: if updates to non-existent entities are rare, handling the exception might be cleaner. If they’re common, checking first could provide a better user experience.</li></ul><h2 id=transactional-on-repository-layer>Transactional on Repository Layer</h2><p>By default, Spring Data JPA repository methods are transactional, but <strong>only for read-only operations</strong>. For modifying operations (like updates), you need to explicitly mark the method or the surrounding service method with @Transactional.</p><h2 id=derived-query-method>Derived Query Method</h2><p>In Spring Data JPA, derived query methods <strong>are primarily used for retrieving data</strong> rather than updating it. While derived query methods are very convenient for simple read operations, they do not support update operations directly.</p><h2 id=malicious-use>Malicious Use</h2><p>When developing and deploying a REST API, it’s essential to consider both valid scenarios and potential malicious use cases. </p><ul><li><strong>Security</strong>: Ignoring potential malicious use can leave your API vulnerable to attacks such as SQL injection, Cross-Site Scripting (XSS), Distributed Denial of Service (DDoS), and others.</li><li><strong>Stability</strong>: Malicious uses can lead to unexpected behavior, crashes, or resource exhaustion, affecting the availability and reliability of your service.</li><li><strong>Compliance</strong>: Many industries have regulations requiring secure handling of data, which includes protecting against malicious use.</li><li><strong>User Trust</strong>: Users expect their data to be secure. Failing to protect against malicious use can damage your reputation and erode user trust.</li></ul><h2 id=authenticatedprincipal-usage>@AuthenticatedPrincipal Usage</h2><h3 id=passing-the-principal-from-the-controller>Passing the principal from the controller</h3><h4 id=pros-4>Pros</h4><ul><li>Makes the flow of data more explicit.</li><li>Easier to <strong>unit test</strong> the service layer, as you can pass any principal object directly.</li><li>Keeps the service layer completely <strong>decoupled</strong> from Spring Security.</li></ul><h4 id=cons-4>Cons</h4><ul><li>Requires passing the principal through <strong>potentially many layers</strong> if you have a deep call hierarchy.</li><li>May lead to repetitive code in controllers if many endpoints need to pass the principal.</li></ul><h3 id=usingauthenticatedprincipalin-the-service-layer>Using@AuthenticatedPrincipal in the service layer</h3><h4 id=pros-5>Pros</h4><ul><li>Keeps the service method signature clean and focused on business logic parameters.</li><li><strong>Reduces coupling</strong> between the controller and service layer.</li><li>Allows the service to be used in different contexts (e.g., scheduled tasks, message listeners) where a controller might not be involved.</li></ul><h4 id=cons-5>Cons</h4><ul><li>May make unit testing the service layer slightly <strong>more complex</strong>, as you need to mock the security context.</li><li>Could be seen as <strong>mixing concerns</strong> if you consider authentication a cross-cutting concern.</li></ul><h3 id=recommendation-1>Recommendation</h3><p>In general, using @AuthenticatedPrincipal in the service layer is often preferred because:</p><ul><li>It adheres to the Don’t Repeat Yourself (DRY) principle, avoiding the need to pass the principal in every controller method.</li><li>It makes the service methods self-contained and more reusable in different contexts.</li><li>It leverages Spring Security’s built-in capabilities, which are well-tested and maintained.</li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/postopia/>Postopia</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>Last updated on Jul 19, 2024 00:00 UTC</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/postopia-dev-logweek-6/><div class=article-details><h2 class=article-title>【Postopia Dev Log】Week 6</h2></div></a></article><article><a href=/p/postopia-dev-logweek-5/><div class=article-details><h2 class=article-title>【Postopia Dev Log】Week 5</h2></div></a></article><article><a href=/p/postopia-dev-logweek-4/><div class=article-details><h2 class=article-title>【Postopia Dev Log】Week 4</h2></div></a></article><article><a href=/p/postopia-dev-logweek-3/><div class=article-details><h2 class=article-title>【Postopia Dev Log】Week 3</h2></div></a></article><article><a href=/p/postopia-dev-logday-5/><div class=article-details><h2 class=article-title>【Postopia Dev Log】Day 5</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 飞鸿踏雪泥</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>