<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Introduction Node.js is an open-source and cross-platform JavaScript runtime environment.\nNode.js runs the V8 JavaScript engine, the core of Google Chrome, outside of the browser.\nA Node.js app runs in a single process, without creating a new thread for every request. Node.js provides a set of asynchronous I/O primitives in its standard library that prevent JavaScript code from blocking and generally, libraries in Node.js are written using non-blocking paradigms, making blocking behavior the exception rather than the norm.\n"><title>【Node】Basics</title>
<link rel=canonical href=https://dyhes.github.io/p/nodebasics/><link rel=stylesheet href=/scss/style.min.6aa4d43a5cae1c51ef34b3f851ae7421f4b2f2d13827e2d975acbeb4f13c8710.css><meta property='og:title' content="【Node】Basics"><meta property='og:description' content="Introduction Node.js is an open-source and cross-platform JavaScript runtime environment.\nNode.js runs the V8 JavaScript engine, the core of Google Chrome, outside of the browser.\nA Node.js app runs in a single process, without creating a new thread for every request. Node.js provides a set of asynchronous I/O primitives in its standard library that prevent JavaScript code from blocking and generally, libraries in Node.js are written using non-blocking paradigms, making blocking behavior the exception rather than the norm.\n"><meta property='og:url' content='https://dyhes.github.io/p/nodebasics/'><meta property='og:site_name' content='飞鸿踏雪泥'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Node'><meta property='article:published_time' content='2021-05-16T00:00:00+00:00'><meta property='article:modified_time' content='2021-05-16T00:00:00+00:00'><meta name=twitter:title content="【Node】Basics"><meta name=twitter:description content="Introduction Node.js is an open-source and cross-platform JavaScript runtime environment.\nNode.js runs the V8 JavaScript engine, the core of Google Chrome, outside of the browser.\nA Node.js app runs in a single process, without creating a new thread for every request. Node.js provides a set of asynchronous I/O primitives in its standard library that prevent JavaScript code from blocking and generally, libraries in Node.js are written using non-blocking paradigms, making blocking behavior the exception rather than the norm.\n"><link rel="shortcut icon" href=/github.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu17834253352308399148.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>飞鸿踏雪泥</a></h1><h2 class=site-description>没有记录，就没有发生</h2></div></header><ol class=menu-social><li><a href=https://github.com/dyhes target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=mailto:dyheslin@gmail.com target=_blank title=Gmail rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-gmail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16 20h3a1 1 0 001-1V5a1 1 0 00-1-1h-3v16z"/><path d="M5 20h3V4H5A1 1 0 004 5v14a1 1 0 001 1z"/><path d="M16 4l-4 4-4-4"/><path d="M4 6.5l8 7.5 8-7.5"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/categories/><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
<span>Categories</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#introduction>Introduction</a><ol><li><a href=#difference-to-browsers>Difference to Browsers</a></li><li><a href=#v8-javascript-engine>V8 javascript engine</a></li></ol></li><li><a href=#run-and-exit>Run and Exit</a></li><li><a href=#environment-variables>Environment variables</a></li><li><a href=#repl>REPL</a></li><li><a href=#accept-argument>Accept argument</a></li><li><a href=#input>Input</a></li><li><a href=#output>Output</a><ol><li><a href=#colorful>Colorful</a></li><li><a href=#progress-bar>Progress bar</a></li></ol></li><li><a href=#export>Export</a></li><li><a href=#production>Production</a></li><li><a href=#npm><strong>Npm</strong></a><ol><li><a href=#install>Install</a></li><li><a href=#uninstall>Uninstall</a></li><li><a href=#update>Update</a></li><li><a href=#script>Script</a></li><li><a href=#packagejson><code>Package.json</code></a></li><li><a href=#package-lockjson><code>package-lock.json</code></a></li><li><a href=#semantic-version>Semantic Version</a></li><li><a href=#scope>Scope</a></li><li><a href=#npx>NPX</a></li></ol></li><li><a href=#event>Event</a></li><li><a href=#event-loop>Event Loop</a><ol><li><a href=#call-stack>Call Stack</a></li><li><a href=#the-message-queue>The Message Queue</a></li><li><a href=#es6-job-queue>ES6 Job Queue</a></li><li><a href=#processnexttick><code>process.nextTick()</code></a></li><li><a href=#setimmediate><code>setImmediate()</code></a></li></ol></li><li><a href=#asynchronicity>Asynchronicity</a><ol><li><a href=#promise>Promise</a></li><li><a href=#async-and--await>Async and Await</a></li></ol></li><li><a href=#file-and-folder>File and Folder</a><ol><li><a href=#file-descriptor>File Descriptor</a></li><li><a href=#stats>Stats</a></li><li><a href=#path>Path</a></li><li><a href=#read>Read</a></li><li><a href=#write>Write</a></li><li><a href=#append>Append</a></li><li><a href=#folders>Folders</a></li></ol></li><li><a href=#buffer-and-stream>Buffer and Stream</a><ol><li><a href=#buffer>Buffer</a></li><li><a href=#stream>Stream</a></li><li><a href=#types>types</a></li></ol></li><li><a href=#modules>Modules</a><ol><li><a href=#fs--module>fs module</a></li><li><a href=#os-module>os module</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/nutrition/ style=background-color:#93b5cf;color:>积雪粮
</a><a href=/categories/temple/ style=background-color:#69a794;color:>白玉京</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/nodebasics/>【Node】Basics</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>May 16, 2021</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>29 minute read</time></div></footer></div></header><section class=article-content><h2 id=introduction>Introduction</h2><p>Node.js is an open-source and cross-platform <strong>JavaScript runtime environment.</strong></p><p>Node.js runs the <strong>V8 JavaScript engine</strong>, the core of Google Chrome, outside of the browser.</p><p>A Node.js app runs in a <strong>single process</strong>, without creating a new thread for every request. Node.js provides a set of <strong>asynchronous I/O</strong> primitives in its standard library that prevent JavaScript code from <strong>blocking</strong> and generally, libraries in Node.js are written using <strong>non-blocking paradigms</strong>, making blocking behavior the exception rather than the norm.</p><p>When Node.js performs an I/O operation, like reading from the network, accessing a database or the filesystem, instead of blocking the thread and wasting CPU cycles waiting, Node.js will resume the operations when the response comes back.</p><p>Node.js is a <strong>low-level</strong> platform. In order to make things easy and exciting for developers, thousands of libraries were built upon Node.js by the community.</p><p>Many of those established over time as popular options. Here is a non-comprehensive list of the ones worth learning:</p><ul><li><p><strong>Express</strong>: It provides one of the most <strong>simple yet powerful</strong> ways to create a web server.</p></li><li><p><strong>koa</strong>: It is built by the same team behind Express, aims to be <strong>even simpler and smaller</strong>,</p></li><li><p><strong>Egg.js</strong>: A framework to build <strong>better enterprise frameworks and apps</strong> with Node.js & Koa.</p></li><li><p><strong>Gatsby</strong>: A <strong>React-based</strong>, <strong>GraphQL-powered</strong>, <strong>static site generator</strong> with a very rich ecosystem of plugins and starters.</p></li><li><p><strong>Next.js</strong>: React framework that gives you the best developer experience with all the features you need for production: <strong>hybrid static & server rendering, TypeScript support, smart bundling, route pre-fetching</strong>, and more.</p></li></ul><h3 id=difference-to-browsers>Difference to Browsers</h3><ul><li><p>You can use <strong>Babel</strong> to transform your code to be ES5-compatible before shipping it to the browser, but in Node.js, you won&rsquo;t need that.</p></li><li><p>Another difference is that Node.js uses the <strong>CommonJS module system</strong>, while in the browser we are starting to see the ES Modules standard being implemented. In practice, this means that for the time being you use <code>require()</code> in Node.js and <code>import</code> in the browser.</p></li></ul><h3 id=v8-javascript-engine>V8 javascript engine</h3><p>V8 is the name of the JavaScript engine that powers Google Chrome. V8 was chosen to be the engine that powered Node.js back in <strong>2009</strong>. The Node.js ecosystem is huge and thanks to V8 which also powers desktop apps, with projects like Electron.</p><p>V8 is written in <strong>C++</strong>, and it&rsquo;s continuously improved. It is portable and runs on Mac, Windows, Linux and several other systems.</p><p>JavaScript is generally considered an interpreted language, but modern JavaScript engines no longer just interpret JavaScript, they <strong>compile</strong> it. This has been happening since 2009, when the <strong>SpiderMonkey JavaScript compiler</strong> was added to Firefox 3.5, and everyone followed this idea. JavaScript is internally compiled by V8 with <strong>just-in-time</strong> (JIT) <strong>compilation</strong> to speed up the execution.</p><h2 id=run-and-exit>Run and Exit</h2><ul><li><p>RUN</p><p>The usual way to run a Node.js program is to run the <code>node</code> globally available command (once you install Node.js) and pass the name of the file you want to execute.</p><p>to restart the application automatically, <code>nodemon</code> module is used.</p><p>Run the application using nodemon followed by application file name.</p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nodemon app.js
</span></span></code></pre></div><ul><li><p>EXIT</p><ul><li><p>When running a program in the console you can close it with <code>ctrl-C</code></p></li><li><p>The <code>process</code> core module provides<code>process.exit()</code> that allows you to programmatically exit from a Node.js program. When Node.js runs this line, the process is immediately forced to <strong>terminate</strong>. This means that any callback that&rsquo;s pending, any network request still being sent, any filesystem access, or processes writing to <code>stdout</code> or <code>stderr</code> - all is going to be <strong>ungracefully</strong> terminated right away.</p></li></ul><blockquote><p>Note: <code>process</code> does not require a &ldquo;require&rdquo;, it&rsquo;s automatically available.</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span></code></pre></div><p>By default the exit code is <code>0</code>, which means success. Different exit codes have different meaning, which you might want to use in your own system to have the program communicate to other programs.</p><p>You can also set the <code>process.exitCode</code> property</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>process</span><span class=p>.</span><span class=nx>exitCode</span> <span class=o>=</span> <span class=mi>1</span>
</span></span></code></pre></div><ul><li>Many times with Node.js we start servers, like this HTTP server:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=s1>&#39;Hi!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=mi>3000</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Server ready&#39;</span><span class=p>))</span>
</span></span></code></pre></div><blockquote><p>Express is a framework that uses the http module under the hood, app.listen() returns an instance of http. You would use https.createServer if you needed to serve your app using HTTPS, as app.listen only uses the http module.</p></blockquote><p>This program is never going to end. If you call <code>process.exit()</code>, any currently pending or running request is going to be aborted. This is <em><strong>not nice</strong></em>.</p><p>In this case you need to send the command a SIGTERM signal, and handle that with the process signal handler:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=s1>&#39;Hi!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>server</span> <span class=o>=</span> <span class=nx>app</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=mi>3000</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Server ready&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>process</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;SIGTERM&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>server</span><span class=p>.</span><span class=nx>close</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Process terminated&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p><code>SIGKILL</code> is the signal that tells a process to immediately terminate, and would ideally act like <code>process.exit()</code>.</p><p><code>SIGTERM</code> is the signal that tells a process to <strong>gracefully terminate</strong>. It is the signal that&rsquo;s sent from process managers like <code>upstart</code> or <code>supervisord</code> and many others.</p><p>You can send this signal from inside the program, in another function</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>process</span><span class=p>.</span><span class=nx>kill</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>pid</span><span class=p>,</span> <span class=s1>&#39;SIGTERM&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>Or from another Node.js running program, or any other app running in your system that knows the PID of the process you want to terminate.</p></li></ul><h2 id=environment-variables>Environment variables</h2><p>The <code>process</code> core module of Node.js provides the <code>env</code> property which hosts all the environment variables that were set at the moment the process was started.</p><p>The below code runs <code>app.js</code> and set <code>USER_ID</code> and <code>USER_KEY</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>USER_ID</span><span class=o>=</span><span class=m>239482</span> <span class=nv>USER_KEY</span><span class=o>=</span>foobar node app.js
</span></span></code></pre></div><p>and you can access them like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>USER_ID</span> <span class=c1>// &#34;239482&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>USER_KEY</span> <span class=c1>// &#34;foobar&#34;
</span></span></span></code></pre></div><p>If you have multiple environment variables in your node project, you can also create an <code>.env</code> file in the root directory of your project, and then use the <strong>dotenv package</strong> to load them during runtime.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;dotenv&#39;</span><span class=p>).</span><span class=nx>config</span><span class=p>();</span>
</span></span></code></pre></div><blockquote><p>You can also run your js file with <code>node -r dotenv/config index.js</code> command if you don&rsquo;t want to import the package in your code.</p></blockquote><h2 id=repl>REPL</h2><p>If we run the <code>node</code> command without any script to execute or without any arguments, we start a REPL session:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>node
</span></span></code></pre></div><blockquote><p>Note: REPL stands for Read Evaluate Print Loop, and it is a programming language environment (basically a console window) that takes single expression as user input and returns the result back to the console after execution. The REPL session provides a convenient way to quickly test simple JavaScript code.</p></blockquote><ul><li><p>JavaScript objects</p><p>Try entering the name of a JavaScript class, like <code>Number</code>, add a dot and press <code>tab</code>. The REPL will print all the properties and methods you can access on that class</p></li><li><p>global objects</p><p>You can inspect the globals you have access to by typing <code>global.</code> and pressing <code>tab</code>.</p></li><li><p>Special commands</p><p>The REPL has some special commands, all starting with a dot <code>.</code>:</p><ul><li><code>.help</code>: shows the dot <strong>commands help</strong></li><li><code>.editor</code>: enables <strong>editor mode</strong>, to write multiline JavaScript code with ease. Once you are in this mode, enter <strong>ctrl-D to run</strong> the code you wrote.</li><li><code>.break</code>: when inputting a multi-line expression, entering the <code>.break</code> command will abort further input. Same as pressing ctrl-C.</li><li><code>.clear</code>: resets the REPL context to an <strong>empty</strong> object and clears any multi-line expression currently being input.</li><li><code>.load</code>: loads a JavaScript file, <strong>relative</strong> to the current working directory</li><li><code>.save</code>: saves all you entered in the REPL session to a file (specify the filename)</li><li><code>.exit</code>: exits the repl (same as pressing ctrl-C two times)</li></ul></li></ul><h2 id=accept-argument>Accept argument</h2><p>The way you retrieve accepted arguments is using the <code>process</code> object built into Node.js.</p><p>It exposes an <code>argv</code> property, which is an <strong>array</strong> that contains all the command line invocation arguments.</p><p>The first element is the <strong>full path</strong> <strong>of the <code>node</code> command</strong>.</p><p>The second element is the <strong>full path of the file</strong> being executed.</p><p>All the additional arguments are present from the third position going forward.</p><p>You can get only the additional arguments by creating a new array that excludes the first 2 params:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>args</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>argv</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span></code></pre></div><p>In this case:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>node app.js <span class=nv>name</span><span class=o>=</span>joe
</span></span></code></pre></div><p><code>args[0]</code> is <code>name=joe</code>, and you need to parse it. The best way to do so is by using the <a class=link href=https://www.npmjs.com/package/minimist target=_blank rel=noopener><code>minimist</code></a> library, which helps dealing with arguments:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>args</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;minimist&#39;</span><span class=p>)(</span><span class=nx>process</span><span class=p>.</span><span class=nx>argv</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nx>args</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span> <span class=c1>//joe
</span></span></span></code></pre></div><h2 id=input>Input</h2><p>Node.js since version 7 provides the <a class=link href=https://nodejs.org/api/readline.html target=_blank rel=noopener><code>readline</code> module</a> to perform exactly this: get input from a readable stream such as the <code>process.stdin</code> stream, which during the execution of a Node.js program is the terminal input, one line at a time.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>readline</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;readline&#39;</span><span class=p>).</span><span class=nx>createInterface</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>input</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>stdin</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>output</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>stdout</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>readline</span><span class=p>.</span><span class=nx>question</span><span class=p>(</span><span class=sb>`What&#39;s your name?`</span><span class=p>,</span> <span class=nx>name</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Hi </span><span class=si>${</span><span class=nx>name</span><span class=si>}</span><span class=sb>!`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>readline</span><span class=p>.</span><span class=nx>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><h2 id=output>Output</h2><p>Node.js provides a <a class=link href=https://nodejs.org/api/console.html target=_blank rel=noopener><code>console</code> module</a> which provides tons of very useful ways to interact with the command line.</p><p>It is basically the same as the <code>console</code> object you find in the browser.</p><ul><li><p><code>console.log()</code></p><p>The most basic and most used method is <code>console.log()</code>, which prints the string you pass to it to the console.</p><p>If you pass an object, it will render it as a string.</p><p>You can also pass multiple variables to <code>console.log()</code></p></li><li><p><code>console.clear()</code></p><p>``console.clear()` clears the console (the behavior might depend on the console used)</p></li><li><p><code>console.count()</code></p><p>What happens is that <code>console.count()</code> will count the number of times a string is printed, and print the count next to it.</p></li><li><p><code>console.countReset()</code></p><p>The <code>console.countReset()</code> method resets counter used with <code>console.count()</code>.</p></li><li><p><code>console.trace()</code></p><p>There might be cases where it&rsquo;s useful to print the call stack trace of a function, maybe to answer the question how did you reach that part of the code</p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>function2</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>trace</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>function1</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>function2</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nx>function1</span><span class=p>()</span>
</span></span></code></pre></div><p>output:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Trace
</span></span><span class=line><span class=cl>    at function2 <span class=o>(</span>repl:1:33<span class=o>)</span>
</span></span><span class=line><span class=cl>    at function1 <span class=o>(</span>repl:1:25<span class=o>)</span>
</span></span><span class=line><span class=cl>    at repl:1:1
</span></span><span class=line><span class=cl>    at ContextifyScript.Script.runInThisContext <span class=o>(</span>vm.js:44:33<span class=o>)</span>
</span></span><span class=line><span class=cl>    at REPLServer.defaultEval <span class=o>(</span>repl.js:239:29<span class=o>)</span>
</span></span><span class=line><span class=cl>    at bound <span class=o>(</span>domain.js:301:14<span class=o>)</span>
</span></span><span class=line><span class=cl>    at REPLServer.runBound <span class=o>[</span>as eval<span class=o>]</span> <span class=o>(</span>domain.js:314:12<span class=o>)</span>
</span></span><span class=line><span class=cl>    at REPLServer.onLine <span class=o>(</span>repl.js:440:10<span class=o>)</span>
</span></span><span class=line><span class=cl>    at emitOne <span class=o>(</span>events.js:120:20<span class=o>)</span>
</span></span><span class=line><span class=cl>    at REPLServer.emit <span class=o>(</span>events.js:210:7<span class=o>)</span>
</span></span></code></pre></div><ul><li><p><code>console.time()</code> and <code>console.timeEnd()</code></p><p>You can easily calculate how much time a function takes to run, using <code>time()</code> and <code>timeEnd()</code></p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>doSomething</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;test&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>measureDoingSomething</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>time</span><span class=p>(</span><span class=s1>&#39;doSomething()&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=c1>//do something, and measure the time it takes
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>doSomething</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>timeEnd</span><span class=p>(</span><span class=s1>&#39;doSomething()&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>measureDoingSomething</span><span class=p>()</span>
</span></span></code></pre></div><ul><li><p><code>console.error()</code></p><p>As we saw <code>console.log</code> is great for printing messages in the Console. This is what&rsquo;s called the standard output, or <code>stdout</code>.</p><p><code>console.error</code> prints to the <code>stderr</code> stream. It will not appear in the console, but it will appear in the error log.</p></li></ul><h3 id=colorful>Colorful</h3><p>The simplest way to go about coloring the console output is by using a library. <a class=link href=https://github.com/chalk/chalk target=_blank rel=noopener>Chalk</a> is such a library, and in addition to coloring it also helps with other styling facilities, like making text bold, italic or underlined.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>chalk</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;chalk&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>chalk</span><span class=p>.</span><span class=nx>yellow</span><span class=p>(</span><span class=s1>&#39;hi!&#39;</span><span class=p>))</span>
</span></span></code></pre></div><h3 id=progress-bar>Progress bar</h3><p><a class=link href=https://www.npmjs.com/package/progress target=_blank rel=noopener>Progress</a> is an awesome package to create a progress bar in the console. Install it using <code>npm install progress</code></p><p>This snippet creates a 10-step progress bar, and every 100ms one step is completed. When the bar completes we clear the interval:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>ProgressBar</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;progress&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>bar</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ProgressBar</span><span class=p>(</span><span class=s1>&#39;:bar&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>total</span><span class=o>:</span> <span class=mi>10</span> <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>timer</span> <span class=o>=</span> <span class=nx>setInterval</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>bar</span><span class=p>.</span><span class=nx>tick</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>bar</span><span class=p>.</span><span class=nx>complete</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>clearInterval</span><span class=p>(</span><span class=nx>timer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=mi>100</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=export>Export</h2><p>Node.js has a built-in module system. A Node.js file can import functionality exposed by other Node.js files.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>//1
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>car</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>brand</span><span class=o>:</span> <span class=s1>&#39;Ford&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>model</span><span class=o>:</span> <span class=s1>&#39;Fiesta&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>car</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>car</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./car&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//2
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>car</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>brand</span><span class=o>:</span> <span class=s1>&#39;Ford&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>model</span><span class=o>:</span> <span class=s1>&#39;Fiesta&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>exports</span><span class=p>.</span><span class=nx>car</span> <span class=o>=</span> <span class=nx>car</span>
</span></span><span class=line><span class=cl><span class=c1>//or
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>exports</span><span class=p>.</span><span class=nx>car</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>brand</span><span class=o>:</span> <span class=s1>&#39;Ford&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>model</span><span class=o>:</span> <span class=s1>&#39;Fiesta&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>items</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./items&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>car</span> <span class=o>=</span> <span class=nx>items</span><span class=p>.</span><span class=nx>car</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>car</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./items&#39;</span><span class=p>).</span><span class=nx>car</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>car</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./items&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>The difference between <code>module.exports</code> and <code>exports</code>:</p><ul><li><code>module.exports</code> : exposes <strong>the object</strong> it points to.</li><li><code>exports</code>: exposes <em><strong>the properties</strong></em> of the object it points to.</li></ul><h2 id=production>Production</h2><p>Node.js assumes it&rsquo;s always running in a development environment. You can signal Node.js that you are running in production by setting the <code>NODE_ENV=production</code> environment variable or:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>NODE_ENV</span><span class=o>=</span><span class=nx>production</span> <span class=nx>node</span> <span class=nx>app</span><span class=p>.</span><span class=nx>js</span>
</span></span></code></pre></div><h2 id=npm><strong>Npm</strong></h2><h3 id=install>Install</h3><p>If a project has a <code>package.json</code> file, by running</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install
</span></span></code></pre></div><p>it will install everything the project needs, in the <code>node_modules</code> folder, creating it if it&rsquo;s not existing already.</p><p>You can also install a specific package by running</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install &lt;package-name&gt;
</span></span></code></pre></div><p>Furthermore, since npm 5, this command adds <code>&lt;package-name></code> to the <code>package.json</code> file <em>dependencies</em>. <strong>Before version 5</strong>, you needed to add the flag <code>--save</code>.</p><p>Often you&rsquo;ll see more <strong>flags</strong> added to this command:</p><ul><li><code>--save-dev</code> installs and adds the entry to the <code>package.json</code> file <em>devDependencies</em></li><li><code>--no-save</code> installs but does not add the entry to the <code>package.json</code> file <em>dependencies</em></li><li><code>--save-optional</code> installs and adds the entry to the <code>package.json</code> file <em>optionalDependencies</em></li><li><code>--no-optional</code> will prevent optional dependencies from being installed</li></ul><p><strong>Shorthands</strong> of the flags can also be used:</p><ul><li>-S: &ndash;save</li><li>-D: &ndash;save-dev</li><li>-O: &ndash;save-optional</li></ul><p>The difference between <em>devDependencies</em> and <em>dependencies</em> is that the former contains development tools, like a testing library, while the latter is bundled with the app in production.</p><p>As for the <em>optionalDependencies</em> the difference is that build failure of the dependency will not cause installation to fail. But it is your program&rsquo;s responsibility to handle the lack of the dependency.</p><p>A global installation is performed using the <code>-g</code> flag:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install -g lodash
</span></span></code></pre></div><p>You can install an old version of an npm package using the <code>@</code> syntax:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install &lt;package&gt;@&lt;version&gt;
</span></span></code></pre></div><p>You might also be interested in listing all the previous versions of a package. You can do it with <code>npm view &lt;package> versions</code></p><p>When you install a package using <code>npm install &lt;packagename></code>, the <strong>latest available</strong> version of the package is downloaded and put in the <code>node_modules</code> folder, and a corresponding entry is added to the <code>package.json</code> and <code>package-lock.json</code> files that are present in your current folder.</p><h3 id=uninstall>Uninstall</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm uninstall &lt;package-name&gt;
</span></span></code></pre></div><p>Using the <code>-S</code> flag, or <code>--save</code>, this operation will also remove the reference in the <code>package.json</code> file.</p><p><code>package.json</code> will be <strong>automatically</strong> updated with devDependency and dependency once you uninstall npm package.</p><p>If the package is installed <strong>globally</strong>, you need to add the <code>-g</code> / <code>--global</code> flag:</p><h3 id=update>Update</h3><p>Updating is also made easy, by running</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>npm</span> <span class=nx>update</span>
</span></span></code></pre></div><p><code>npm</code> will check all packages for a newer version that satisfies your versioning constraints.</p><p>You can specify a single package to update as well:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>npm update &lt;package-name&gt;
</span></span></span></code></pre></div><p>Since npm version 5.0.0, <code>npm update</code> will update the <code>package.json</code> with the updated version. Use <code>npm update --no-save</code> to <strong>not update</strong> <code>package.json</code>.</p><p>To discover new releases of the packages, you run <code>npm outdated</code>.</p><p>Some of those updates are major releases. Running <code>npm update</code> won&rsquo;t update the version of those. Major releases are never updated in this way because they (by definition) introduce breaking changes, and <code>npm</code> wants to save you trouble.</p><p>To update all packages to a new major version, install the <code>npm-check-updates</code> package globally:</p><p>then run :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ncu -u
</span></span></code></pre></div><h3 id=script>Script</h3><p>The <code>package.json</code> file supports a format for specifying command line tasks that can be run by using</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=err>npm</span> <span class=err>run</span> <span class=err>&lt;task-name&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;start-dev&#34;</span><span class=p>:</span> <span class=s2>&#34;node lib/server-development&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;start&#34;</span><span class=p>:</span> <span class=s2>&#34;node lib/server-production&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The <code>npm root -g</code> command will tell you where that global installation location is on your machine.</p><h3 id=packagejson><code>Package.json</code></h3><p>The <code>package.json</code> file is kind of a <strong>manifest</strong> for your project. It can do a lot of things, completely unrelated. It&rsquo;s a central repository of configuration for tools, for example. It&rsquo;s also where <code>npm</code> and <code>yarn</code> store the names and versions for all the installed packages.</p><p>There are no fixed requirements of what should be in a <code>package.json</code> file, for an application. The only requirement is that it <strong>respects the JSON format</strong>, otherwise it cannot be read by programs that try to access its properties programmatically.</p><ul><li><p>main</p><p>Sets the <strong>entry point</strong> for the package. When you import this package in an application, that&rsquo;s where the application will search for the module exports.</p></li><li><p>private</p><p>if set to <code>true</code> prevents the app/package to be accidentally published on <code>npm</code></p></li><li><p>engines</p><p>Sets which <strong>versions of Node.js and other commands</strong> this package/app work on</p></li><li><p>browserslist</p><p>Is used to tell <strong>which browsers (and their versions)</strong> you want to support. It&rsquo;s referenced by Babel, Autoprefixer, and other tools, to only add the polyfills and fallbacks needed to the browsers you target.</p></li></ul><h3 id=package-lockjson><code>package-lock.json</code></h3><p>The goal of <code>package-lock.json</code> file is to keep track of the <strong>exact version</strong> of every package that is installed so that a product is 100% reproducible in the same way even if packages are updated by their maintainers.</p><p>You don&rsquo;t commit to Git your node_modules folder, which is generally huge, and when you try to replicate the project on another machine by using the <code>npm install</code> command, if you specified the <code>~</code> syntax and a patch release of a package has been released, that one is going to be installed. Same for <code>^</code> and minor releases.</p><p>The <code>package-lock.json</code> sets your currently installed version of each package <strong>in stone</strong>, and <code>npm</code> will use those exact versions when running <code>npm ci</code>.</p><p>The dependencies versions <strong>will be updated</strong> in the <code>package-lock.json</code> file when you run <code>npm update</code>.</p><h3 id=semantic-version>Semantic Version</h3><p>The Semantic Versioning concept is simple: all versions have 3 digits: <code>x.y.z</code>.</p><ul><li>the first digit is the <strong>major</strong> version</li><li>the second digit is the <strong>minor</strong> version</li><li>the third digit is the <strong>patch</strong> version</li></ul><p>The rules use those symbols:</p><ul><li><code>^</code>: It will only do updates that <strong>do not change the leftmost non-zero number</strong> i.e there can be changes in minor version or patch version but not in major version. If you write <code>^13.1.0</code>, when running <code>npm update</code>, it can update to <code>13.2.0</code>, <code>13.3.0</code> even <code>13.3.1</code>, <code>13.3.2</code> and so on, but not to <code>14.0.0</code> or above.</li><li><code>~</code>: if you write <code>~0.13.0</code> when running <code>npm update</code> it can update to patch releases: <code>0.13.1</code> is ok, but <code>0.14.0</code> is not.</li><li><code>></code>: you accept any version higher than the one you specify</li><li><code>>=</code>: you accept any version equal to or higher than the one you specify</li><li><code>&lt;=</code>: you accept any version equal or lower to the one you specify</li><li><code>&lt;</code>: you accept any version lower than the one you specify</li><li><code>=</code>: you accept that exact version</li><li><code>-</code>: you accept a <strong>range</strong> of versions. Example: <code>2.1.0 - 2.6.2</code></li><li><code>||</code>: you combine <strong>sets</strong>. Example: <code>&lt; 2.1 || > 2.6</code></li></ul><p>There are other rules too:</p><ul><li>no symbol: you accept only that specific version you specify (<code>1.2.1</code>)</li><li><code>latest</code>: you want to use the latest version available</li></ul><h3 id=scope>Scope</h3><p>In your code you can only require <strong>local</strong> packages:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;package-name&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>In general, <strong>all packages should be installed locally</strong>. This makes sure you can have dozens of applications in your computer, all running a different version of each package if needed. A package <strong>should be installed globally</strong> when it provides an executable command that you run from the <strong>shell</strong> (CLI), and it&rsquo;s reused across projects.</p><p>Great examples of popular global packages which you might know are</p><ul><li><code>npm</code></li><li><code>vue-cli</code></li><li><code>grunt-cli</code></li><li><code>mocha</code></li><li><code>react-native-cli</code></li><li><code>gatsby-cli</code></li><li><code>forever</code></li><li><code>nodemon</code></li></ul><h3 id=npx>NPX</h3><p><code>npx</code> is a very powerful command that&rsquo;s been available in <strong>npm</strong> starting version 5.2, released in July 2017.</p><p><code>npx</code> lets you run code built with Node.js and published through the npm registry.</p><p>Running <code>npx commandname</code> automatically finds the correct reference of the command inside the <code>node_modules</code> folder of a project, without needing to know the exact path, and without requiring the package to be installed globally and in the user&rsquo;s path.</p><h2 id=event>Event</h2><p>On the backend side, Node.js offers us the option to build a similar system using the <a class=link href=https://nodejs.org/api/events.html target=_blank rel=noopener><code>events</code> module</a>.</p><p>This module, in particular, offers the <code>EventEmitter</code> class, which we&rsquo;ll use to handle our events.</p><p>You initialize that using</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>EventEmitter</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;events&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>eventEmitter</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>EventEmitter</span><span class=p>()</span>
</span></span></code></pre></div><p>This object exposes, among many others, the <code>on</code> and <code>emit</code> methods.</p><ul><li><code>emit</code> is used to trigger an event</li><li><code>on</code> is used to add a callback function that&rsquo;s going to be executed when the event is triggered</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>eventEmitter</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;start&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;started&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p>when we run</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>eventEmitter</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;start&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>the event handler function is triggered, and we get the console log.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>eventEmitter</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;start&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>start</span><span class=p>,</span> <span class=nx>end</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`started from </span><span class=si>${</span><span class=nx>start</span><span class=si>}</span><span class=sb> to </span><span class=si>${</span><span class=nx>end</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>eventEmitter</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;start&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>100</span><span class=p>)</span>
</span></span></code></pre></div><p>The EventEmitter object also exposes several other methods to interact with events, like</p><ul><li><code>once()</code>: add a one-time listener</li><li><code>removeListener()</code> / <code>off()</code>: remove an event listener from an event</li><li><code>removeAllListeners()</code>: remove all listeners for an event</li></ul><h2 id=event-loop>Event Loop</h2><p>The Node.js JavaScript code runs on a single thread. There is just one thing happening at a time.</p><p>This is a limitation that&rsquo;s actually very helpful, as it simplifies a lot how you program without worrying about concurrency issues.</p><p>You mainly need to be concerned that <em>your code</em> will run on a <strong>single event loop</strong>, and write code with this thing in mind to avoid blocking it.</p><p>Almost all the I/O primitives in JavaScript are non-blocking. Network requests, filesystem operations, and so on. Being blocking is the exception, and this is why JavaScript is based so much on <strong>callbacks</strong>, and more recently on <strong>promises</strong> and <strong>async/await</strong>.</p><h3 id=call-stack>Call Stack</h3><p>The event loop continuously checks the <strong>call stack</strong> to see if there&rsquo;s any function that needs to run.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>bar</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;bar&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>baz</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;baz&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>foo</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;foo&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>setTimeout</span><span class=p>(</span><span class=nx>bar</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>baz</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>foo</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1>//output
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>foo</span>
</span></span><span class=line><span class=cl><span class=nx>baz</span>
</span></span><span class=line><span class=cl><span class=nx>bar</span>
</span></span></code></pre></div><p><img src=C:%5cUsers%5cdyhes%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220130164512101.png loading=lazy alt=image-20220130164512101></p><p><img src=C:%5cUsers%5cdyhes%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220130171105441.png loading=lazy alt=image-20220130171105441></p><h3 id=the-message-queue>The Message Queue</h3><p>When <code>setTimeout()</code> is called, the Browser or Node.js starts the timer. Once the timer expires, in this case immediately as we put 0 as the timeout, the callback function is put in the <strong>Message Queue</strong>.</p><p>The Message Queue is also where user-initiated events like click or keyboard events, or fetch responses are queued before your code has the opportunity to react to them. Or also DOM events like <code>onload</code>.</p><p><strong>The loop gives priority to the call stack, and it first processes everything it finds in the call stack, and once there&rsquo;s nothing in there, it goes to pick up things in the message queue.</strong></p><p>We don&rsquo;t have to wait for functions like <code>setTimeout</code>, fetch or other things to do their own work, because they are provided by the browser, and they live on their own threads. For example, if you set the <code>setTimeout</code> timeout to 2 seconds, you don&rsquo;t have to wait 2 seconds - the wait <strong>happens elsewhere</strong>.</p><h3 id=es6-job-queue>ES6 Job Queue</h3><p>ECMAScript 2015 introduced the concept of the <strong>Job Queue</strong>, which is used by B (also introduced in ES6/ES2015). It&rsquo;s a way to execute the result of an <strong>async</strong> function as soon as possible, rather than being put at the end of the call stack.</p><p>Promises that resolve before the current function ends will be executed right after the current function.</p><h3 id=processnexttick><code>process.nextTick()</code></h3><p>As you try to understand the Node.js event loop, one important part of it is <code>process.nextTick()</code>. Every time the event loop takes <strong>a full trip</strong>, we call it a <strong>tick</strong>. When we pass a function to <code>process.nextTick()</code>, we instruct the engine to invoke this function at the end of the current operation, <strong>before</strong> the next event loop tick starts. Calling <code>setTimeout(() => {}, 0)</code> will execute the function <strong>at the end of next tick</strong>, much later than when using <code>nextTick()</code> which prioritizes the call and executes it just <strong>before the beginning</strong> of the next tick. Use <code>nextTick()</code> when you want to make sure that in the next event loop iteration that code is <strong>already executed</strong>.</p><h3 id=setimmediate><code>setImmediate()</code></h3><p>When you want to execute some piece of code <strong>asynchronously</strong>, but <strong>as soon as possible</strong>, one option is to use the <code>setImmediate()</code> function. Any function passed as the <code>setImmediate()</code> argument is a <strong>callback</strong> that&rsquo;s executed <strong>in the</strong> <strong>next iteration of the event loop</strong>.</p><p>The differences between <code>setImmediate()</code> , <code>setTimeout(() => {}, 0)</code> , and <code>process.nextTick()</code>:</p><ul><li><p>A function passed to <code>process.nextTick()</code> is going to be executed on the current iteration of the event loop, after the current operation ends. This means it will always execute before <code>setTimeout</code> and <code>setImmediate</code>.</p></li><li><p>A <code>setTimeout()</code> callback with a 0ms delay is very similar to <code>setImmediate()</code>. The execution order will depend on various factors, but they will be <strong>both run in the next iteration of the event loop</strong>. If you specify the timeout delay to <code>0</code>, the callback function will be executed as soon as possible, but after the current function execution. This is called <strong>zero delay</strong>.</p></li></ul><h2 id=asynchronicity>Asynchronicity</h2><p>Computers are asynchronous by design. Asynchronous means that things can happen <strong>independently</strong> of the main program flow. In the current consumer computers, every program runs for a specific time slot and then it stops its execution to let another program continue their execution. This thing runs in a cycle so fast that it&rsquo;s impossible to notice. We think our computers run many programs simultaneously, but this is an illusion (except on multiprocessor machines). JavaScript is <strong>synchronous</strong> by default and is single threaded. This means that code cannot create new threads and run in parallel. Lines of code are executed in series, one after another.</p><h3 id=promise>Promise</h3><p>A promise is commonly defined as <strong>a proxy for a value that will eventually become available</strong>. Promises are one way to deal with asynchronous code, without getting stuck in <strong>callback hell</strong>. Promises have been part of the language for years (standardized and introduced in ES2015), and have recently become more integrated, with <strong>async</strong> and <strong>await</strong> in ES2017.</p><p><strong>Async functions</strong> use promises <strong>behind the scenes</strong>, so understanding how promises work is fundamental to understanding how <code>async</code> and <code>await</code> work.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>let</span> <span class=nx>done</span> <span class=o>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>isItDoneYet</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>done</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>workDone</span> <span class=o>=</span> <span class=s1>&#39;Here is the thing I built&#39;</span>
</span></span><span class=line><span class=cl>    <span class=nx>resolve</span><span class=p>(</span><span class=nx>workDone</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>why</span> <span class=o>=</span> <span class=s1>&#39;Still working on something else&#39;</span>
</span></span><span class=line><span class=cl>    <span class=nx>reject</span><span class=p>(</span><span class=nx>why</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><h3 id=async-and--await>Async and Await</h3><p>Async functions are a combination of promises and generators, and basically, they are a higher level abstraction over promises. Let me repeat: <strong>async/await is built on promises</strong>. An async function <strong>returns a promise</strong>. When you want to <strong>call</strong> this function you prepend <code>await</code>, and <strong>the calling code will stop until the promise is resolved or rejected</strong>. One caveat: the client function must be defined as <code>async</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>doSomethingAsync</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>(</span><span class=nx>resolve</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=nx>resolve</span><span class=p>(</span><span class=s1>&#39;I did something&#39;</span><span class=p>),</span> <span class=mi>3000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>doSomething</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=kr>await</span> <span class=nx>doSomethingAsync</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Before&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>doSomething</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;After&#39;</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=file-and-folder>File and Folder</h2><h3 id=file-descriptor>File Descriptor</h3><p>A file descriptor is <strong>a reference to an open file</strong>, a <strong>number</strong> (fd) returned by opening the file using the <code>open()</code> method offered by the <code>fs</code> module. This number (<code>fd</code>) uniquely identifies an open file in operating system</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>fs</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>fs</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=s1>&#39;/Users/joe/test.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>fd</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>//fd is our file descriptor
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span></code></pre></div><p>Other flags you&rsquo;ll commonly use are:</p><ul><li><code>r+</code> open the file for <strong>reading and writing</strong>, if file doesn&rsquo;t exist it <strong>won&rsquo;t be created</strong>.</li><li><code>w+</code> open the file for <strong>reading and writing</strong>, positioning the stream at the <strong>beginning</strong> of the file. The file is <strong>created</strong> <strong>if not existing.</strong></li><li><code>a</code> open the file for <strong>writing</strong>, positioning the stream at the <strong>end</strong> of the file. The file is <strong>created if not existing</strong>.</li><li><code>a+</code> open the file for <strong>reading and writing</strong>, positioning the stream at the <strong>end</strong> of the file. The file is created if not existing.</li></ul><p>You can also open the file by using the <code>fs.openSync</code> method, which returns the file descriptor, instead of providing it in a callback:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>fs</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>fd</span> <span class=o>=</span> <span class=nx>fs</span><span class=p>.</span><span class=nx>openSync</span><span class=p>(</span><span class=s1>&#39;/Users/joe/test.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=stats>Stats</h3><p>The file information is included in the stats variable. We can obtain information about the file by:</p><ul><li>if the file is a <strong>directory</strong> or a file, using <code>stats.isFile()</code> and <code>stats.isDirectory()</code></li><li>if the file is a <strong>symbolic link</strong> using <code>stats.isSymbolicLink()</code></li><li>the file <strong>size in bytes</strong> using <code>stats.size</code>.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>fs</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>fs</span><span class=p>.</span><span class=nx>stat</span><span class=p>(</span><span class=s1>&#39;/Users/joe/test.txt&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>stats</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=c1>//we have access to the file stats in `stats`
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//sync
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>fs</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>stats</span> <span class=o>=</span> <span class=nx>fs</span><span class=p>.</span><span class=nx>statSync</span><span class=p>(</span><span class=s1>&#39;/Users/joe/test.txt&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=path>Path</h3><p>Given a path, you can extract information out of it using those methods:</p><ul><li><code>dirname</code>: get the parent folder of a file</li><li><code>basename</code>: get the filename part</li><li><code>extname</code>: get the file extension</li></ul><p>You can get the absolute path calculation of a relative path using <code>path.resolve()</code>, <code>path.normalize()</code> is another useful function that will try and calculate the actual path, when it contains relative specifiers like <code>.</code> or <code>..</code>, or double slashes. <strong>Neither resolve nor normalize will check if the path exists</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>path</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>notes</span> <span class=o>=</span> <span class=s1>&#39;/users/joe/notes.txt&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>path</span><span class=p>.</span><span class=nx>dirname</span><span class=p>(</span><span class=nx>notes</span><span class=p>)</span> <span class=c1>// /users/joe
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>path</span><span class=p>.</span><span class=nx>basename</span><span class=p>(</span><span class=nx>notes</span><span class=p>)</span> <span class=c1>// notes.txt
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>path</span><span class=p>.</span><span class=nx>extname</span><span class=p>(</span><span class=nx>notes</span><span class=p>)</span> <span class=c1>// .txt
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>name</span> <span class=o>=</span> <span class=s1>&#39;joe&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=s1>&#39;users&#39;</span><span class=p>,</span> <span class=nx>name</span><span class=p>,</span> <span class=s1>&#39;notes.txt&#39;</span><span class=p>)</span> <span class=c1>//&#39;/users/joe/notes.txt&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>path</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=s1>&#39;joe.txt&#39;</span><span class=p>)</span> <span class=c1>//&#39;/Users/joe/joe.txt&#39; if run from my home folder
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>path</span><span class=p>.</span><span class=nx>normalize</span><span class=p>(</span><span class=s1>&#39;/users/joe/..//test.txt&#39;</span><span class=p>)</span> <span class=c1>//&#39;/users/test.txt&#39;
</span></span></span></code></pre></div><h3 id=read>Read</h3><p>The simplest way to read a file in Node.js is to use the <code>fs.readFile()</code> method, passing it the file path, encoding and a callback function that will be called with the file data (and the error).</p><p>Alternatively, you can use the synchronous version <code>fs.readFileSync()</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>fs</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>fs</span><span class=p>.</span><span class=nx>readFile</span><span class=p>(</span><span class=s1>&#39;/Users/joe/test.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;utf8&#39;</span> <span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>data</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//sync
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>fs</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>data</span> <span class=o>=</span> <span class=nx>fs</span><span class=p>.</span><span class=nx>readFileSync</span><span class=p>(</span><span class=s1>&#39;/Users/joe/test.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;utf8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Both <code>fs.readFile()</code> and <code>fs.readFileSync()</code> read the full content of the file in memory before returning the data.</p><p>This means that big files are going to have a major impact on your memory consumption and speed of execution of the program.</p><p>In this case, a better option is to read the file content using streams.</p><h3 id=write>Write</h3><p>The easiest way to write to files in Node.js is to use the <code>fs.writeFile()</code> API.</p><p>Alternatively, you can use the synchronous version <code>fs.writeFileSync()</code>。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>fs</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>content</span> <span class=o>=</span> <span class=s1>&#39;Some content!&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>fs</span><span class=p>.</span><span class=nx>writeFile</span><span class=p>(</span><span class=s1>&#39;/Users/joe/test.txt&#39;</span><span class=p>,</span> <span class=nx>content</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=c1>//file written successfully
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//sync
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>fs</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>content</span> <span class=o>=</span> <span class=s1>&#39;Some content!&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>fs</span><span class=p>.</span><span class=nx>writeFileSync</span><span class=p>(</span><span class=s1>&#39;/Users/joe/test.txt&#39;</span><span class=p>,</span> <span class=nx>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=c1>//file written successfully
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>By default, this API will <strong>replace the contents of the file</strong> if it does already exist.</p><p>You can modify the default by specifying a flag:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>fs</span><span class=p>.</span><span class=nx>writeFile</span><span class=p>(</span><span class=s1>&#39;/Users/joe/test.txt&#39;</span><span class=p>,</span> <span class=nx>content</span><span class=p>,</span> <span class=p>{</span> <span class=nx>flag</span><span class=o>:</span> <span class=s1>&#39;a+&#39;</span> <span class=p>},</span> <span class=nx>err</span> <span class=p>=&gt;</span> <span class=p>{})</span>
</span></span></code></pre></div><p>The flags you&rsquo;ll likely use are</p><ul><li><code>r+</code> open the file for reading and writing</li><li><code>w+</code> open the file for reading and writing, positioning the stream at the beginning of the file. The file is created if it does not exist</li><li><code>a</code> open the file for writing, positioning the stream at the end of the file. The file is created if it does not exist</li><li><code>a+</code> open the file for reading and writing, positioning the stream at the end of the file. The file is created if it does not exist</li></ul><h3 id=append>Append</h3><p>The easiest way to append content to files in Node.js is to use the <code>fs.appendFile()</code> API.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>content</span> <span class=o>=</span> <span class=s1>&#39;Some content!&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>fs</span><span class=p>.</span><span class=nx>appendFile</span><span class=p>(</span><span class=s1>&#39;file.log&#39;</span><span class=p>,</span> <span class=nx>content</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=c1>//done!
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span></code></pre></div><h3 id=folders>Folders</h3><ul><li><p>Use <code>fs.access()</code> to check if the folder exists and Node.js can access it with its permissions.</p></li><li><p>Use <code>fs.mkdir()</code> or <code>fs.mkdirSync()</code> to create a new folder.</p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>fs</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>folderName</span> <span class=o>=</span> <span class=s1>&#39;/Users/joe/test&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>fs</span><span class=p>.</span><span class=nx>existsSync</span><span class=p>(</span><span class=nx>folderName</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fs</span><span class=p>.</span><span class=nx>mkdirSync</span><span class=p>(</span><span class=nx>folderName</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li><p>Use <code>fs.readdir()</code> or <code>fs.readdirSync()</code> to read the contents of a directory.</p></li><li><p>Use <code>fs.rename()</code> or <code>fs.renameSync()</code> to rename folder.</p></li><li><p>Use <code>fs.rmdir()</code> or <code>fs.rmdirSync()</code> to remove a folder.</p><p>Removing a folder that has content can be more complicated than you need. You can pass the option <code>{ recursive: true }</code> to recursively remove the contents</p><p><strong>NOTE:</strong> <em>In Node</em> <code>v16.x</code> <em>the option</em> <code>recursive</code> <em>is</em> <strong>deprecated</strong> <em>for</em> <code>fs.rmdir</code> <em>of callback API, instead use</em> <code>fs.rm</code> <em>to delete folders that have content in them</em></p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>fs</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>fs</span><span class=p>.</span><span class=nx>rm</span><span class=p>(</span><span class=nx>dir</span><span class=p>,</span> <span class=p>{</span> <span class=nx>recursive</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>force</span><span class=o>:</span> <span class=kc>true</span> <span class=p>},</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=nx>err</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>dir</span><span class=si>}</span><span class=sb> is deleted!`</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><h2 id=buffer-and-stream>Buffer and Stream</h2><h3 id=buffer>Buffer</h3><p>A buffer is <strong>an area of memory</strong>. It represents <strong>a fixed-size chunk</strong> of memory (can&rsquo;t be resized) allocated <strong>outside</strong> of the V8 JavaScript engine. You can think of a buffer like an array of integers, which each represent a byte of data.</p><p>A buffer is created using the <a class=link href=https://nodejs.org/api/buffer.html#buffer_buffer_from_buffer_alloc_and_buffer_allocunsafe target=_blank rel=noopener><code>Buffer.from()</code></a>, <a class=link href=https://nodejs.org/api/buffer.html#buffer_class_method_buffer_alloc_size_fill_encoding target=_blank rel=noopener><code>Buffer.alloc()</code></a>, and <a class=link href=https://nodejs.org/api/buffer.html#buffer_class_method_buffer_allocunsafe_size target=_blank rel=noopener><code>Buffer.allocUnsafe()</code></a> methods.</p><ul><li><a class=link href=https://nodejs.org/api/buffer.html#buffer_class_method_buffer_from_array target=_blank rel=noopener><code>Buffer.from(array)</code></a></li><li><a class=link href=https://nodejs.org/api/buffer.html#buffer_class_method_buffer_from_arraybuffer_byteoffset_length target=_blank rel=noopener><code>Buffer.from(arrayBuffer[, byteOffset[, length\]])</code></a></li><li><a class=link href=https://nodejs.org/api/buffer.html#buffer_class_method_buffer_from_buffer target=_blank rel=noopener><code>Buffer.from(buffer)</code></a></li><li><a class=link href=https://nodejs.org/api/buffer.html#buffer_class_method_buffer_from_string_encoding target=_blank rel=noopener><code>Buffer.from(string[, encoding\])</code></a></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>buf</span> <span class=o>=</span> <span class=nx>Buffer</span><span class=p>.</span><span class=nx>from</span><span class=p>(</span><span class=s1>&#39;Hey!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>buf</span> <span class=o>=</span> <span class=nx>Buffer</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>//or
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>buf</span> <span class=o>=</span> <span class=nx>Buffer</span><span class=p>.</span><span class=nx>allocUnsafe</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=stream>Stream</h3><p>Streams are a way to handle reading/writing files, network communications, or any kind of end-to-end information exchange in an efficient way. The Node.js <a class=link href=https://nodejs.org/api/stream.html target=_blank rel=noopener><code>stream</code> module</a> provides the foundation upon which all streaming APIs are built. <strong>All streams are instances of EventEmitter</strong>.</p><p>Streams basically provide two major advantages over using other data handling methods:</p><ul><li><strong>Memory efficiency</strong>: you don&rsquo;t need to load large amounts of data in memory before you are able to process it</li><li><strong>Time efficiency</strong>: it takes way less time to start processing data, since you can start processing as soon as you have it, rather than waiting till the whole data payload is available</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>http</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;http&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>fs</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>server</span> <span class=o>=</span> <span class=nx>http</span><span class=p>.</span><span class=nx>createServer</span><span class=p>((</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>stream</span> <span class=o>=</span> <span class=nx>fs</span><span class=p>.</span><span class=nx>createReadStream</span><span class=p>(</span><span class=nx>__dirname</span> <span class=o>+</span> <span class=s1>&#39;/data.txt&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>stream</span><span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nx>server</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=mi>3000</span><span class=p>)</span>
</span></span></code></pre></div><p>the <code>pipe()</code> method is called on the file stream. It takes the source, and pipes it into a destination.</p><p>The return value of the <code>pipe()</code> method is the destination stream, which is a very convenient thing that lets us chain multiple <code>pipe()</code> calls, like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>src</span><span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>dest1</span><span class=p>).</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>dest2</span><span class=p>)</span>
</span></span></code></pre></div><p>Due to their advantages, many Node.js core modules provide native stream handling capabilities, most notably:</p><ul><li><code>process.stdin</code> returns a stream connected to stdin</li><li><code>process.stdout</code> returns a stream connected to stdout</li><li><code>process.stderr</code> returns a stream connected to stderr</li><li><code>fs.createReadStream()</code> creates a readable stream to a file</li><li><code>fs.createWriteStream()</code> creates a writable stream to a file</li><li><code>net.connect()</code> initiates a stream-based connection</li><li><code>http.request()</code> returns an instance of the http.ClientRequest class, which is a writable stream</li><li><code>zlib.createGzip()</code> compress data using gzip (a compression algorithm) into a stream</li><li><code>zlib.createGunzip()</code> decompress a gzip stream.</li><li><code>zlib.createDeflate()</code> compress data using deflate (a compression algorithm) into a stream</li><li><code>zlib.createInflate()</code> decompress a deflate stream</li></ul><h3 id=types>types</h3><p>There are four classes of streams:</p><ul><li><code>Readable</code>: a stream you can pipe from, but not pipe into (you can receive data, but not send data to it). When you push data into a readable stream, it is buffered, until a consumer starts to read the data.</li><li><code>Writable</code>: a stream you can pipe into, but not pipe from (you can send data, but not receive from it)</li><li><code>Duplex</code>: a stream you can both pipe into and pipe from, basically a combination of a Readable and Writable stream</li><li><code>Transform</code>: a Transform stream is similar to a Duplex, but the output is a transform of its input</li></ul><p>We get the Readable stream from the <a class=link href=https://nodejs.org/api/stream.html target=_blank rel=noopener><code>stream</code> module</a>, and we initialize it and implement the <code>readable._read()</code> method.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Stream</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;stream&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>readableStream</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Stream</span><span class=p>.</span><span class=nx>Readable</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nx>readableStream</span><span class=p>.</span><span class=nx>_read</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=c1>//or
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>readableStream</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Stream</span><span class=p>.</span><span class=nx>Readable</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>read</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>readableStream</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s1>&#39;hi!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>readableStream</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s1>&#39;ho!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>writableStream</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Stream</span><span class=p>.</span><span class=nx>Writable</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nx>writableStream</span><span class=p>.</span><span class=nx>_write</span> <span class=o>=</span> <span class=p>(</span><span class=nx>chunk</span><span class=p>,</span> <span class=nx>encoding</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>chunk</span><span class=p>.</span><span class=nx>toString</span><span class=p>())</span>
</span></span><span class=line><span class=cl>  <span class=nx>next</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>You can also consume a readable stream directly, using the <code>readable</code> event:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>JScopy</span>
</span></span><span class=line><span class=cl><span class=nx>readableStream</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;readable&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>readableStream</span><span class=p>.</span><span class=nx>read</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><h2 id=modules>Modules</h2><h3 id=fs--module>fs module</h3><ul><li><code>fs.access()</code>: check if the file exists and Node.js can access it with its permissions</li><li><code>fs.appendFile()</code>: append data to a file. If the file does not exist, it&rsquo;s created</li><li><code>fs.chmod()</code>: change the permissions of a file specified by the filename passed. Related: <code>fs.lchmod()</code>, <code>fs.fchmod()</code></li><li><code>fs.chown()</code>: change the owner and group of a file specified by the filename passed. Related: <code>fs.fchown()</code>, <code>fs.lchown()</code></li><li><code>fs.close()</code>: close a file descriptor</li><li><code>fs.copyFile()</code>: copies a file</li><li><code>fs.createReadStream()</code>: create a readable file stream</li><li><code>fs.createWriteStream()</code>: create a writable file stream</li><li><code>fs.link()</code>: create a new hard link to a file</li><li><code>fs.mkdir()</code>: create a new folder</li><li><code>fs.mkdtemp()</code>: create a temporary directory</li><li><code>fs.open()</code>: set the file mode</li><li><code>fs.readdir()</code>: read the contents of a directory</li><li><code>fs.readFile()</code>: read the content of a file. Related: <code>fs.read()</code></li><li><code>fs.readlink()</code>: read the value of a symbolic link</li><li><code>fs.realpath()</code>: resolve relative file path pointers (<code>.</code>, <code>..</code>) to the full path</li><li><code>fs.rename()</code>: rename a file or folder</li><li><code>fs.rmdir()</code>: remove a folder</li><li><code>fs.stat()</code>: returns the status of the file identified by the filename passed. Related: <code>fs.fstat()</code>, <code>fs.lstat()</code></li><li><code>fs.symlink()</code>: create a new symbolic link to a file</li><li><code>fs.truncate()</code>: truncate to the specified length the file identified by the filename passed. Related: <code>fs.ftruncate()</code></li><li><code>fs.unlink()</code>: remove a file or a symbolic link</li><li><code>fs.unwatchFile()</code>: stop watching for changes on a file</li><li><code>fs.utimes()</code>: change the timestamp of the file identified by the filename passed. Related: <code>fs.futimes()</code></li><li><code>fs.watchFile()</code>: start watching for changes on a file. Related: <code>fs.watch()</code></li><li><code>fs.writeFile()</code>: write data to a file. Related: <code>fs.write()</code></li></ul><p>One peculiar thing about the <code>fs</code> module is that all the methods are asynchronous by default, but they can also work synchronously by appending <code>Sync</code>.</p><h3 id=os-module>os module</h3><p>This module provides many functions that you can use to retrieve information from the underlying operating system and the computer the program runs on, and interact with it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>os</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;os&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>There are a few useful properties that tell us some key things related to handling files:</p><p><code>os.EOL</code> gives the line delimiter sequence. It&rsquo;s <code>\n</code> on Linux and macOS, and <code>\r\n</code> on Windows.</p><p><code>os.constants.signals</code> tells us all the constants related to handling process signals, like SIGHUP, SIGKILL and so on.</p><p><code>os.constants.errno</code> sets the constants for error reporting, like EADDRINUSE, EOVERFLOW and more.</p></section><footer class=article-footer><section class=article-tags><a href=/tags/node/>Node</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>Last updated on May 16, 2021 00:00 UTC</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/javaenum/><div class=article-image><img src=/covers/cover19.png loading=lazy data-key data-hash=/covers/cover19.png></div><div class=article-details><h2 class=article-title>【Java】Enum</h2></div></a></article><article class=has-image><a href=/p/javadates-and-times/><div class=article-image><img src=/covers/cover19.png loading=lazy data-key data-hash=/covers/cover19.png></div><div class=article-details><h2 class=article-title>【Java】Dates and Times</h2></div></a></article><article class=has-image><a href=/p/javareleases/><div class=article-image><img src=/covers/cover9.png loading=lazy data-key data-hash=/covers/cover9.png></div><div class=article-details><h2 class=article-title>【Java】Releases</h2></div></a></article><article class=has-image><a href=/p/mac.db_store-file/><div class=article-image><img src=/covers/cover20.jpg loading=lazy data-key data-hash=/covers/cover20.jpg></div><div class=article-details><h2 class=article-title>【Mac】.DB_Store file</h2></div></a></article><article><a href=/p/solidityconcepts/><div class=article-details><h2 class=article-title>【Solidity】Concepts</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 飞鸿踏雪泥</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>